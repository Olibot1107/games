const p=(a,b)=>{const d=document.createElement("canvas");d.width=a;d.height=b;return d},aa=(a,b,d,c,e,f,g)=>{for(let h=d;h<d+8;++h)for(let l=b;l<b+8;++l){const k=h*c+l,n=g[f[e[Math.round(a.data[k*4]/85)]??0]??0]??[];for(let m=0;m<4;++m)a.data[k*4+m]=n[m]??255}},r=(a,b,d)=>{var c=ba;const e=p(a.width,a.height),f=e.getContext("2d");f.drawImage(a,0,0);const g=f.getImageData(0,0,a.width,a.height),h=e.width/8|0,l=e.height/8|0;let k=0;for(let n=0;n<l;++n)for(let m=0;m<h;++m){if(k>=b.length)continue;const q=
(b[k]??"0000").split("").map(w=>parseInt(w,32));aa(g,m*8,n*8,a.width,q,c,d);++k}f.putImageData(g,0,0);return e},t=(a,b,d,c,e,f,g,h=0)=>{const l=p(d,c),k=l.getContext("2d");k.font=b;k.textAlign="center";a=a.split("\n");for(--f;f>=0;--f){k.fillStyle=f==0?"#ffffff":"#000000";b=0;for(var n of a){for(let m=-h;m<=h;++m)for(let q=-h;q<=h;++q)Math.abs(m)==Math.abs(q)&&m!=0||k.fillText(n,d/2+m,f+(b+1)*e+q);++b}}e=k.getImageData(0,0,d,c);for(h=0;h<d*c;++h)if(e.data[h*4+3]<127)e.data[h*4+3]=0;else{n=e.data[h*
4]>128?0:1;for(a=0;a<3;++a)e.data[h*4+a]=g[n][a];e.data[h*4+3]=255}k.putImageData(e,0,0);return l};const u=(a,b)=>{b|=0;return((a|0)%b+b)%b};function v(a,b){a.x=b.x;a.y=b.y}function x(a,b,d){a.x=b;a.y=d;return a}class y{constructor(a=0,b=0){this.x=a;this.y=b}length(){return Math.hypot(this.x,this.y)}rotate(a){const b=Math.sin(a);a=Math.cos(a);const d=this.x,c=this.y;this.x=a*d-b*c;this.y=b*d+a*c;return this}clone(){return new y(this.x,this.y)}};const ca=(a,b,d=!0)=>{let c=null;d&&(c=document.createElement("div"),c.id="d",c.setAttribute("style","position: absolute; top: 0; left: 0; z-index: -1;"));const e=document.createElement("canvas");e.setAttribute("style","position: absolute;z-index: -1;image-rendering: optimizeSpeed;image-rendering: pixelated;image-rendering: -moz-crisp-edges;");e.width=a;e.height=b;d&&c!=null&&(c.appendChild(e),document.body.appendChild(c));a=e.getContext("2d");a.imageSmoothingEnabled=!1;a.globalAlpha=1;return[e,a]};
function z(a){var b=window.innerWidth,d=window.innerHeight;const c=a.i.width/a.i.height;let e=b,f=d;b/d>=c?e=Math.round(f*c):f=Math.round(e/c);a.i.style.width=String(e)+"px";a.i.style.height=String(f)+"px";a.i.style.left=String(b/2-e/2|0)+"px";a.i.style.top=String(d/2-f/2|0)+"px"}function A(a,b){a.h.fillStyle=b;a.h.fillRect(0,0,a.i.width,a.i.height)}
function B(a,b,d=0,c=0,e=0,f=0,g=0,h=b.width,l=b.height,k=h,n=l,m=k/2,q=n/2,w){f|=0;g|=0;h|=0;l|=0;c=c+a.g.x|0;e=e+a.g.y|0;k|=0;n|=0;a=a.h;const D=d!=0||w!==void 0;D&&a.save();(d&1)!=0&&(a.translate(h,0),a.scale(-1,1),c*=-1);(d&2)!=0&&(a.translate(0,l),a.scale(1,-1),e*=-1);w!==void 0&&(a.translate(m+c,q+e),a.rotate(-w),c=-m,e=-q);a.drawImage(b,f,g,h,l,c,e,k,n);D&&a.restore()}
function C(a,b,d,c,e,f=0,g=0,h=0,l=0,k=0,n=b.width,m=b.height){c=Math.PI*2/c;const q=-Math.sin(e)*d/2;for(let w=0;w<m;++w)B(a,b,1&f,g+Math.sin(e+c*w)*d+q,h+w,l,k+((f&2)!=0?m-1-w:w),n,1)}
function E(a,b,d,c,e,f=0,g=0,h=0,l=0,k=0,n=0){const m=b.width/16|0;c=c+a.g.x|0;e=e+a.g.y|0;var q=(d.length+1)*(m+f);h==1?c-=q/2|0:h==2&&(c-=q|0);h=c;l/=d.length;for(q=0;q<d.length;++q){const w=d.charCodeAt(q);w==10?(h=c,e+=m+g):(a.h.drawImage(b,w%16*m,((w/16|0)-2)*m,m,m,h,e+Math.round(Math.sin(n+q*l)*k),m,m),h+=m+f)}}function F(a,b,d,c,e=c){b=b+a.g.x|0;d=d+a.g.y|0;c|=0;e|=0;for(let g=-e;g<=e;++g){var f=g/e;f=Math.round(Math.sqrt(1-f*f)*c);f<=0||a.h.fillRect(b-f,d+g,f*2,1)}}
function da(a,b,d=a.width/2,c=a.height/2){d=d+a.g.x|0;c=c+a.g.y|0;var e=Math.max(0,c-b)|0;const f=Math.min(a.height,c+b)|0;e>0&&a.fillRect(0,0,a.width,e);for(f<a.height&&a.fillRect(0,f,a.width,a.height-f);e<f;++e){var g=e-c;if(Math.abs(g)>=b){a.h.fillRect(0,e,a.width,1);continue}const h=Math.round(d-Math.sqrt(b*b-g*g));g=Math.round(d+Math.sqrt(b*b-g*g));h>0&&a.h.fillRect(0,e,h,1);g<a.width&&a.h.fillRect(g,e,a.width-h,1)}}
function G(a,b,d,c,e){c|=0;e|=0;if(!(c>=e)){b=b+a.g.x|0;d=d+a.g.y|0;for(let h=-e;h<=e;++h){var f=h/e;f=Math.round(Math.sqrt(1-f*f)*e);if(!(f<=0)){var g=0;Math.abs(h)<c&&(g=h/c,g=Math.round(Math.sqrt(1-g*g)*c));g<=0?a.h.fillRect(b-f,d+h,f*2,1):(a.h.fillRect(b-f,d+h,f-g,1),a.h.fillRect(b+g,d+h,f-g,1))}}}}function H(a,b=1){a.h.globalAlpha=Math.max(0,Math.min(1,b))}
class I{constructor(a,b,d=!1){this.g=new y;this.width=a;this.height=b;[this.i,this.h]=ca(a,b,d);d&&(window.addEventListener("resize",()=>{z(this)}),z(this))}setColor(a){this.h.fillStyle=a;this.h.strokeStyle=a}fillRect(a=0,b=0,d=this.width,c=this.height){this.h.fillRect(a+this.g.x|0,b+this.g.y|0,d|0,c|0)}move(a,b){this.g.x+=a;this.g.y+=b}moveTo(a=0,b=0){this.g.x=a;this.g.y=b}};const ba=[4,0,511,219,365,168,376,344,508,418,500,264,408,499,328,472,491,264,331,413,495,272,505],ea="1002 1002 1002 109A 109A 109A 0009 10HG 1002 1002 1002 109A 109A 109A 10L9 10L9 1056 1056 1058 1076 1056 1056 1078 1078 1078 1078 1078 1078 1078 1078 1078 1078 107A 107A 10CA 10CB 10CD 10CD 10EF 10EF 107A 107A 10CB 10CB 10CD 10CD 10DF 10EF 10JK 10JK 10JK 10JK 10JK 10JK 000I 000I 10JK 10JK 10JK 10JK 10JK 10JK 000I 000I 1042 1042 0000 0000 0000 0000 0000 0000 1042 1042 0000 0000 0000 0000 0000 0000".split(" ");function J(a,b){a=a.F.get(b);if(a===void 0)throw Error(`Could not find a bitmap with id ${b}!`);return a}function fa(a){var b=[{id:0,path:"f.png"},{id:1,path:"b.png"}];for(const d of b){++a.g;const c=new Image;c.onload=()=>{++a.h;a.F.set(d.id,c)};c.src=d.path}}function K(a,b){a=a.L.get(b);if(a===void 0)throw Error(`Could not find a sample with id ${b}!`);return a}class ha{get loaded(){return this.g==0||this.h>=this.g}constructor(){this.g=this.h=0;this.F=new Map;this.L=new Map}};const ia=["square","triangle","sawtooth","sine"];
class ja{constructor(a,b,d,c,e){this.i=0;this.j=void 0;this.h=a;this.g=Array.from(b);this.l=d;this.type=c;this.m=e;this.i=.4}play(a){const b=this.h.currentTime,d=this.h.createOscillator(),c=this.h.createGain(),e=["setValueAtTime","linearRampToValueAtTime","exponentialRampToValueAtTime"][this.m];d.type=ia[this.type]??"square";a*=this.l;let f=this.g[2]*a;d.frequency.setValueAtTime(this.g[0],b);c.gain.setValueAtTime(this.i*f,b);let g=0;for(let h=0;h<this.g.length;h+=3){const l=this.g[h],k=this.g[h+1];
f=Math.max(1E-4,Math.min(1,this.g[h+2]*a));d.frequency[e](l,b+g);c.gain[e](f,b+g);g+=1/60*k}c.gain.exponentialRampToValueAtTime(f*.5,b+g);d.connect(c).connect(this.h.destination);d.start(b);d.stop(b+g);d.onended=()=>d.disconnect();this.j?.disconnect();this.j=d}};function L(a,b,d=1,c=0,e=2){return new ja(a.h,b,d,c,e)}function M(a,b,d=.6){if(a.g)try{b.play(d*.6)}catch(c){}}function ka(a,b=!a.g){a.g=b}function N(a){return"AUDIO: "+(a.g?"ON ":"OFF")}class la{constructor(a){this.g=!0;this.h=a}};class ma{constructor(a=[],b=[]){this.timestamp=this.state=0;this.keys=a;this.H=b}ja(){return{state:this.state,timestamp:this.timestamp}}}function O(a,b,d,c,e){let f=b.get(d);f===void 0&&(f=[0,0],b.set(d,f));e?f[0]!=1&&(f[0]=3,f[1]=c,a.g=!0):f[0]!=0&&(f[0]=2,f[1]=0)}function na(a){for(const b of a.values())b[0]==3?b[0]=1:b[0]==2&&(b[0]=0),(b[0]&1)==0&&(b[1]=0)}
function oa(a){for(const c of a.actions.values()){var b=a;c.state=0;c.timestamp=0;for(const e of c.keys){var d=b.h.get(e)??[0,0];d[0]!=0&&(c.state=d[0],d[1]>c.timestamp&&(c.timestamp=d[1]))}if(c.state==0)for(const e of c.H)d=b.i.get(e)??[0,0],d[0]!=0&&(c.state=d[0],d[1]>c.timestamp&&(c.timestamp=d[1]))}}function pa(a){na(a.h);na(a.i);a.g=!1}function P(a,b){return a.actions.get(b)?.ja()??{state:0,timestamp:0}}
class qa{constructor(){var a=[{id:0,keys:["ArrowRight","KeyD"],H:[],M:!0},{id:2,keys:["ArrowLeft","KeyA"],H:[],M:!0},{id:1,keys:["ArrowUp","KeyW"],H:[],M:!0},{id:3,keys:["ArrowDown","KeyS"],H:[],M:!0},{id:4,keys:["Space","Enter"],H:[],M:!0},{id:5,keys:[],H:["r","R"],M:!0},{id:6,keys:["Backspace"],H:[],M:!0},{id:7,keys:["Escape"],H:[],M:!1},{id:8,keys:["Escape","Enter"],H:[],M:!1}];this.g=!1;this.h=new Map;this.i=new Map;this.actions=new Map;const b=[],d=[];for(const c of a)c.M&&(b.push(...c.keys),
d.push(...c.H)),this.actions.set(c.id,new ma(c.keys,c.H));this.j=Array.from(new Set(b));this.l=Array.from(new Set(d));window.addEventListener("keydown",c=>{(this.j.includes(c.code)||this.l.includes(c.key))&&c.preventDefault();O(this,this.h,c.code,c.timeStamp,!0);O(this,this.i,c.key,c.timeStamp,!0)});window.addEventListener("keyup",c=>{(this.j.includes(c.code)||this.l.includes(c.key))&&c.preventDefault();O(this,this.h,c.code,c.timeStamp,!1);O(this,this.i,c.key,c.timeStamp,!1)});window.addEventListener("mousemove",
()=>window.focus());window.addEventListener("mousedown",()=>window.focus())}};const ra=[0,1,0,-1,0],sa=[0,0,-1,0,1],ta=[0,3,4,1,2];const Q=["#000000","#ffb66d","#db6d00","#922400"];function ua(a,b){const d=1E3/60*a.A,c=a.g.loaded;a.R=Math.min(a.R+(b-a.ba),5*d);a.ba=b;b=a.R>=d;let e=!0;for(;a.R>=d;a.R-=d)oa(a.controller),a.W&&a.fa(),c&&!a.W&&(a.da(),a.W=!0),e&&(pa(a.controller),e=!1);b&&c&&a.ea();window.requestAnimationFrame(f=>ua(a,f))}class va{constructor(a){var b=60;this.ba=this.R=0;this.W=!1;this.A=1;this.h=new I(256,192,!0);this.controller=new qa;this.audio=new la(a);this.g=new ha;b=Math.max(1,b)|0;this.A=1/b/(1/60)}ca(){}da(){}fa(){}ea(){}};function wa(a,b){for(let k=0;k<a.height;++k)for(let n=0;n<a.width;++n){var d=b[k*a.width+n];if(d!=0)if(d==1){var c=a;d=n;var e=k,f=c,g=b,h=d,l=e;const m=Array(9).fill(!1);for(let q=-1;q<=1;++q){const w=u(l+q,f.height);for(let D=-1;D<=1;++D)m[(q+1)*3+(D+1)]=g[w*f.width+u(h+D,f.width)]==1}f=m;d=e*c.width*4+d*2;c.g[d]=1;f[1]?f[3]&&!f[0]?c.g[d]=5:f[3]||(c.g[d]=9):c.g[d]=f[3]?7:3;++d;c.g[d]=2;f[1]?f[5]&&!f[2]?c.g[d]=6:f[5]||(c.g[d]=10):c.g[d]=f[5]?8:4;d+=c.width*2-1;c.g[d]=11;f[7]?f[3]&&!f[6]?c.g[d]=15:
f[3]||(c.g[d]=19):c.g[d]=f[3]?17:13;++d;c.g[d]=12;f[7]?f[5]&&!f[8]?c.g[d]=16:f[5]||(c.g[d]=20):c.g[d]=f[5]?18:14}else switch(c=a,e=k*c.width*4+n*2,d-1){case 2:c.g[e]=21;c.g[e+1]=22;break;case 4:e+=c.width*2;c.g[e]=31;c.g[e+1]=32;break;case 3:c.g[e]=23;c.g[e+c.width*2]=33;break;case 1:c.g[e+1]=24,c.g[e+c.width*2+1]=34}}}
class xa{constructor(a,b,d){this.width=b;this.height=d;a=a.map(c=>c<=8?c:0);this.g=Array(this.width*this.height*4).fill(0);wa(this,a)}B(a,b){for(let d=0;d<this.height*2;++d)for(let c=0;c<this.width*2;++c){const e=this.g[d*this.width*2+c]-1;e!=-1&&B(a,b,0,c*8,d*8,e%10*8,Math.floor(e/10)*8,8,8)}}};const ya=[!1,!1,!1,!0,!1,!0,!0],za=[!0,!1,!0,!0,!1,!1,!0],Aa=[!0,!1,!0,!1,!1,!1,!1];function Ba(a){return new y((a.J.x+.5)*16,(a.J.y+.5)*16)}function Ca(a,b){const d=Ba(a);for(let c=0;c<16;++c){const e=(Math.random()*2-1)*2,f=-4+Math.random()*5;R(a.j.next(),d.x,d.y,e,f,a.orientation,b,!0)}}
function Da(a,b,d){const c=a.J.x*16,e=a.J.y*16;for(let g=0;g<4;++g){var f=Math.PI/4+Math.PI/2*g;const h=Math.cos(f)*1.5;f=Math.sin(f)*1.5+-1;const l=g<2?g%2:1-g%2,k=g/2|0;R(a.j.next(),c+l*8+4,e+k*8+4,h,f,d,2,!0,(b+l)*8,(6+k)*8)}}
function Ea(a,b,d,c){if(!a.C||a.G||!b.C||b.G||!b.O||(a.o.x|0)!=(b.o.x|0)||(a.o.y|0)!=(b.o.y|0))return!1;if(a.type==3&&b.type==0)return a.G=!0,a.h=0,M(d,K(c,2),.6),!1;if((a.type==1||a.type==5)&&b.type==4)return a.C=!1,Da(a,a.type==5?4:0,b.orientation),M(d,K(c,4),.8),!1;if(a.type==6){let e=!1;if(b.type==1)b.C=!1,Da(b,0,b.orientation),M(d,K(c,4),.8);else if(b.type==4)M(d,K(c,4),.8);else if(b.type==0||b.type==2)M(d,K(c,1),.5),b.C=!1,Ca(b,b.type==0?0:1),M(d,K(c,1),.5),e=!0;a.h=0;a.G=!0;return e}return Aa[a.type]??
!1?(a.C=!1,Ca(a,a.type==0?0:1),M(d,K(c,1),.5),!0):!1}
class Fa{constructor(a,b,d,c,e){this.i=this.h=this.g=this.S=0;this.$=this.O=!1;this.C=!0;this.G=!1;this.o=new y(a,b);this.J=this.o.clone();this.N=new y;this.type=d;this.ha=this.orientation=c;this.ia=za[this.type]??!1;this.l=ya[this.type]??!1;this.g=a%2==b%2?0:1;this.j=e}update(a,b){const d=1/30;this.C&&(this.G?(this.S=0,this.h+=b,this.h>=20&&(this.C=this.G=!1)):(this.O&&this.C&&!this.G&&(this.J.x=this.o.x-(1-a)*this.N.x,this.J.y=this.o.y-(1-a)*this.N.y,this.type==0&&(this.i+=a,this.i>=1&&(--this.i,
a=Ba(this),R(this.j.next(),a.x,a.y,0,0,0,3,!1)))),this.g=(this.g+d*b)%2,this.type==3?this.S=2:(this.S=0,this.O&&(this.S=this.type==0?3:1)),this.$=!1))}B(a,b){if(this.C)if(this.G){var d=this.h/20,c=(this.J.x+.5)*16,e=(this.J.y+.5)*16;if(this.type==3||this.type==6){b=d*d*16;d=4+d*12;var f=this.type==3?"#ffdbff":"#ff9200";a.setColor(this.type==3?"#db6db6":"#b62400");G(a,c,e,b,d);a.setColor(f);G(a,c-1,e-1,b,d-2)}}else{c=this.g%1*4|0;e=this.J.x*16;d=this.J.y*16;f=this.orientation;f=new y(ra[f],sa[f]);
var g=this.orientation*Math.PI/2;switch(this.type){case 2:case 0:B(a,b,0,e+f.x,d+f.y,c*16,this.type==2?16:0,16,16,16,16,8,8,g);break;case 1:B(a,b,0,e,d,0,48,16,16);break;case 4:case 5:B(a,b,0,e,d,(this.type-3)*16,48,16,16);break;case 3:B(a,b,0,e,d+Math.round(Math.sin(this.g*Math.PI)),c*16,32,16,16);break;case 6:C(a,b,1,Math.PI*4,this.g/2*Math.PI*2,0,e,d+1,48,48,16,16)}}}move(a,b){if(!this.C||this.O||this.l||b==0)return!1;this.ha=this.orientation;this.orientation=b;const d=new y(ra[b],sa[b]);a:{var c=
this.o.x+d.x,e=this.o.y+d.y;if(c<0||e<0||c>=a.width||e>=a.height)a=!1;else{var f=a.aa[e*a.width+c];if(f==1||f-1==ta[b])a=!1;else{for(const g of a.v)if(!g.C||g.G||g.ia?0:(g.o.x|0)==(c|0)&&(g.o.y|0)==(e|0)){a=g.getType();if((a==1||a==5)&&this.getType()==4&&this.$)break;a=!1;break a}a=!0}}}return a?(v(this.N,d),this.O=!0,this.o.x+=this.N.x,this.o.y+=this.N.y,this.i=0,!0):!1}V(){return this.C}getType(){return this.type}};const S=(a,b,d)=>a<b?Math.min(b,a+d):Math.max(b,a-d);const Ga=["#000000","#ff2400"];function R(a,b,d,c,e,f,g,h,l=0,k=0){f=-f*Math.PI/2;x(a.o,b,d);x(a.speed,c,e).rotate(f);v(a.j,a.speed);a.g=30;a.i=30;a.type=g;if(g==0||g==1)a.diameter=2+(Math.random()*3|0);g!=3&&x(a.j,c,6).rotate(f);x(a.l,l,k);a.Z=h;a.h=!0}
class Ha{constructor(){this.type=this.diameter=this.i=this.g=0;this.Z=!0;this.o=new y;this.speed=new y;this.j=new y;this.m=new y(.125,.125);this.l=new y;this.h=!1}update(a){this.h&&(this.g-=a,this.g<=0?this.h=!1:(this.speed.x=S(this.speed.x,this.j.x,this.m.x*a),this.speed.y=S(this.speed.y,this.j.y,this.m.y*a),this.o.x+=this.speed.x*a,this.o.y+=this.speed.y*a))}B(a,b){if(this.h){var d=1;this.g<this.i/4&&(d=this.g/(this.i/4));H(a,d);switch(this.type){case 0:case 1:b=this.o.x-this.diameter/2;d=this.o.y-
this.diameter/2;a.setColor(Ga[this.type]);a.fillRect(b,d,this.diameter,this.diameter);break;case 3:b=this.g/this.i*6;a.setColor("#000000");F(a,this.o.x,this.o.y,b,b);break;case 2:B(a,b,0,this.o.x-4,this.o.y-4,this.l.x,this.l.y,8,8)}H(a)}}V(){return this.h}}class Ia{constructor(){this.g=[]}next(){for(var a of this.g)if(!a.V())return a;a=new Ha;this.g.push(a);return a}update(a){for(const b of this.g)b.update(a)}};function Ja(a,b,d){b.length=0;for(const c of a.g)b.push(new Fa(c.x,c.y,c.type,c.orientation,d))}class T{constructor(a){this.g=[];for(const b of a)b.V()&&!b.G&&this.g.push({x:b.o.x-b.N.x,y:b.o.y-b.N.y,orientation:b.ha,type:b.type})}}function Ka(a){for(let b=0;b<a.height;++b)for(let d=0;d<a.width;++d){const c=a.aa[b*a.width+d];c<=8||a.v.push(new Fa(d,b,c-9,4,a.m))}}function La(a,b){a.h=!1;let d;do{d=!1;for(const c of a.v)c.move(a,b)&&(d=a.h=!0)}while(d);a.h&&(a.j=0,a.D=b);return a.h}
function Ma(a,b,d,c){if(!(a.A||a.h||a.i)){var e=0,f=0,g=!1;for(let h=0;h<4;++h){const l=P(b,h);(l.state&1)!=0&&l.timestamp>=f&&(f=l.timestamp,e=h+1,g=!0)}g&&La(a,e)&&(a.u.push(new T(a.v)),M(d,K(c,3),.4))}}
function Na(a,b,d,c){if(a.h&&(a.l+=1/120*c,a.l>.5&&(a.l=.5),a.j+=a.l*c,a.j>=1)){a.h=!1;--a.j;for(c=0;c<a.v.length;++c)for(let f=c+1;f<a.v.length;++f){let g=Ea(a.v[c],a.v[f],b,d);if(g=Ea(a.v[f],a.v[c],b,d)||g)a.i=!0,a.g=45}for(b=0;b<a.v.length;++b)a.v[b].V()||a.v.splice(b,1);for(var e of a.v)e.C&&!e.G&&e.O&&(e.O=!1,e.$=!0,b=e.N,b.x=0,b.y=0,v(e.J,e.o));if(!La(a,a.D)){a.D=0;a.l=0;a.j=0;a:if(a.i)e=!1;else{for(const f of a.v)if(f.getType()==3&&f.V()&&!f.G){e=!1;break a}e=!0}a.A=e}}}
function U(a){if(a.u.length==0)return!1;Ja(a.u.pop(),a.v,a.m);Oa(a);return!0}function V(a,b=!1){!b&&a.u.length>0&&a.u.push(new T(a.v));Oa(a);Ja(a.I,a.v,a.m)}function Oa(a){a.h=!1;a.l=0;a.D=0;a.i=!1;a.g=0}
class Pa{constructor(a){this.l=this.j=0;this.h=!1;this.D=0;this.i=!1;this.g=0;this.A=!1;this.width=parseInt(a[0],32);this.height=parseInt(a[1],32);this.aa=a.substring(2).split("").map(b=>parseInt(b,32));this.K=new xa(this.aa,this.width,this.height);this.m=new Ia;this.v=[];Ka(this);this.I=new T(this.v);this.u=[]}update(a,b,d,c){this.i&&(this.g-=c,this.g<=0&&(U(this)||V(this,!0),this.i=!1,this.g=0));Ma(this,a,b,d);Na(this,b,d,c);this.i&&(this.g-=c,this.g<=0&&!this.h&&(U(this)||V(this,!0),this.i=!1,
this.g=0));for(const e of this.v)e.update(this.j,c);this.v.sort((e,f)=>e.S-f.S);this.m.update(c)}B(a,b){a.setColor("#248fdb");a.fillRect(0,0,this.width*16,this.height*16);a.setColor("#49b6ff");for(var d=0;d<this.height;++d)for(let e=0;e<this.width;++e)e%2!=d%2&&a.fillRect(e*16,d*16,16,16);d=J(b,6);b=J(b,7);this.K.B(a,d);d=this.m;for(var c of d.g)c.Z||c.B(a,b);for(const e of this.v)e.B(a,b);c=this.m;for(const e of c.g)e.Z&&e.B(a,b)}};const Qa="871111111110C000111000A00111101001190A0001110A010111111111 871111111110010C0110A0011110110101100900011001A0B111111111 7711111111C00491110011110000011111C011A020011111111 871111111110100B0110900131101B02011C11011110400C0111111111 871111111110A000D1101011111029100110111C01100AA00111111111 8811111111100011011E100131109E00011311010110000EE11D0B0EC111111111 87111111111C0040C1111011E1101010E1100000A11900E0D111111111 97111111111100000001100F0A90110110111110000F00110A0010C1111111111 871111111110090FC111013111100100011BF000A1111000A111111111 9811111111110400E001101B001011011100011090D0F011010131111000F0C01111111111 98111111111100010001100C1C0011001110011A00100A1110010011100919001111111111 971111111111104010C1100101011190101F011101011011CF1A19A1111111111 B91111111111110E0000C0011011EE111E11C01000010110010CE1101100100D91C11E111E111011000C00E00111111111111".split(" ");const W=["#00246d","#929292","#ffffff","#000000"];class X{get text(){return this.Y}constructor(a,b){this.Y=a;this.g=b}evaluate(){return this.g()}}function Ra(a,b=a.g){a.g=u(b,a.buttons.length);a.active=!0}function Sa(a){a.g=u(1,a.buttons.length-1)}
class Ta{constructor(a,b=!1){this.g=0;this.buttons=a;this.active=b;this.width=Math.max(...this.buttons.map(d=>d.text.length+2));this.height=this.buttons.length}update(a,b,d,c=!1){this.active&&(c&&P(a,7).state==3?(M(b,K(d,7),.6),this.active=!1):(c=this.g,P(a,1).state==3?--this.g:P(a,3).state==3&&++this.g,c!=this.g&&(this.g=u(this.g,this.buttons.length),M(b,K(d,6),.5)),P(a,4).state==3&&(this.buttons[this.g].evaluate()&&(this.active=!1),M(b,K(d,7),.6))))}B(a,b,d=0,c=0,e=0){if(this.active){e>0&&(a.setColor(`rgba(0,0,0,${e})`),
a.fillRect());e=a.width/2-this.width*4;var f=a.height/2-this.height*12/2,g=J(b,2);b=J(b,3);var h=this.width*8+d*2,l=this.height*12+c*2,k=W.length-1;a.setColor("rgba(0,0,0,0.33)");a.fillRect(e-k+2,f-k+2,h+k*2,l+k*2);for(k=W.length-1;k>=0;--k)a.setColor(W[k]),a.fillRect(e-k,f-k,h+k*2,l+k*2);for(h=0;h<this.buttons.length;++h)E(a,h==this.g?b:g,(h==this.g?"$%":"")+this.buttons[h].text,e+d+2,f+c+2+h*12,-1)}}isActive(){return this.active}};const Ua=a=>{try{const b=a.map(d=>String(Number(d))).join("");window.localStorage.setItem("lsjn25a",b)}catch(b){}},Va=()=>{try{return(window.localStorage.getItem("lsjn25a")??"").split("").map(a=>Number(a)==1)}catch(a){}return Array(12).fill(!1)},Wa=()=>{try{return window.localStorage.getItem("lsjn25a")!=null}catch(a){}return!1};const Xa=["#6db6ff","#4992db"],Ya=[["#000000","#b66d00","#ffb649"],["#000000","#db6d00","#ffdb6d"],["#000000","#499200","#92db00"],["#000000","#6db600","#dbff49"]],Za=1/12;function $a(a){const b=a.D/2-52,d=(1-a.i)*a.h.y+a.i*a.g.y;a.m.x=a.I/2-88+((1-a.i)*a.h.x+a.i*a.g.x)*48+16;a.m.y=b+d*40+12}function ab(a){for(const b of a.j)if(!b)return!1;return!0}
class bb{constructor(a,b,d){this.i=0;this.u=!1;this.l=0;this.h=new y;this.g=new y;this.m=new y;this.K=d;this.A=Array(12).fill(0);this.j=Array(12).fill(!1);this.I=a;this.D=b;$a(this)}update(a,b,d,c){this.l=(this.l+1/60*c)%4;for(var e=0;e<3;++e)for(var f=0;f<4;++f){var g=e*4+f;this.A[g]=S(this.A[g],Number(this.g.x==f&&this.g.y==e),Za*c)}P(a,4).state==3&&(M(b,K(d,7),.6),this.u=!1,v(this.h,this.g),this.K(this.h.y*4+this.h.x));$a(this);if(this.u)this.i+=Za*c,this.i>=1&&(this.u=!1,this.i=0,v(this.h,this.g));
else if(c=P(a,0),e=P(a,1),f=P(a,2),a=P(a,3),g=Math.max(c.timestamp,e.timestamp,f.timestamp,a.timestamp),(c.state&1)!=0&&c.timestamp>=g?++this.g.x:(f.state&1)!=0&&f.timestamp>=g?--this.g.x:(a.state&1)!=0&&a.timestamp>=g?++this.g.y:(e.state&1)!=0&&e.timestamp>=g&&--this.g.y,this.g.x=u(this.g.x,4),this.g.y=u(this.g.y,3),this.g.x!=this.h.x||this.g.y!=this.h.y)this.u=!0,this.i=0,M(b,K(d,6),.5)}B(a,b){var d=(a.width/32|0)+1,c=(a.height/32|0)+1,e=this.l%1*32;for(var f=0;f<c;++f)for(var g=0;g<d;++g)a.setColor(Xa[Number(g%
2==f%2)]),a.fillRect(g*32-e,(f-1)*32+e,32,32);E(a,J(b,4),"SELECT A LEVEL",a.width/2,12,-7,0,1,Math.PI*4,2,this.l*Math.PI*2);d=a.width/2-88;c=a.height/2-52;e=J(b,4);f=1;for(g=0;g<3;++g){const h=c+40*g;for(let l=0;l<4;++l){const k=d+48*l,n=4*this.A[g*4+l]|0,m=Ya[Number(l==this.h.x&&g==this.h.y)+Number(this.j[g*4+l])*2];a.setColor(m[0]);a.fillRect(k,h+n,32,30-n);a.setColor(m[1]);a.fillRect(k+1,h+n+1,30,28-n);a.setColor(m[2]);a.fillRect(k+1,h+n+1,30,22);E(a,e,`${f}`,k+16,h+n+12-7,-8,0,1);++f}}b=J(b,5);
B(a,b,0,this.m.x+32/6,this.m.y+6+Math.round(Math.sin(this.l*Math.PI*4)),0,64,16,16)}};function Y(a,b,d,c,e=()=>{},f=a.m/2,g=a.l/2){a.type=b;a.speed=d;a.i=c;a.j=e;a.h=0;x(a.g,f,g);a.active=!0}
class cb{constructor(a,b){this.speed=this.h=this.type=0;this.active=this.i=!1;this.j=()=>{};this.g=new y;this.m=a;this.l=b}update(a){this.active&&(this.h+=this.speed*a,this.h>=1&&(--this.h,(this.active=this.i)&&this.j(),this.i=!1))}B(a){if(this.active&&this.type!=0){var b=this.i?this.h:1-this.h;switch(this.type){case 1:a.setColor(`rgba(0,0,0,${b})`);a.fillRect();break;case 2:b=(1-b)*(1-b)*Math.max(Math.hypot(this.g.x,this.g.y),Math.hypot(a.width-this.g.x,this.g.y),Math.hypot(a.width-this.g.x,a.height-
this.g.y),Math.hypot(this.g.x,a.height-this.g.y)),a.setColor("#000000"),da(a,b,this.g.x,this.g.y)}}}isActive(){return this.active}};class db{constructor(a,b){this.i=!1;this.g=0;this.h=new Ta([new X("NEW GAME",()=>{this.j(!0);return!1}),new X("CONTINUE",()=>{this.j(!1);return!1}),new X(N(a),()=>{ka(a);var d=this.h,c=N(a);d.buttons[2].Y=c;c.length>=d.width-2&&(d.width=c.length+2);return!1})],!0);this.j=b;Wa()&&Sa(this.h)}update(a,b,d,c){this.g=(this.g+Math.PI*2/90*c)%(Math.PI*4);this.i?this.h.update(a,b,d,!1):P(a,4).state==3&&(M(b,K(d,10),.7),this.i=!0)}B(a,b){a.setColor("rgba(0,0,0,0.25)");a.fillRect();var d=J(b,10);C(a,d,2,Math.PI*
24,this.g,0,a.width/2-d.width/2,16+Math.round(Math.sin(this.g/2)*4));d=J(b,3);E(a,d,"*2025 JANI NYK@NEN",a.width/2,a.height-10,-1,0,1);this.i?(a.move(0,40),this.h.B(a,b,4,4),a.moveTo()):(b=J(b,4),E(a,b,"PRESS ENTER OR SPACE",a.width/2,a.height-56,-8,0,1,Math.PI*3,4,this.g))}};const eb=["#92dbff","#49b6ff","#248fdb"],fb=[0,2,8],gb=["   HINT: COLLECT ALL GEMS TO WIN THE STAGE.","   HINT: YOU NEED TO KEEP ALL HUMANS ALIVE."],hb=["#000049","#929292","#ffffff"];function Z(a,b){a.D=b;a.l=new Pa(Qa[b-1]);a.X=!1;a.U=0}
function ib(a){const b=1/240;a.P.isActive()?a.P.update(a.controller,a.audio,a.g,!0):(a.T=(a.T+.25*a.A)%352,a.l.A||P(a.controller,8).state!=3?(a.l.update(a.controller,a.audio,a.g,a.A),a.K=(a.K+b)%1,a.l.A?(a.X||(M(a.audio,K(a.g,5),.6),a.X=!0),a.U+=a.A,a.U>=120&&Y(a.j,1,.05,!0,()=>{if(a.D==13)a.i=0,a.u=4;else{var d=a.I;d.j[a.D-1]=!0;Ua(d.j);ab(a.I)?Z(a,13):a.u=1}})):(P(a.controller,5).state==3&&(M(a.audio,K(a.g,9),.6),V(a.l)),P(a.controller,6).state==3&&(M(a.audio,K(a.g,8),.5),U(a.l)))):(M(a.audio,K(a.g,
10),.6),Ra(a.P,0)))}function jb(a){a.i+=a.A;a.i>=300&&Y(a.j,1,1/30,!0,()=>{a.u=1})}function kb(a){a.m==0?a.controller.g&&(M(a.audio,K(a.g,6),.5),++a.m,Y(a.j,1,.05,!1,()=>{})):(a.i+=a.A,(a.i>=90||a.controller.g)&&Y(a.j,1,.05,!0,()=>{++a.m;a.m==3?(Y(a.j,2,1/30,!1,()=>{}),a.u=3):a.i=0}))}
function lb(a){const b=a.h;A(b,"#49b6ff");const d=J(a.g,8);var c=Math.ceil(b.width/d.width)+1;a=a.K*d.width|0;for(let e=0;e<c;++e)B(b,d,0,e*d.width-a,88,0,0,128,64);for(c=0;c<3;++c)b.setColor(eb[c]),a=152+fb[c],b.fillRect(0,a,b.width,b.height-a);B(b,d,0,b.width-56,8,0,64,48,48)}
class mb extends va{constructor(a){super(a);this.U=this.K=0;this.X=!1;this.T=this.m=this.i=0;this.D=1;this.u=2;this.l=new Pa(Qa[this.D-1]);this.P=new Ta([new X("RESUME",()=>!0),new X("UNDO",()=>{U(this.l);return!0}),new X("RESTART",()=>{V(this.l);return!0}),new X(N(this.audio),()=>{ka(this.audio);var b=this.P,d=N(this.audio);b.buttons[3].Y=d;d.length>=b.width-2&&(b.width=d.length+2);return!1}),new X("QUIT",()=>{Y(this.j,1,.05,!0,()=>{this.u=1});return!0})]);this.I=new bb(this.h.width,this.h.height,
b=>{const d=this.I.m.clone();Y(this.j,2,1/30,!0,()=>{this.u=0;Z(this,b+1);this.T=0;x(this.j.g,this.h.width/2,this.h.height/2)},d.x,d.y)});this.ga=new db(this.audio,b=>{Y(this.j,2,1/30,!0,()=>{if(b||!Wa())this.j.active=!1,this.u=5,this.i=this.m=0;else{var d=this.I;d.j.length=0;d.j=Va();ab(this.I)?(Z(this,13),this.u=this.T=0):this.u=1}})});this.j=new cb(this.h.width,this.h.height)}ca(){fa(this.g)}da(){var a=this.g,b=this.audio,d=255/7,c=[];for(var e=0;e<512;++e)c[e]=[(e>>6&7)*d|0,(e>>3&7)*d|0,(e&7)*
d|0,e==4?0:255];var f=J(a,0);d=r(f,Array(64).fill("0002"),c);var g=r(f,Array(64).fill("000M"),c);e=r(f,Array(64).fill("0001"),c);a.F.set(0,f);a.F.set(2,d);a.F.set(3,g);f=new I(d.width*2,d.height*2);g=d.height/8|0;for(var h=0;h<g;++h){var l=h*16+4;for(var k=0;k<16;++k){const n=k*16+4;for(let m=-1;m<=1;++m){for(let q=-1;q<=2;++q)m==0&&q==0||B(f,e,0,n+m,l+q,k*8,h*8,8,8);B(f,d,0,n,l,k*8,h*8,8,8)}}}a.F.set(4,f.i);d=J(a,1);c=r(d,ea,c);a.F.set(5,c);d=["#ffdb6d","#db9224"];e=["#ffff92","#924900"];f=new I(80,
32,!1);for(g=0;g<2;++g)for(h=0;h<10;++h)l=0,k=8,h>=2&&h<=3&&(l=h==2?1:0,k=7),f.setColor(d[Number(h%2==g%2)]),f.fillRect(h*8+l,g*8,k,8),h>=2&&h<=3&&g==0&&(f.setColor(e[Number(h==3)]),f.fillRect(h*8+(h==2?1:6),1,1,7));B(f,c,0,16,0,0,16,64,16);B(f,c,0,0,16,48,8,16,8);B(f,c,2,0,24,48,8,16,8);B(f,c,0,16,16,48,8,16,8,16,8,8,8,Math.PI/2);B(f,c,1,16,16,48,8,16,8,16,8,8,8,Math.PI/2);a.F.set(6,f.i);d=[0,1,0,2];e=[1,2,1,0];f=new I(64,64,!1);f.setColor("#924900");f.fillRect(1,48,14,16);for(g=0;g<4;++g)for(h=
0;h<4;++h)g==2?(B(f,c,0,h*16+2,g*16+2,48,48,12,12),B(f,c,0,h*16+2,g*16+2,h*12,48,12,12)):g==3?B(f,c,0,h*16,g*16,h*16,32,16,16):(l=g*24+d[h]*8,B(f,c,0,h*16,g*16,l,0,8,16),B(f,c,1,h*16+8,g*16,l,0,8,16),g==1&&B(f,c,0,h*16+5,g*16+e[h],48,0,8,8));a.F.set(7,f.i);c=["#248fdb","#92dbff","#ffffff"];d=[0,2,5];e=new I(128,112);for(f=0;f<3;++f)for(e.setColor(c[f]),g=0;g<128;++g)h=(g%16-8)/10,h=1+(1-Math.sqrt(1-h*h)+(1+Math.sin(g/128*Math.PI*2)))*12+d[f],e.fillRect(g,h,1,64-h+1);e.setColor("#ffb600");F(e,24,88,
24,24);e.setColor("#ffff92");F(e,22,86,22,22);a.F.set(8,e.i);c=t("LEVEL\nCLEAR!","bold 24px Arial",96,64,28,4,[[255,219,0],[219,109,0]]);a.F.set(9,c);c=t("GRAVITY","bold 32px Arial",160,40,32,5,[[255,146,0],[182,36,0]]);d=t("CAT","bold 48px Arial",160,64,48,6,[[255,146,0],[182,36,0]],1);e=new I(192,128);B(e,c,0,16,0);B(e,d,0,16,28);a.F.set(10,e.i);c=L(b,[160,4,.6,100,2,.8,256,8,1],.35,0,0);a.L.set(2,c);c=L(b,[128,2,.8,160,3,1,96,12,.6],.6,0,2);a.L.set(1,c);c=L(b,[112,4,1,80,2,.3],.4,0,0);a.L.set(3,
c);c=L(b,[128,4,1,112,3,.9,80,12,.6],.4,2,1);a.L.set(4,c);c=L(b,[130.81,15,.5,146.83,7.5,.7,164.81,7.5,1,174.61,7.5,1,164.81,7.5,1,174.61,15,1,220,40,.8],.3,0,0);a.L.set(5,c);for(f=0;f<2;++f)c=a,d=f==0?6:7,e=L(b,[128-f*8,6+f*2,1,96-f*8,2+f*4,.3],.25,0,0),c.L.set(d,e);c=L(b,[128,5,1,96,3,.4],.4,2,0);a.L.set(8,c);c=L(b,[144,6,.9,96,6,.2],.4,0,0);a.L.set(9,c);b=L(b,[136,10,.9],.3,0,0);a.L.set(10,b)}fa(){const a=1/480;if(this.j.isActive())this.j.update(this.A);else switch(this.u){case 0:ib(this);break;
case 1:this.I.update(this.controller,this.audio,this.g,this.A);break;case 4:jb(this);break;case 3:this.K=(this.K+a*this.A)%1;this.ga.update(this.controller,this.audio,this.g,this.A);break;case 2:kb(this);break;case 5:this.m==1?this.controller.g&&(M(this.audio,K(this.g,6),.5),++this.m,this.i=0):(this.i+=this.A,this.i>=30&&(this.i=0,++this.m,this.m==3&&(this.u=1,Y(this.j,2,1/30,!1))))}}ea(){switch(this.u){case 0:var a=this.h;lb(this);var b=this.l,d=0,c=0;b.g>0&&(d=Math.floor((-1+Math.random()*2)*4),
c=Math.floor((-1+Math.random()*2)*4));a.moveTo(a.width/2-b.width*16/2+d,a.height/2-b.height*16/2+c);b=a;var e=this.g;d=this.l.width*16;c=this.l.height*16;b.setColor("rgba(0,0,0,0.2)");b.fillRect(-4,-4,d+16,c+16);b.setColor(Q[0]);b.fillRect(-8,-8,d+16,c+16);b.setColor(Q[1]);b.fillRect(-7,-7,d+16-2,c+16-2);b.setColor(Q[2]);b.fillRect(-6,-6,d+16-4,c+16-4);b.setColor(Q[3]);b.fillRect(-2,-2,d+4,c+4);b.setColor(Q[0]);b.fillRect(-1,-1,d+2,c+2);e=J(e,5);B(b,e,1,-8,-8,56,0,8,8);B(b,e,0,d,-8,56,0,8,8);B(b,
e,0,-8,c,56,0,8,8);B(b,e,1,d,c,56,0,8,8);this.l.B(a,this.g);a.moveTo();E(a,J(this.g,4),`LEVEL ${this.D}`,a.width/2,5,-7,0,1,Math.PI*2,2,this.K*Math.PI*6);d=this.h;if(!(this.D>gb.length))for(b=J(this.g,3),d.setColor("rgba(0,0,0,0.33)"),d.fillRect(0,d.height-20,d.width,16),c=0;c<2;++c)E(d,b,gb[this.D-1],-this.T+c*352,d.height-16,-1);if(this.P.isActive())this.P.B(a,this.g,2,2,.5);else if(this.l.A){a=this.h;b=J(this.g,9);d=a.width/2-b.width/2;c=a.height/2-b.height/2;e=(a.width/2+b.width/2)*(1-Math.min(1,
this.U/30));a.setColor("rgba(0,0,0,0.40)");a.fillRect();for(var f=0;f<2;++f){const g=b.height/2*f;B(a,b,0,d+(-1+2*(1-f))*e,c+g,0,g,b.width,b.height/2)}}break;case 1:this.I.B(this.h,this.g);break;case 4:a=this.h;A(a,"#000000");b=J(this.g,2);E(a,b,"   CONGRATULATIONS!\n\nYOU HAVE BEATEN THE GAME!\nI HEREBY DECLARE YOU THE\nMASTER OF THE GRAVITY.",a.width/2-87.5,64,-1,4);break;case 3:lb(this);this.ga.B(this.h,this.g);break;case 2:a=this.h;A(a,"#000000");b=J(this.g,2);d=J(this.g,3);c=a.width/2;e=a.height/
2;switch(this.m){case 0:E(a,b,"PRESS ANY KEY",c,e-4,-1,0,1);break;case 1:E(a,d,"A GAME BY",c,e-10,-1,0,1);E(a,b,"JANI NYK@NEN",c,e+2,-1,0,1);break;case 2:E(a,d,"CREATED FOR",c,e-10,-1,0,1),E(a,b,"JS13K 2025",c,e+2,-1,0,1)}break;case 5:a=this.h;b=J(this.g,2);d=J(this.g,3);A(a,"#000000");c=a.width/2-96;e=a.height/2-80;f=this.i/30;this.m==0?e+=a.height*(1-f):this.m==2&&(e-=a.height*f);a.moveTo(c,e);for(c=hb.length-1;c>=0;--c)a.setColor(hb[c]),a.fillRect(-c,-c,192+c*2,160+c*2);E(a,b,"CONTROLS",96,8,-1,
0,1);E(a,d,"CONTROL GRAVITY:",96,32,-1,0,1);E(a,b,"ARROW KEYS OR WASD",96,44,-1,0,1);E(a,d,"UNDO MOVE:",96,64,-1,0,1);E(a,b,"BACKSPACE",96,76,-1,0,1);E(a,d,"RESTART STAGE:",96,96,-1,0,1);E(a,b,"R",96,108,-1,0,1);E(a,d,"PAUSE MENU:",96,128,-1,0,1);E(a,b,"ENTER OR ESCAPE",96,140,-1,0,1);a.moveTo()}this.j.B(this.h)}};window.onload=()=>{var a=new AudioContext;a=new mb(a);a.ca();ua(a,0)};
