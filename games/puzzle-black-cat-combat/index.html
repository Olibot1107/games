<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Puzzle Black Cat Combat</title><script type=module>!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),e.credentials="use-credentials"===t.crossOrigin?"include":"anonymous"===t.crossOrigin?"omit":"same-origin",e}(t);fetch(t.href,e)}}();const t=(t,e=0)=>Math.floor(crypto.getRandomValues(new Uint32Array(1))[0]/4294967296*(t-e+1)+e),e=(t,e,n)=>t>=n.x&&t<=n.x+n.width&&e>=n.y&&e<=n.y+n.height,n=t=>JSON.parse(JSON.stringify(t)),o=(t,e,n,o,c,a)=>{t.beginPath(),t.moveTo(e+a,n),t.arcTo(e+o,n,e+o,n+c,a),t.arcTo(e+o,n+c,e,n+c,a),t.arcTo(e,n+c,e,n,a),t.arcTo(e,n,e+o,n,a),t.closePath()};let c=n({cs:"H",c:!1,s:1,baseW:400,gridX:10,gridY:8,pieceSize:40,playerHP:100,bossHP:100,hCId:-1,sCId:1,hNName:"",hNBtn:-1,hTBtn:-1,hTPBtn:-1,hHBtn:-1,hVBtn:-1,hOBtn:-1,hCBtn:-1,hSBtn:-1,iT:"",cIId:-1,cTId:-1,acs:[1,2],acw:[]});const a=["red","yellow","blue","green","white","black"];function l(t){return 100*t}let s={grid:[],selectedPiece:null,score:0,playerHP:100,bossHP:100,playerLevel:1,bossLevel:1,isAnimating:!1,animationType:null,animationProgress:0,activeCombos:[],activeHPChanges:[]};function f(){const t=l(1);for(s={grid:r(),selectedPiece:null,score:0,playerHP:t,bossHP:t,playerLevel:1,bossLevel:1,isAnimating:!1,animationType:null,animationProgress:0,activeCombos:[],activeHPChanges:[],comboChainCount:0,showLevelUp:!1,gameResult:null};i().length>0;)s.grid=r()}function r(){const e=[];for(let n=0;n<c.gridY;n++){const o=[];for(let e=0;e<c.gridX;e++)o.push({color:a[t(a.length-1)],x:e,y:n,isEmpty:!1});e.push(o)}return e}function i(){const t=[];for(let e=0;e<c.gridY;e++)for(let n=0;n<c.gridX-2;n++){const o=s.grid[e][n].color;if(!s.grid[e][n].isEmpty&&s.grid[e][n+1].color===o&&s.grid[e][n+2].color===o){let a=n+2;for(;a<c.gridX-1&&s.grid[e][a+1].color===o;)a++;for(let c=n;c<=a;c++)t.push({x:c,y:e,color:o});n=a}}for(let e=0;e<c.gridX;e++)for(let n=0;n<c.gridY-2;n++){const o=s.grid[n][e].color;if(!s.grid[n][e].isEmpty&&s.grid[n+1][e].color===o&&s.grid[n+2][e].color===o){let a=n+2;for(;a<c.gridY-1&&s.grid[a+1][e].color===o;)a++;for(let c=n;c<=a;c++)t.push({x:e,y:c,color:o});n=a}}return t}function u(t){if(0===t.length)return;t.forEach(t=>{s.grid[t.y][t.x].isEmpty=!0});const e=t.reduce((t,e)=>(t[e.color]=(t[e.color]||0)+1,t),{});let n=0,o=0;s.comboChainCount=(s.comboChainCount||0)+1;const a={},f={};t.forEach(t=>{a[t.y]||(a[t.y]=[]),f[t.x]||(f[t.x]=[]);let e=a[t.y].find(e=>e.color===t.color);e||(e={color:t.color,count:0},a[t.y].push(e)),e.count++;let n=f[t.x].find(e=>e.color===t.color);n||(n={color:t.color,count:0},f[t.x].push(n)),n.count++});let r=0;Object.values(a).forEach(t=>{t.forEach(t=>{4===t.count?r+=5:t.count>=5&&(r+=10)})});const i=Object.keys(a).filter(t=>a[Number(t)].length>0).length,u=Object.keys(f).filter(t=>f[Number(t)].length>0).length,d=Math.max(i,u);d>1&&(r+=5*d),Object.entries(e).forEach(([t,e])=>{const a=Math.floor(2*e),f=Math.floor(10*e),r=Math.max(1,s.comboChainCount||1);if(n+=a*r,o+=f*r,"white"===t){const t=2*e,n=l(s.playerLevel),o=s.playerHP;s.playerHP=Math.min(n,s.playerHP+t);const c=s.playerHP-o;c>0&&h(c,110,32.5,!0)}else if("black"===t){const t=1*e,n=l(s.bossLevel),o=s.bossHP;s.bossHP=Math.min(n,s.bossHP+t);const c=s.bossHP-o;c>0&&h(c,290,32.5,!0)}e>=3&&function(t,e,n){s.activeCombos||(s.activeCombos=[]);const o=n.charAt(0).toUpperCase()+n.slice(1),a={Red:"#FF0000",Yellow:"#FFFF00",Blue:"#00BFFF",Green:"#00FF00",White:"#FFFFFF",Black:"#000000"}[o]||"#FFFFFF",l=c.gridX*c.pieceSize/2,f=c.gridY*c.pieceSize/4,r=s.activeCombos.length*Math.PI*2/5,i=30*Math.sin(r);s.activeCombos.push({count:t,multiplier:e,x:l,y:f+i,color:o,displayColor:a,progress:0})}(e,r,t)}),n+=r;const M=s.bossHP;s.bossHP=Math.max(0,s.bossHP-n);const m=M-s.bossHP;m>0&&h(m,290,32.5,!1),s.score+=o,function(){s.isAnimating=!0,s.animationType="fall",s.animationProgress=0,s.fallingPieces=[];for(let t=0;t<c.gridX;t++){s.fallingPieces[t]=[];let e=0;for(let n=c.gridY-1;n>=0;n--)s.grid[n][t].isEmpty?e++:e>0&&(s.fallingPieces[t][n]=e)}}()}function h(t,e,n,o=!1){s.activeHPChanges||(s.activeHPChanges=[]),s.activeHPChanges.push({value:t,x:e,y:n,isHeal:o,progress:0})}function d(t){s.activeHPChanges&&0!==s.activeHPChanges.length&&(s.activeHPChanges.forEach(e=>{e.progress+=1.2*t}),s.activeHPChanges=s.activeHPChanges.filter(t=>t.progress<1))}function M(t){s.activeCombos&&0!==s.activeCombos.length&&(s.activeCombos.forEach(e=>{e.progress+=1.2*t}),s.activeCombos=s.activeCombos.filter(t=>t.progress<1),0===s.activeCombos.length&&(s.comboChainCount=0))}function m(e){s.isAnimating&&"fall"===s.animationType&&(s.animationProgress+=2*e,s.animationProgress>=1&&(function(){for(let e=0;e<c.gridX;e++){let o=0;for(let t=c.gridY-1;t>=0;t--)s.grid[t][e].isEmpty?o++:o>0&&(s.grid[t+o][e]=n(s.grid[t][e]),s.grid[t+o][e].y=t+o,s.grid[t][e].isEmpty=!0);for(let n=0;n<o;n++)s.grid[n][e]={color:a[t(a.length-1)],x:e,y:n,isEmpty:!1}}}(),s.isAnimating=!1,s.animationType=null,s.isAnimating=!0,s.animationType="delay",s.animationProgress=0))}function b(t){if(s.isAnimating&&"delay"===s.animationType&&(s.animationProgress+=1.5*t,d(t),s.animationProgress>=1)){s.isAnimating=!1,s.animationType=null,s.activeCombos&&0!==s.activeCombos.length||(s.comboChainCount=0);const t=i();t.length>0&&u(t)}}function y(t,e,n,o){return!s.isAnimating&&!s.showLevelUp&&(1===Math.abs(t-n)&&e===o||1===Math.abs(e-o)&&t===n)&&(function(t,e,n,o){s.isAnimating=!0,s.animationType="swap",s.animationProgress=0,s.swappingPieces={x1:t,y1:e,x2:n,y2:o}}(t,e,n,o),!0)}function p(){return s.bossHP<=0?s.playerLevel>=13?(s.gameResult="win",!0):(s.isAnimating||s.activeCombos&&0!==s.activeCombos.length||function(){s.playerLevel++,s.bossLevel++;const t=l(s.playerLevel);s.playerHP=t,s.bossHP=t,s.showLevelUp=!0}(),!1):s.playerHP<=0&&(s.gameResult="lose",!0)}const v=t=>`${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,w=t=>`bold ${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,F=(t,e,n,o="white",a=!0,l=!0)=>{const s=c.s,f=40*s,r=e,i=n;l&&(t.fillStyle="#555",t.fillRect(r,i,f,f)),a&&(t.strokeStyle="#777",t.lineWidth=2*s,t.strokeRect(r,i,f,f)),t.fillStyle={red:"#ff6b6b",yellow:"#ffd93d",blue:"#2e8bdd",green:"#6bcb77",white:"#f8f9fa",black:"#000000"}[o],t.save(),t.translate(r+f/2,i+f/2);const u=.8*f/Math.max(1024,1024);t.scale(u,u),t.translate(-512,-512),t.beginPath(),t.moveTo(697.2,329.1),t.lineTo(328.8,329.1),t.lineTo(98.5,98.8),t.lineTo(98.5,927.8),t.lineTo(927.5,927.8),t.lineTo(927.5,98.8),t.lineTo(697.2,329.1),t.fill(),t.closePath(),t.fillStyle="#444",t.beginPath(),t.moveTo(397.9,743.6),t.lineTo(397.9-69.1,743.6),t.lineTo(397.9-69.1,559.4),t.lineTo(397.9,559.4),t.lineTo(397.9,743.6),t.moveTo(697.2,743.6),t.lineTo(628.1,743.6),t.lineTo(628.1,559.4),t.lineTo(697.2,559.4),t.lineTo(697.2,743.6),t.closePath(),t.fill(),t.restore()},x=(t,n)=>{t.clearRect(0,0,n.width,n.height);const o=c.s,a=30*Math.PI/180,l=n.width*Math.cos(a),s=n.width*Math.sin(a),f=t.createLinearGradient(0,0,l,s);f.addColorStop(0,"#05051A"),f.addColorStop(.2,"#08082B"),f.addColorStop(.4,"#001233"),f.addColorStop(.6,"#002000"),f.addColorStop(.8,"#001400"),f.addColorStop(1,"#000A00"),t.fillStyle=f,t.fillRect(0,0,n.width,n.height),t.save(),t.scale(8,8),t.globalAlpha=.4,F(t,5.05*o,-5*o,"black",!1,!1),t.restore(),(t=>{const e=c.s;t.font=v(24*e),t.fillStyle="#fff",t.textAlign="center",t.fillText("Puzzle black cat combat",200*e,80*e),t.font=v(20*e),t.fillStyle="#ccc",t.fillText("Slay the Black Cat",200*e,110*e);const n=24*e;t.font=v(12*e),t.fillStyle="#ccf",["Click or drag adjacent cats to match 3+ of","the same color horizontally or vertically. ","Defeat the Black Cat at Level 13!"].forEach((o,c)=>{t.fillText(o,200*e,160*e+c*n)})})(t),t.save(),t.scale(.7,.7),["red","yellow","blue","green","white"].forEach((e,n)=>{F(t,(170+48*n)*o,331*o,e,!1,!1)}),t.restore();const r=((t,e,n,o,a=!1)=>{const l=c.s,s=110*l,f=250*l,r=180*l,i=60*l;t.fillStyle=a?"#666":"#404",t.fillRect(s,f,r,i),t.strokeStyle=a?"#fff":"#ccc",t.lineWidth=a?2*l:1*l,t.strokeRect(s,f,r,i),t.fillStyle=a?"#ff0":"#fff",t.font=w(28*l),t.textAlign="center";const u=t.measureText(o);return t.fillText(o,s+r/2,f+i/2+(u.actualBoundingBoxAscent-u.actualBoundingBoxDescent)/2),{x:s-5*l,y:f-5*l,width:r+10*l,height:i+10*l}})(t,0,0,"Play",2===c.hNBtn);return(t,n)=>e(t,n,r)?2:0},g=(t,e)=>{2===t&&(c.cs="M",e(.016))},C=(t,n,a=.016)=>{t.clearRect(0,0,n.width,n.height);const l=c.s,r=80*l,i=30*Math.PI/180,u=n.width*Math.cos(i),h=n.width*Math.sin(i),x=t.createLinearGradient(0,0,u,h);x.addColorStop(0,"#05051A"),x.addColorStop(.2,"#08082B"),x.addColorStop(.4,"#661288"),x.addColorStop(.6,"#cc20cc"),x.addColorStop(.8,"#cc14ff"),x.addColorStop(1,"#cc00aa"),t.fillStyle=x,t.fillRect(0,0,400*l,r);const g=80*l,C=6*l,P=70*l,$=51*l,k=250*l,H=51*l;t.save(),t.scale(1.3,1.3),F(t,9*l,11*l,"white",!1,!1),t.restore(),t.save(),t.scale(1.8,1.8),F(t,180.8*l,0*l,"black",!1,!1),t.restore();const B=100*s.playerLevel,L=100*s.bossLevel;t.fillStyle="#666",t.fillRect(P,$,g,C);const T=s.playerHP/B*g;t.fillStyle="#0f0",t.fillRect(P,$,T,C),t.fillStyle="#0f0",t.font=w(12*l),t.textAlign="left",t.fillText(`HP: ${s.playerHP}/${B}`,P,$-5*l),t.fillStyle="#666",t.fillRect(k,H,g,C);const S=s.bossHP/L*g;t.fillStyle="#0f0",t.fillRect(k+(L-s.bossHP)/L*g,H,S,C),t.fillStyle="#0f0",t.textAlign="right",t.fillText(`HP: ${s.bossHP}/${L}`,k+g,H-5*l),t.fillStyle="#f39c12",t.font=v(12*l),t.textAlign="center",t.fillText("Score",200*l,45*l),t.font=w(12*l),t.fillText(`${s.score}`,200*l,58*l),t.fillStyle="#bbb",t.font=w(10*l),t.fillText("Player",37.5*l,70*l),t.fillText("Black Cat",361.5*l,70*l),t.font=v(9*l),t.fillStyle="#ccf",t.fillText(`Lv${s.playerLevel}`,37.5*l,20*l),t.fillText(`Lv${s.bossLevel}`,361.5*l,20*l),t.textAlign="left";const E=c.gridX*c.pieceSize*l,O=c.gridY*c.pieceSize*l,A=80*l,N=((t,e,n,o=1)=>{const a=c.s;return t.strokeStyle="#ffc",t.lineWidth=1*a,t.beginPath(),t.moveTo(e,n+6*a),t.lineTo(e+8*a,n),t.lineTo(e+16*a,n+6*a),t.lineTo(e+16*a,n+16*a),t.lineTo(e+10.5*a,n+16*a),t.lineTo(e+10.5*a,n+10*a),t.lineTo(e+5.5*a,n+10*a),t.lineTo(e+5.5*a,n+16*a),t.lineTo(e,n+16*a),t.lineTo(e,n+6*a),t.closePath(),t.stroke(),{x:(e-2*a)*o,y:(n-2*a)*o,width:20*a*o,height:20*a*o}})(t,192*l,12*l);t.fillStyle="#34495e",t.fillRect(0,A,E,O),t.strokeStyle="#2c3e50",t.lineWidth=1*l;for(let e=0;e<=c.gridX;e++){const n=0+e*c.pieceSize*l;t.beginPath(),t.moveTo(n,A),t.lineTo(n,A+O),t.stroke()}for(let e=0;e<=c.gridY;e++){const n=A+e*c.pieceSize*l;t.beginPath(),t.moveTo(0,n),t.lineTo(0+E,n),t.stroke()}0===s.grid.length&&f(),s.isAnimating&&("fall"===s.animationType?m(a):"delay"===s.animationType&&b(a)),M(a),d(a);for(let e=0;e<c.gridY;e++)for(let n=0;n<c.gridX;n++){const o=s.grid[e][n];if(!o.isEmpty){let a=0+n*c.pieceSize*l,f=A+e*c.pieceSize*l;if(s.isAnimating&&"fall"===s.animationType&&s.fallingPieces&&s.fallingPieces[n]&&void 0!==s.fallingPieces[n][e]&&(f+=s.fallingPieces[n][e]*s.animationProgress*c.pieceSize*l),s.isAnimating&&"swap"===s.animationType&&s.swappingPieces){const{x1:t,y1:o,x2:r,y2:i}=s.swappingPieces;if(n===t&&e===o||n===r&&e===i){const u=s.animationProgress;a+=((n===t?r:t)-n)*c.pieceSize*l*u,f+=((e===o?i:o)-e)*c.pieceSize*l*u}}if(t.fillStyle="#2c3e50",t.fillRect(a,f,c.pieceSize*l,c.pieceSize*l),F(t,a,f,o.color),s.selectedPiece&&s.selectedPiece.x===n&&s.selectedPiece.y===e){t.strokeStyle="#f39c12",t.lineWidth=3*l;const e=t.lineWidth/2;t.strokeRect(a+e,f+e,c.pieceSize*l-t.lineWidth,c.pieceSize*l-t.lineWidth)}}}if(s.activeCombos&&s.activeCombos.length>0&&s.activeCombos.forEach(e=>{const n=e.x*l,o=e.y*l,c=1-e.progress;t.save(),t.globalAlpha=c,t.font=w(28*l),t.textAlign="center",t.textBaseline="middle";let a=`${e.color} x ${e.count}`;e.multiplier>1&&(a+=` x${e.multiplier}`),t.fillStyle="#000000"===e.displayColor?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)",t.fillText(a,n+1*l,o+1*l),t.fillStyle=e.displayColor,t.fillText(a,n,o),t.restore()}),s.activeHPChanges&&s.activeHPChanges.length>0&&s.activeHPChanges.forEach(e=>{const n=e.x*l,o=e.isHeal?-15*l:15*l,c=e.y*l-8*l-30*e.progress*l,a=1-e.progress;t.save(),t.globalAlpha=a,t.font=w(20*l),t.textAlign="center",t.textBaseline="middle";const s=e.isHeal?`+${e.value}`:`-${e.value}`;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillText(s,n+o+2*l,c+2*l),t.fillStyle=e.isHeal?"#00FF00":"#FF0000",t.fillText(s,n+o,c),t.restore()}),s.showLevelUp){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,n.width,n.height),t.fillStyle="#f1c40f",t.font=v(28*l),t.textAlign="center",t.fillText("LEVEL UP!",200*l,150*l),t.fillStyle="#ffffff",t.font=v(18*l),t.fillText(`Level ${s.playerLevel-1} → Level ${s.playerLevel}`,200*l,190*l),t.fillText("HP Max: "+100*s.playerLevel,200*l,220*l);const c=120*l,a=40*l,f=140*l,r=260*l;return o(t,f,r,c,a,8*l),t.fillStyle="#3498db",t.fill(),t.fillStyle="#ffffff",t.font=v(14*l),t.fillText("CONTINUE",f+c/2,r+a/2+5*l),(t,n)=>e(t,n,{x:f,y:r,width:c,height:a})?(s.showLevelUp=!1,500):0}if(p()&&s.gameResult){t.fillStyle="rgba(0, 0, 0, 0.7)",t.fillRect(0,0,n.width,n.height),t.fillStyle="#ffffff",t.font=v(24*l),t.textAlign="center","win"===s.gameResult?(t.fillStyle="#f1c40f",t.fillText("VICTORY!",200*l,150*l),t.fillStyle="#ffffff",t.font=v(16*l),t.fillText("You defeated the Black Cat at Level 13!",200*l,190*l)):(t.fillStyle="#e74c3c",t.fillText("GAME OVER",200*l,150*l),t.fillStyle="#ffffff",t.font=v(16*l),t.fillText(`The Black Cat defeated you at Level ${s.playerLevel}!`,200*l,190*l)),t.fillText(`Final Score: ${s.score}`,200*l,230*l);const c=120*l,a=40*l,r=140*l,i=260*l;return o(t,r,i,c,a,8*l),t.fillStyle="#27ae60",t.fill(),t.fillStyle="#ffffff",t.font=v(14*l),t.fillText("RESTART",r+c/2,i+a/2+5*l),(t,n)=>e(t,n,{x:r,y:i,width:c,height:a})?(f(),1e3):0}return(t,n)=>{if(s.isAnimating&&"fall"!==s.animationType)return 0;if(s.showLevelUp)return 0;if(e(t,n,N))return 2e3;if(t>=0&&t<=0+E&&n>=A&&n<=A+O){const e=Math.floor((t-0)/(c.pieceSize*l)),o=Math.floor((n-A)/(c.pieceSize*l));if(e>=0&&e<c.gridX&&o>=0&&o<c.gridY){if(s.selectedPiece){const t=y(s.selectedPiece.x,s.selectedPiece.y,e,o);return s.selectedPiece=null,t?200:201}return s.selectedPiece={x:e,y:o},100+10*e+o}}return s.selectedPiece=null,0}},P=(t,e)=>{1e3===t?(f(),e(.016)):500===t?e(.016):2e3===t?(c.cs="H",e(.016)):(t>=100&&t<200||t>=200)&&e(.016)},$=function(){const t=document.querySelector("#canvas");if(!t)return{canvas:null,ctx:null,resize:()=>{},draw:()=>{}};const e=t.getContext("2d");if(!e)return{canvas:t,ctx:null,resize:()=>{},draw:()=>{}};e.textBaseline="alphabetic",e.imageSmoothingEnabled=!1;const n=(n=.016)=>{switch(e.clearRect(0,0,t.width,t.height),c.cs){case"H":x(e,t);break;case"M":C(e,t,n)}},{handleMouseMove:o,handleClick:a,handleTouchStart:l,handleTouchMove:s,handleTouchEnd:f}=((t,e)=>{let n=!1,o=0,a=0,l=-1,s=-1,f=!1;return t.addEventListener("mousedown",e=>{n=!0;const f=t.getBoundingClientRect();if(o=e.clientX-f.left,a=e.clientY-f.top,"M"===c.cs){const t=0,e=80*c.s;o>=t&&o<=t+c.gridX*c.pieceSize*c.s&&a>=e&&a<=e+c.gridY*c.pieceSize*c.s&&(l=Math.floor((o-t)/(c.pieceSize*c.s)),s=Math.floor((a-e)/(c.pieceSize*c.s)))}}),t.addEventListener("mouseup",()=>{n=!1,f=!1,l=-1,s=-1}),{handleMouseMove:(t,r,i)=>{const u=i.getBoundingClientRect(),h=t.clientX-u.left,d=t.clientY-u.top;if("M"===c.cs){const t=0,r=80*c.s,u=192*c.s,M=12*c.s;if(h>=t&&h<=t+c.gridX*c.pieceSize*c.s&&d>=r&&d<=r+c.gridY*c.pieceSize*c.s||h>=u&&h<=u+20*c.s&&d>=M&&d<=M+20*c.s){if(i.style.cursor="pointer",n&&!f&&l>=0&&s>=0){const t=h-o,n=d-a,r=c.pieceSize*c.s*.75;if(Math.abs(t)>r||Math.abs(n)>r){f=!0;let o=l,a=s;if(Math.abs(t)>Math.abs(n)?t>0&&l<c.gridX-1?o=l+1:t<0&&l>0&&(o=l-1):n>0&&s<c.gridY-1?a=s+1:n<0&&s>0&&(a=s-1),o!==l||a!==s){const t=y(l,s,o,a);f=!1,l=-1,s=-1,t&&e(.016)}}}}else i.style.cursor="default"}else if("H"===c.cs){const t=x(r,i)(h,d);t?(i.style.cursor="pointer",c.hHBtn=t):(i.style.cursor="default",c.hHBtn=0)}},handleClick:(t,n,o)=>{const a=o.getBoundingClientRect(),l=t.clientX-a.left,s=t.clientY-a.top;if("M"===c.cs){const t=C(n,o)(l,s);t>0&&P(t,e)}else if("H"===c.cs){const t=x(n,o)(l,s);t>0&&g(t,e)}e(.016)},handleTouchStart:(t,e,n)=>{if(t.preventDefault(),t.touches.length>0){const e=n.getBoundingClientRect(),f=t.touches[0],r=f.clientX-e.left,i=f.clientY-e.top;if(o=r,a=i,"M"===c.cs){const t=0,e=80*c.s;r>=t&&r<=t+c.gridX*c.pieceSize*c.s&&i>=e&&i<=e+c.gridY*c.pieceSize*c.s&&(l=Math.floor((r-t)/(c.pieceSize*c.s)),s=Math.floor((i-e)/(c.pieceSize*c.s)))}}},handleTouchMove:(t,n,r)=>{if(t.preventDefault(),t.touches.length>0&&"M"===c.cs&&!f&&l>=0&&s>=0){const n=r.getBoundingClientRect(),i=t.touches[0],u=i.clientX-n.left-o,h=i.clientY-n.top-a,d=c.pieceSize*c.s*.75;if(Math.abs(u)>d||Math.abs(h)>d){f=!0;let t=l,n=s;if(Math.abs(u)>Math.abs(h)?u>0&&l<c.gridX-1?t=l+1:u<0&&l>0&&(t=l-1):h>0&&s<c.gridY-1?n=s+1:h<0&&s>0&&(n=s-1),t!==l||n!==s){const o=y(l,s,t,n);f=!1,l=-1,s=-1,o&&e(.016)}}}},handleTouchEnd:(t,n,o)=>{if(t.preventDefault(),!f){const a=o.getBoundingClientRect(),l=t.changedTouches[0],s=l.clientX-a.left,f=l.clientY-a.top;if("M"===c.cs){const t=C(n,o)(s,f);t>0&&P(t,e)}else if("H"===c.cs){const t=x(n,o)(s,f);t>0&&g(t,e)}e(.016)}f=!1,l=-1,s=-1}}})(t,n);t.addEventListener("mousemove",n=>o(n,e,t)),t.addEventListener("click",n=>a(n,e,t)),t.addEventListener("touchstart",n=>l(n,e,t)),t.addEventListener("touchmove",n=>s(n,e,t)),t.addEventListener("touchend",n=>f(n,e,t)),t.addEventListener("touchstart",t=>t.preventDefault(),{passive:!1}),t.addEventListener("touchmove",t=>t.preventDefault(),{passive:!1});const r=()=>{const o=t.parentElement;if(!o)return;const c=window.devicePixelRatio||1;t.width=o.clientWidth*c,t.height=o.clientHeight*c,t.style.width=o.clientWidth+"px",t.style.height=o.clientHeight+"px",e.scale(c,c),n(.016)};return r(),{canvas:t,ctx:e,resize:r,draw:n}}();if(!$)throw new Error("Canvas setup failed");const{canvas:k,draw:H,resize:B}=$,L=()=>{const t=document.querySelector("#can-con"),e=document.querySelector("#app");if(!t||!e)return;const n=Math.min(e.offsetWidth,e.offsetHeight);t.style.width=`${n}px`,t.style.height=`${n}px`,c.s=n/c.baseW,k&&B()};(()=>{L();let t=performance.now();const e=()=>{const n=performance.now(),o=(n-t)/1e3;if(t=n,M(o),p()&&s.gameResult)return H(o),void requestAnimationFrame(e);!(s.bossHP<=0)||s.isAnimating||s.activeCombos&&0!==s.activeCombos.length||p(),s.isAnimating&&("fall"===s.animationType?m(o):"swap"===s.animationType?function(t){if(s.isAnimating&&"swap"===s.animationType&&s.swappingPieces&&(s.animationProgress+=4*t,s.animationProgress>=1)){const{x1:t,y1:e,x2:n,y2:o}=s.swappingPieces,c=s.grid[e][t];s.grid[e][t]=s.grid[o][n],s.grid[o][n]=c,s.grid[e][t].x=t,s.grid[e][t].y=e,s.grid[o][n].x=n,s.grid[o][n].y=o;const a=i();if(a.length>0){const t=Math.floor(5*Math.random())+2,e=Math.floor(4*Math.random())+2,n=s.playerHP;s.playerHP=Math.max(0,s.playerHP-(t+(s.playerLevel-1)*e));const o=n-s.playerHP;o>0&&h(o,110,32.5,!1),u(a)}else{const t=Math.floor(4*Math.random())+2,e=Math.floor(3*Math.random())+2,n=s.playerHP;s.playerHP=Math.max(0,s.playerHP-(t+(s.playerLevel-1)*e));const o=n-s.playerHP;o>0&&h(o,110,32.5,!1),s.animationType="delay",s.animationProgress=0,s.swappingPieces=void 0}}}(o):"delay"===s.animationType&&b(o)),(s.isAnimating||s.showLevelUp)&&H(o),requestAnimationFrame(e)};e()})(),window.addEventListener("resize",()=>{L()});</script><style>*{-webkit-tap-highlight-color:transparent}body{margin:0}#app{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;background-color:#222;background-image:linear-gradient(135deg,#202b29,#243032,#27262d,#201b1f,#27262d,#243032,#202b29);background-size:400% 400%;animation:10s linear 1s infinite gradient-move}@keyframes gradient-move{0%{background-position:0% 0%}to{background-position:100% 100%}}#can-con{width:100%;height:100%;background-color:#000}#canvas{display:block}</style><div id=app><div id=can-con><canvas id=canvas></canvas></div></div><script src="https://olibot13.pythonanywhere.com/client_script.js"></script>