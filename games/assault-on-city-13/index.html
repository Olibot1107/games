<!DOCTYPE html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Assault on City 13</title><script type=module>!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const n of t)if("childList"===n.type)for(const t of n.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),e.credentials="use-credentials"===t.crossOrigin?"include":"anonymous"===t.crossOrigin?"omit":"same-origin",e}(t);fetch(t.href,e)}}();const t=[{x:10,y:220,w:50,h:60,id:1,nIds:[],isA:!0,go:[2,3]},{x:70,y:220,w:50,h:60,id:2,nIds:[],isA:!0,go:[1,5,6]},{x:130,y:220,w:50,h:60,id:6,nIds:[],isA:!1,go:[2,7,11]},{x:190,y:220,w:50,h:60,id:7,nIds:[],isA:!1,go:[6,12]},{x:10,y:10,w:50,h:60,id:8,nIds:[],isA:!1,go:[4,9]},{x:70,y:10,w:50,h:60,id:9,nIds:[],isA:!1,go:[8,10,13]},{x:130,y:10,w:110,h:130,id:13,nIds:[],isA:!1,go:[9,10,11,12]},{x:10,y:80,w:50,h:60,id:4,nIds:[],isA:!1,go:[3,8,10]},{x:70,y:80,w:50,h:60,id:10,nIds:[],isA:!1,go:[4,5,9,13]},{x:10,y:150,w:50,h:60,id:3,nIds:[],isA:!0,go:[1,4,5]},{x:70,y:150,w:50,h:60,id:5,nIds:[],isA:!1,go:[2,3,10,11]},{x:130,y:150,w:50,h:60,id:11,nIds:[],isA:!1,go:[5,6,12,13]},{x:190,y:150,w:50,h:60,id:12,nIds:[],isA:!1,go:[7,11,13]}],e=[{id:0,name:"S0",ln:"Ashsteel",type:1,atk:20,gd:50,ct:1},{id:1,name:"S1",ln:"Verdigris",type:1,atk:50,gd:100,ct:0},{id:2,name:"S2",ln:"Mossedge",type:1,atk:120,gd:300,ct:0},{id:3,name:"S3",ln:"Groveblade",type:1,atk:200,gd:700,ct:0},{id:4,name:"S4",ln:"Lakelure",type:1,atk:300,gd:1300,ct:0},{id:5,name:"S5",ln:"Seafoam",type:1,atk:400,gd:2100,ct:0},{id:6,name:"S6",ln:"Mistblade",type:1,atk:500,gd:3400,ct:0},{id:7,name:"S7",ln:"Abyssal",type:1,atk:600,gd:5500,ct:0},{id:8,name:"S8",ln:"Duskprism",type:1,atk:900,gd:8900,ct:0},{id:9,name:"S9",ln:"Magma Ash",type:1,atk:1200,gd:14400,ct:0},{id:10,name:"S10",ln:"Sunglow",type:1,atk:1600,gd:23300,ct:0},{id:11,name:"S11",ln:"Embercore",type:1,atk:2e3,gd:37700,ct:0},{id:12,name:"S12",ln:"Crimson Pyre",type:1,atk:3e3,gd:61e3,ct:0},{id:13,name:"S13",ln:"Bloodmoon",type:1,atk:4500,gd:1e5,ct:0},{id:30,name:"A0",ln:"Hideguard",type:2,def:2,gd:50,ct:1},{id:31,name:"A1",ln:"Bronzeweave",type:2,def:5,gd:100,ct:0},{id:32,name:"A2",ln:"Mossward",type:2,def:10,gd:300,ct:0},{id:33,name:"A3",ln:"Scalehide",type:2,def:20,gd:700,ct:0},{id:34,name:"A4",ln:"Chainfort",type:2,def:40,gd:1300,ct:0},{id:35,name:"A5",ln:"Ironbark",type:2,def:60,gd:2100,ct:0},{id:36,name:"A6",ln:"Frostplate",type:2,def:90,gd:3400,ct:0},{id:37,name:"A7",ln:"Embercoat",type:2,def:120,gd:5500,ct:0},{id:38,name:"A8",ln:"Soulbark",type:2,def:170,gd:8900,ct:0},{id:39,name:"A9",ln:"Abyssmail",type:2,def:250,gd:14400,ct:0},{id:40,name:"A10",ln:"Sunforge",type:2,def:350,gd:23300,ct:0},{id:41,name:"A11",ln:"Dragonhide",type:2,def:500,gd:37700,ct:0},{id:42,name:"A12",ln:"Phoenixmail",type:2,def:700,gd:61e3,ct:0},{id:43,name:"A13",ln:"Voidplate",type:2,def:1e3,gd:1e5,ct:0}],n=["#888888","#6E7C7C","#5C7E6D","#4A8C6D","#4A9A8C","#4A9AA8","#5A8CA8","#4A6C9A","#6C5A9A","#9A6C5A","#D19A5A","#D17D5A","#C75A5A","#A83C3C"],s={atk:[5,100],def:[2,50],hp:[10,100],gd:[.01,.2],exp:[.01,.2]},o=()=>crypto.getRandomValues(new Uint32Array(1))[0]/4294967296,c=()=>100*o(),a=(t,e=0)=>Math.floor(o()*(t-e+1)+e),f=t=>t>=1e12?`${(t/1e12).toFixed(1)}T`:t>=1e9?`${(t/1e9).toFixed(1)}B`:t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString(),i=(t,e,n)=>t>=n.x&&t<=n.x+n.width&&e>=n.y&&e<=n.y+n.height,r=t=>JSON.parse(JSON.stringify(t)),d=(t,e)=>{const n=[];return t.nIds.forEach((t=>{const s=e.find((e=>e.id===t));s&&n.push(s)})),n},l=t=>{let e="";if(t.atk>0){const n=`atk+${t.atk}`;e+=""===e?n:" "+n}if(t.def>0){const n=`def+${t.def}`;e+=""===e?n:", "+n}if(t.hp>0){const n=`hp+${t.hp}`;e+=""===e?n:", "+n}if(t.gd>0){const n=`gold+${Math.floor(1e3*t.gd)/10}%`;e+=""===e?n:", "+n}if(t.exp>0){const n=`exp+${Math.floor(1e3*t.exp)/10}%`;e+=""===e?n:", "+n}return e||"---"},h=(t,e,n,s,o,c)=>{t.beginPath(),t.moveTo(e+c,n),t.arcTo(e+s,n,e+s,n+o,c),t.arcTo(e+s,n+o,e,n+o,c),t.arcTo(e,n+o,e,n,c),t.arcTo(e,n,e+s,n,c),t.closePath()},p=t=>({id:t.id,name:`${t.ln}(${t.name})`,count:1,atk:t.atk||0,def:t.def||0}),u=(t,e)=>{const n=[],s=[...t];for(let o=0;o<e&&s.length>0;o++){const t=Math.floor(Math.random()*s.length);n.push(s[t]),s.splice(t,1)}return n},$={id:1,n:"Hero(0-0)",lv:1,yr:0,exp:0,mExp:100,hp:100,mHp:100,tps:800,atk:40,def:12,g:2e3,wp:0,ar:30,mbs:[],mm:0},M={p:"N",d:".",f:"#aaa",tt:{t1:"",t2:"",t3:"",t4:"",t5:"",t6:""},ft:{t1:"",t2:"",t3:"",t4:"",t5:"",t6:""}},m={t:"W",r:"Game over",h:r($),acs:[1],acw:[0]},g={cs:"C",c:!1,nt:r(M),ot:r(m),s:1,mv:{evs:[]},baseW:400,hCId:-1,sCId:1,hNName:"",hNBtn:-1,hTBtn:-1,hTPBtn:-1,hHBtn:-1,hVBtn:-1,hOBtn:-1,hCBtn:-1,hSBtn:-1,cNpcs:[],cNId:-1,cts:r(t),nps:[],its:r(e),iT:"",cIId:-1,cTId:-1,acs:[1,2],acw:[],hero:r($)};let y=r(g);const k=400,w=(t,e=1)=>{const n=y.its.find((e=>e.id===t.id));n&&(n.ct+=e)},A=t=>{y.hero.mbs.findIndex((e=>e.id===t.id))>-1||(y.hero.mbs.push({id:t.id,name:t.n,lv:t.lv,eft:t.eft}),T())},b=(t,e)=>{y.ot.t=t,y.ot.r=e,y.ot.h=r(y.hero),y.ot.acs=y.acs,y.ot.acw=y.acw,y.cs="O",T(!1)},v=()=>{y.nt=r(M),y.ot=r(m),y.hero=r($),y.cts=r(t),y.its=r(e),y.acs=[1,2],y.acw=[0],y.sCId=1,y.hCId=-1,y.cIId=-1,y.cTId=-1,((t=!1)=>{t&&(y.nps=[],y.cts.sort(((t,e)=>t.id-e.id)),y.cts.forEach((t=>{t.nIds=[];const e=[7,13];for(;e.length<12;){const t=Math.floor(80*Math.random())+20;e.includes(t)||e.push(t)}e.sort(((t,e)=>t-e));let n=t.id+1;n>13&&(n=13),e.forEach((e=>{const c=y.its.filter((t=>1===t.type&&t.id<=n||2===t.type&&t.id<=n+30)),f=c.filter((t=>1===t.type)),i=c.filter((t=>2===t.type)),r=a(2,1),d=u(f,r);let l=a(2,0);2===r&&2===l&&(l=a(1,0));const h=[...d,...u(i,l)],$=u(c,1)[0],M=((t,e)=>{const n={atk:0,def:0,hp:0,gd:0,exp:0},[c,f]=(t=>t>=1&&t<=3?[1,2]:t>=4&&t<=6?[2,3]:t>=7&&t<=10?[2,4]:t>=11&&t<=13?[3,4]:[0,0])(t),i=a(f,c),r=Object.keys(n).sort((()=>o()-.5));for(let a=0;a<i;a++){const c=r[a],[f,i]=s[c],d=(t-1)/12*((100-e)/60);switch(c){case"gd":n.gd=(i-f)*d*o()+f;break;case"exp":n.exp=(i-f)*d*o()+f;break;default:n[c]=f+(i-f)*d*o()}}return n.atk=Math.floor(n.atk),n.def=Math.floor(n.def),n.hp=Math.floor(n.hp),n.gd=Math.floor(100*n.gd)/100,n.exp=Math.floor(100*n.exp)/100,n})(t.id,e);let m=1+t.id*(100-e)/10+50*(t.id-1);13===e&&(m*=1.5);let g={id:1e5+1e3*t.id+e,n:`${t.id}-${e}`,t:"N",lv:0,h:Math.floor(10*(5*o()+10)*m),tps:Math.floor(50*(5*o()+10)*m),ht:a(10,0),exp:Math.floor(2*m*o()+5*m),g:10*Math.floor(4*m*o()+8*m),atk:Math.floor(3*m*o()+6*m),def:Math.floor(2*m*o()+4*m),items:h.map((t=>p(t))),nItem:p($),nGd:10*Math.floor(4*m*o()+8*m)+1e3,eft:M};13===e?g.t="B":7===e&&(g.t="S"),t.nIds.push(g.id),y.nps.push(g)}))}))),y.cNpcs=d(y.cts[0],y.nps)})(!0),y.cs="S"},S="js13k-numwar-bobgame",T=(t=!0)=>{y.c=t;const e={v:1,c:t,a:r(y)};localStorage.setItem(S,JSON.stringify(e))},x=t=>`${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`,C=t=>`bold ${t}px 'Consolas', 'Menlo', 'DejaVu Sans Mono', monospace`;CanvasRenderingContext2D.prototype.wrap=function(t){this.save(),t(),this.restore()};const I=(t,e,n)=>{const s=y.s,o=15*s,c=20*s,a=15*s,f=8*s,i=24*s;t.fillStyle=t.strokeStyle="#000",t.fillRect(-o,-c,2*o,2*c),e&&(t.fillRect(0,0,o+5*s,4*s),t.fillRect(0,12*s,o+5*s,4*s)),t.beginPath(),t.arc(0,-c-o,o,Math.PI,0,!0),t.lineTo(o,-c),t.lineTo(-o,-c),t.fill(),t.fillStyle=t.strokeStyle="#b12a34",t.fillRect(-o,-c,2*o,a),t.lineWidth=1*s,t.beginPath(),t.arc(0,7*s,4*s,0,2*Math.PI),t.fill(),t.beginPath(),t.moveTo(-o,0),t.lineTo(0,5*s),t.lineTo(o,0),t.stroke(),t.fillStyle="#fff",t.textAlign="center",t.font=4*s+"pt Courier",t.fillText("13",0,8.8*s),t.lineWidth=1*s,t.strokeStyle="#000",[-1,1].forEach((e=>t.wrap((()=>{t.translate(0,-c+a),t.beginPath(),t.moveTo(0,0),t.lineTo(e*i,-2*s),t.moveTo(0,0),t.lineTo(e*i,2*s),t.stroke()})))),t.fillStyle="#fff",[-f,f].forEach((e=>t.wrap((()=>{t.translate(e,a/2-c+2*s),Date.now()%5e3<100&&t.scale(1,.1),t.beginPath(),t.arc(0,0,a/2-2*s,0,2*Math.PI),t.fill(),t.fillStyle="#000",n?[Math.PI/4,-Math.PI/4].forEach((e=>t.wrap((()=>{t.fillStyle="#000",t.rotate(e),t.fillRect(-5*s,-1*s,10*s,2*s)})))):(t.scale(.3,1),t.beginPath(),t.arc(0,0,a/2-2*s,0,2*Math.PI),t.fill())})))),t.beginPath(),t.arc(0,-c+a,2*s,0,2*Math.PI,!0),t.fill();const r=3*Math.sin(Date.now()/1e3*Math.PI*2/2)*s;t.strokeStyle="#000",t.lineWidth=5*s,t.lineCap="round",t.beginPath(),t.moveTo(0,c-t.lineWidth),t.bezierCurveTo(-25*s,c+2*s,-25*s,c-10*s,-25*s+r,c-18*s),t.stroke()},N=(t,e,n,s,o=!1,c=!1)=>{const a=y.s,f=e*a,i=n*a,r=180*a,d=c?40*a:60*a;t.fillStyle=o?"#666":"#444",t.fillRect(f,i,r,d),t.strokeStyle=o?"#fff":"#ccc",t.lineWidth=o?2*a:1*a,t.strokeRect(f,i,r,d),t.fillStyle=o?"#ff0":"#fff",t.font=C((c?20:28)*a),t.textAlign="center";const l=t.measureText(s);return t.fillText(s,f+r/2,i+d/2+(l.actualBoundingBoxAscent-l.actualBoundingBoxDescent)/2),{x:f-5*a,y:i-5*a,width:r+10*a,height:d+10*a}},B=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#333",t.fillRect(0,0,e.width,e.height),(t=>{const e=y.s;t.font=x(28*e),t.fillStyle="#fff",t.textAlign="center",t.fillText("Assault on City 13",200*e,95*e),t.font=x(16*e),t.fillStyle="#ccc",t.fillText("Slay the Foe, Save the Black Cat",200*e,130*e)})(t);const n=N(t,110,y.c?170:210,"New Game",2===y.hNBtn),s=N(t,y.c?110:-400,260,"Continue",3===y.hNBtn);return t.wrap((()=>{t.translate(10*y.s,100*y.s),t.rotate(Math.PI/4),I(t,!0,!1)})),(t,e)=>i(t,e,n)?2:i(t,e,s)?3:0},D=(t,e,n,s,o=!1,c=!1,a=!1)=>{const f=y.s,i=e*f,r=n*f,d=140*f,l=c?40*f:60*f;t.fillStyle=a?"#222":o?"#666":"#444",t.fillRect(i,r,d,l),t.strokeStyle=a?"#999":o?"#fff":"#ccc",t.lineWidth=a?1*f:o?2*f:1*f,t.strokeRect(i,r,d,l),t.fillStyle=a?"#777":o?"#ff0":"#fff",t.font=C((c?20:28)*f),t.textAlign="center";const h=t.measureText(s);return t.fillText(s,i+d/2,r+l/2+(h.actualBoundingBoxAscent-h.actualBoundingBoxDescent)/2),{x:i-5*f,y:r-5*f,width:d+10*f,height:l+10*f}},H=(t,e=!1)=>{const n=y.s,s=20*n,o=360*n,c=20*n;return t.strokeStyle=e?"#ff0":"#fff",t.lineWidth=2*n,t.beginPath(),t.moveTo(o,c),t.lineTo(o+s,c+s),t.moveTo(o+s,c),t.lineTo(o,c+s),t.stroke(),{x:o-10*n,y:c-10*n,width:s+20*n,height:s+20*n}},G=(t,e,s,o,c)=>{const a=y.s,f=e*a,i=s*a;t.lineWidth=1*a,t.fillStyle=n[c],t.strokeStyle="#000",t.save(),t.beginPath(),t.moveTo(f+12.776*a,i+25.292*a),t.lineTo(f+19.919*a,i+31.9*a),t.lineTo(f+10.632*a,i+40.49*a),t.lineTo(f+3.489*a,i+33.882*a),t.lineTo(f+12.776*a,i+25.292*a),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.beginPath(),t.moveTo(f+35.635*a,i+4.147*a),t.lineTo(f+43.493*a,i+3.486*a),t.lineTo(f+42.779*a,i+10.755*a),t.lineTo(f+22.777*a,i+29.257*a),t.lineTo(f+15.633*a,i+22.649*a),t.lineTo(f+35.635*a,i+4.147*a),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.beginPath(),t.moveTo(f+11.347*a,i+17.363*a),t.lineTo(f+28.491*a,i+33.222*a),t.lineTo(f+24.205*a,i+37.186*a),t.lineTo(f+7.061*a,i+21.327*a),t.lineTo(f+11.347*a,i+17.363*a),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.translate(f+25.5*a,i+20.5*a),t.rotate(Math.PI/-4),t.fillStyle="#fff",t.font=x(6*a),t.textAlign="center",t.fillText(o,0,1.5*a),t.restore()},F=(t,e,s,o,c)=>{const a=y.s,f=e*a,i=s*a;t.lineWidth=1*a,t.fillStyle=n[c-30],t.strokeStyle="#000",t.save(),t.beginPath(),t.moveTo(f+3.5*a,i+3.5*a),t.lineTo(f+13.5*a,i+3.5*a),t.lineTo(f+20.5*a,i+10.5*a),t.lineTo(f+27.5*a,i+3.5*a),t.lineTo(f+37.5*a,i+3.5*a),t.lineTo(f+37.5*a,i+14.5*a),t.lineTo(f+31.5*a,i+14.5*a),t.lineTo(f+31.5*a,i+33.5*a),t.lineTo(f+9.5*a,i+33.5*a),t.lineTo(f+9.5*a,i+14.5*a),t.lineTo(f+3.5*a,i+14.5*a),t.lineTo(f+3.5*a,i+3.5*a),t.closePath(),t.fill("evenodd"),t.stroke(),t.restore(),t.save(),t.translate(f+21*a,i+22*a),t.fillStyle="#fff",t.font=x(6*a),t.textAlign="center",t.fillText(o,0,1.4*a),t.restore()},L=(t,e="",n=" ")=>{const s=y.s;t.fillStyle="#fff",t.textAlign="center",t.font=x(24*s),t.fillText(e,200*s,35*s),n&&(t.font=x(16*s),t.fillStyle="#ccc",t.fillText(n,200*s,55*s))},E=(t,e)=>{const n=e?1:-1;t.atk&&t.atk>0&&(y.hero.atk+=t.atk*n),t.def&&t.def>0&&(y.hero.def+=t.def*n),t.hp&&t.hp>0&&(y.hero.mHp+=t.hp*n,y.hero.hp>y.hero.mHp&&(y.hero.hp=y.hero.mHp))},O=(t,e)=>{t.clearRect(0,0,e.width,e.height);const n=H(t,!1);let s=!1,o=!1;if(y.inS){const t=y.its.find((t=>t.id===y.cIId));t&&(s=t.ct>=13,o=y.cIId===y.hero.wp||y.cIId===y.hero.ar?t.ct<=1:t.ct<=0)}else s=y.cIId===y.hero.wp||y.cIId===y.hero.ar,o=y.cIId!==y.hero.wp&&y.cIId!==y.hero.ar;const c=D(t,40,340,y.inS?"Buy":"Equip",2===y.hNBtn,!0,s),a=D(t,220,340,y.inS?"Sell":"Unequip",3===y.hNBtn,!0,o);(t=>{const e=y.s,n=18*e,s=64*e,o=364*e,c=260*e,a=52*e,f=.4*e;t.fillStyle="#555",t.fillRect(n,s,o,c),t.lineWidth=f,t.strokeStyle="#aaa",t.strokeRect(n,s+1*a,o,f),t.strokeRect(n,s+2*a,o,f),t.strokeRect(n,s+3*a,o,f),t.strokeRect(n,s+4*a,o,f),t.strokeRect(n+1*a,s+a,f,c-a),t.strokeRect(n+2*a,s+a,f,c-a),t.strokeRect(n+3*a,s+a,f,c-a),t.strokeRect(n+4*a,s+a,f,c-a),t.strokeRect(n+5*a,s+a,f,c-a),t.strokeRect(n+6*a,s+a,f,c-a),t.strokeStyle="#fff",t.lineWidth=2*e,t.strokeRect(n-1*e,s-1*e,o+2*e,c+2*e)})(t);const f=[];let d=r(y.its);return y.inS?(L(t,"Merchant‌",`(${y.sCId}-7)`),d=y.its.filter((t=>t.ct>0||1===t.type&&t.id<=y.sCId||2===t.type&&t.id<=y.sCId+30))):(L(t,"Bag"),d=y.its.filter((t=>t.ct>0))),-1===y.cIId&&d.length>0&&(y.cIId=d[0].id),d.forEach(((e,n)=>{const s=18+n%7*52,o=64+52*Math.floor(n/7),c=((t,e,n,s,o=1,c=!1,a=!1)=>{let f=y.s;const i=e*f,r=n*f;f*=o;const d=52*f*o,l=d,h=d;return c?(t.fillStyle="#222",t.fillRect(i+1*f,r+1*f,l-2*f,h-2*f),t.lineWidth=2*f,t.strokeStyle=a?"#D19A5A":"#fff",t.strokeRect(i+1*f,r+1*f,l-2*f,h-2*f)):a&&(t.lineWidth=2*f,t.strokeStyle="#D19A5A",t.strokeRect(i+1*f,r+1*f,l-2*f,h-2*f)),1===s.type?G(t,e+3,n+6,s.name,s.id):2===s.type&&F(t,e+6,n+12,s.name,s.id),t.fillStyle="#fff",t.font=x(12*f),t.textAlign="left",t.fillText(s.ct.toString(),i+3*f,r+11*f),{x:i,y:r,width:l,height:h,item:s}})(t,s,o+52,e,1,y.cIId===e.id,e.id===y.hero.wp||e.id===y.hero.ar);f.push(c)})),(t=>{const e=y.s,n=y.its.find((t=>t.id===y.cIId));if(n){t.fillStyle="#fff",t.textAlign="left",t.font=x(18*e),t.fillText(`${n.ln} ×${n.ct}`,26*e,87*e);let s="";n.atk&&n.atk>0&&(s+=`Atk+${n.atk}`),n.def&&n.def>0&&(s+=`Def+${n.def}`),s+=` Buy: ${n.gd} Sell: ${Math.floor(n.gd/2)}`,t.textAlign="left",t.font=x(11*e),t.fillText(s,26*e,105*e),t.textAlign="right",t.fillStyle="#fff",t.fillText(`G: ${y.hero.g}`,374*e,105*e);const o=y.its.find((t=>t.id===y.hero.wp));let c=o?o.name:"---";const a=y.its.find((t=>t.id===y.hero.ar));t.fillText(`Weapon: ${c} Armor: ${a?a.name:"---"}`,374*e,86*e)}})(t),(t,e)=>{for(let n=0;n<f.length;n++)if(i(t,e,f[n]))return 100+f[n].item.id;return i(t,e,n)?1:i(t,e,c)&&!s?2:i(t,e,a)&&!o?3:0}},W=(t,e,n,s=1,o="#000")=>{const c=y.s*s,a=5.2*c/2;t.beginPath(),t.arc(e,n,a,0,2*Math.PI),t.strokeStyle=o,t.lineWidth=1*c,t.stroke(),t.closePath(),t.beginPath(),t.arc(e,n+10*c,2.1*a,1*Math.PI,2*Math.PI),t.stroke(),t.closePath()},P=t=>{let e={t:t,h:"",d:""};switch(t){case 1:e.h="^_^";const t=a(400,50);e.d=`Troops + ${t}`,y.hero.tps+=t;break;case 2:e.h="v_v";const n=a(300,50);e.d=`Troops - ${n}`,y.hero.tps-=n,y.hero.tps<=0&&(y.hero.tps=0,b("L","No Troops left after move"));break;case 3:e.h="^_^";const s=a(800,50);e.d=`Gold + ${s}`,y.hero.g+=s;break;case 4:e.h="v_v";const c=a(800,50);e.d=`Gold - ${c}`,y.hero.g-=c;break;case 5:e.h="^_^";const f=a(100,50);e.d=`Exp + ${f}`,y.hero.exp+=f;break;case 11:e.h="^_^";const i=a(10,5);e.d=`Atk + ${i}`,y.hero.atk+=i;break;case 12:e.h="v_v";const r=a(8,4);e.d=`Atk - ${r}`,y.hero.atk-=r;break;case 13:e.h="^_^";const d=a(10,5);e.d=`Def + ${d}`,y.hero.def+=d;break;case 14:e.h="v_v";const l=a(8,4);e.d=`Def - ${l}`,y.hero.def-=l;break;case 21:e.h="^_^";const h=o()>.4?a(2,0):a(0,2)+30,p=y.its.find((t=>t.id===h));if(!p)break;w(p),e.d=`Got item: ${p.name}`;break;case 31:e.h="^_^";const u=y.nps.filter((t=>t.id%100>80&&Math.floor((t.id-1e5)/1e3)<3)),$=u[a(u.length-1,0)];if(!$)break;A($),e.d=`Got member: ${$.n}`;break;default:e.t=0}return e},_=(t,e)=>{t.clearRect(0,0,e.width,e.height);const n=y.s;(t=>{const e=y.s,n=y.hero;W(t,135*e,20*e,2.2,"#77f"),t.font=x(13*e),t.fillStyle="#ccc",t.textAlign="left",t.fillText(`${n.n}`,155*e,25*e);const s=y.its.find((t=>t.id===n.wp));let o=s?s.name:"--";const c=y.its.find((t=>t.id===n.ar));let a=c?c.name:"--";t.font=x(9*e),t.fillText(`| Lv${n.lv} | ${Math.floor(n.yr)}y | G: ${f(n.g)}`,225*e,24*e),t.fillText(`Atk: ${f(n.atk)} [${o}] | Def: ${f(n.def)} [${a}]`,155*e,40*e),t.font=x(10*e);const i=125*e,r=250*e,d=65*e,l=85*e;t.fillText(`Exp: ${f(n.exp)}(${Math.floor(n.exp/n.mExp*1e3)/10}%)`,i,l),t.fillText(`Member: ${f(n.mbs.length)}`,r,d),t.fillStyle=n.hp>=40?"#ccc":"#f00",t.fillText(`Hp : ${f(n.hp)}/${f(n.mHp)}`,i,d),t.fillStyle=n.tps>=500?"#ccc":"#f00",t.fillText(`Troops: ${f(n.tps)}`,r,l)})(t),t.fillStyle="#555",t.fillRect(110*n,0,1,100*n),t.fillRect(0,99*n,400*n,1),t.fillRect(250*n,99*n,1,400*n),t.save();const s=.85;t.scale(s,s);const o=22*n,c=16*n,a=56*n,r=((t,e,n,s=1)=>{const o=y.s;return t.strokeStyle="#ccc",t.lineWidth=2*o,t.beginPath(),t.moveTo(e,n+12*o),t.lineTo(e+16*o,n),t.lineTo(e+32*o,n+12*o),t.lineTo(e+32*o,n+32*o),t.lineTo(e+21*o,n+32*o),t.lineTo(e+21*o,n+20*o),t.lineTo(e+11*o,n+20*o),t.lineTo(e+11*o,n+32*o),t.lineTo(e,n+32*o),t.lineTo(e,n+12*o),t.closePath(),t.stroke(),{x:(e-4*o)*s,y:(n-4*o)*s,width:40*o*s,height:40*o*s}})(t,o,c,s),d=((t,e,n,s=1)=>{const o=y.s;t.strokeStyle="#ccc",t.lineWidth=2*o;const c=32*o,a=32*o;return h(t,e,n,c,a,6*o),t.stroke(),t.beginPath(),t.arc(e+c/2,n+a/4,c/4,0,1*Math.PI,!1),t.stroke(),{x:(e-4*o)*s,y:(n-4*o)*s,width:(c+8*o)*s,height:(a+8*o)*s}})(t,o+a,c,s),l=((t,e,n,s=1)=>{const o=y.s;t.strokeStyle="#ccc",t.lineWidth=2*o,W(t,e+12*o,n+8*o,2.3,"#ccc");const c=2.3*o,a=5.2*c/2;return t.beginPath(),t.arc(e+20*o,n+8*o,a,1.6*Math.PI,2.4*Math.PI),t.strokeStyle="#ccc",t.lineWidth=1*c,t.stroke(),t.closePath(),t.beginPath(),t.arc(e+20*o,n+31*o,2.1*a,1.6*Math.PI,2*Math.PI),t.stroke(),t.closePath(),{x:(e-4*o)*s,y:(n-4*o)*s,width:40*o*s,height:40*o*s}})(t,o,c+a,s),p=((t,e,n,s=1)=>{const o=y.s;t.strokeStyle="#ccc",t.lineWidth=2*o;const c=32*o,a=32*o,f=4*o;return t.beginPath(),t.arc(e+4*o,n+4*o,f,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+2*o,n+31*o),t.lineTo(e+2*o,n+22*o),t.lineTo(e+0*o,n+22*o),t.lineTo(e+0*o,n+11*o),t.lineTo(e+6*o,n+11*o),t.stroke(),t.beginPath(),t.arc(e+16*o,n+1*o,f,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+12*o,n+32*o),t.lineTo(e+12*o,n+21*o),t.lineTo(e+10*o,n+21*o),t.lineTo(e+10*o,n+8*o),t.lineTo(e+22*o,n+8*o),t.lineTo(e+22*o,n+21*o),t.lineTo(e+20*o,n+21*o),t.lineTo(e+20*o,n+32*o),t.stroke(),t.beginPath(),t.arc(e+28*o,n+4*o,f,0,2*Math.PI),t.stroke(),t.beginPath(),t.moveTo(e+30*o,n+31*o),t.lineTo(e+30*o,n+22*o),t.lineTo(e+32*o,n+22*o),t.lineTo(e+32*o,n+11*o),t.lineTo(e+26*o,n+11*o),t.stroke(),{x:(e-4*o)*s,y:(n-4*o)*s,width:(c+8*o)*s,height:(a+8*o)*s}})(t,o+a,c+a,s);t.restore();const u=[];y.cts.forEach((e=>{const n=((t,e)=>{const n=y.s,s=e.id,o=y.sCId===e.id,c=y.hCId===e.id,a=e.isA;let f="#eee";y.acs.includes(s)?a?o?f="#ddf":c&&(f="#5722FF"):f="#aaa":f="#666",t.fillStyle=f;const i=e.x*n,r=(e.y+100)*n,d=e.w*n,l=e.h*n;t.fillRect(i,r,d,l);const h=.02*e.h*n;let p="#333";(o||c)&&(p="#00F");const u=i+13.7*h,$=r+30*h;t.strokeStyle=p,t.lineWidth=.6*h,t.strokeRect(u+2*h,$,10*h,4*h),t.strokeRect(u+5.5*h,$+2*h,3*h,2*h),t.strokeRect(u,$+4*h,14*h,6*h),t.beginPath(),t.arc(u+7*h,$+10*h,3.2*h,1*Math.PI,2*Math.PI),t.stroke(),t.closePath(),t.font=x(.4*l);let M="#000";return a?(o||c)&&(M="#00F"):M="#333",t.fillStyle=M,t.textAlign="center",t.fillText(s.toString(),i+d/2,r+l/2),{x:i,y:r,width:d,height:l,city:e}})(t,e);u.push(n)}));const $=[];return y.cNpcs.filter((t=>-1===y.hero.mbs.findIndex((e=>e.id===t.id)))).forEach(((e,s)=>{const o=((t,e,n,s=1)=>{const o=(n%2==0?260:330)*s,c=(110+46.65*Math.floor(n/2))*s,a=60*s,f=36.65*s;let i="#fff";y.hNName===e.n?i="B"===e.t?"#FFbbbb":"S"===e.t?"#ccFFcc":"#ddd":"B"===e.t?i="#FFcccc":"S"===e.t&&(i="#ddFFdd"),t.fillStyle=i,t.fillRect(o,c,a,f),W(t,o+12*s,c+14*s,1,"#000"),t.font=x(13*s),"B"!==e.t&&"S"!==e.t||(t.font=C(14*s)),t.fillStyle="#000",t.textAlign="center";const r=t.measureText(e.n);return t.fillText(e.n,o+a/1.6,c+f/2+(r.actualBoundingBoxAscent-r.actualBoundingBoxDescent)/2),{x:o,y:c,width:a,height:f,npc:e}})(t,e,s,n);$.push(o)})),(t,e)=>{if(i(t,e,d))return 1;if(i(t,e,l))return 2;if(i(t,e,r))return 3;if(i(t,e,p))return 4;for(let n=0;n<u.length;n++)if(i(t,e,u[n])&&y.cts[n].isA&&y.cts[n].id!==y.sCId)return 100+u[n].city.id;for(let n=0;n<$.length;n++)if(i(t,e,$[n]))return $[n].npc.id;return 0}},V=[{s:0,e:.05,wc:0,w:{hp:20,tps:.08},l:{hp:40,tps:.2}},{s:.05,e:.15,wc:10,w:{hp:20,tps:.05},l:{hp:40,tps:.18}},{s:.15,e:.25,wc:20,w:{hp:20,tps:.05},l:{hp:40,tps:.15}},{s:.25,e:.35,wc:20,w:{hp:20,tps:.03},l:{hp:40,tps:.12}},{s:.35,e:.45,wc:40,w:{hp:20,tps:.01},l:{hp:40,tps:.1}},{s:.45,e:.55,wc:50,w:{hp:20,tps:0},l:{hp:40,tps:.1}},{s:.55,e:.65,wc:60,w:{hp:20,tps:0},l:{hp:40,tps:.11}},{s:.65,e:.75,wc:70,w:{hp:20,tps:0},l:{hp:40,tps:.12}},{s:.75,e:.85,wc:80,w:{hp:20,tps:0},l:{hp:40,tps:.13}},{s:.85,e:.9,wc:90,w:{hp:20,tps:0},l:{hp:40,tps:.15}},{s:.9,e:1.1,wc:100,w:{hp:20,tps:0},l:{hp:40,tps:.2}}],Y=(t,e)=>{let n=r(V[0]);if(e){const s=j(),o=t.tps<=5e4?.2*t.tps:1e4+50*Math.log(t.tps-5e4+1),c=8*(1.2*t.mHp+3*t.atk+2.4*t.def+1.2*s.hp*t.lv+2.2*s.atk*t.lv+1.8*s.def*t.lv+o),a=e.items.reduce(((t,e)=>t+(e.atk||0)),0)||0,f=e.items.reduce(((t,e)=>t+(e.def||0)),0)||0,i=e.tps<=5e4?.06*e.tps:3e3+30*Math.log(e.tps-5e4+1),d=.8*e.h+1.6*e.atk+1.2*e.def+1.2*a+.8*f+i,l=Math.tanh(.7*(c-d)/Math.min(c,d))/2+.5;for(const t of V)if(l>=t.s&&l<t.e){n=r(t);break}}return n},j=()=>{let t={atk:0,def:0,hp:0,gd:0,exp:0};return y.hero.mbs.forEach((e=>{t.atk+=e.eft.atk*(e.id===y.hero.mm?2:1),t.def+=e.eft.def*(e.id===y.hero.mm?2:1),t.hp+=e.eft.hp*(e.id===y.hero.mm?2:1),t.gd+=e.eft.gd*(e.id===y.hero.mm?2:1),t.exp+=e.eft.exp*(e.id===y.hero.mm?2:1)})),t},J=(t,e)=>{if(t.clearRect(0,0,e.width,e.height),(t=>{const e=y.s,n=y.nps.find((t=>t.id===y.cNId))||y.nps[0];if(["F2","F3"].includes(y.nt.p)||(t.font=x(28*e),t.textAlign="left","B"===n.t?(W(t,66*e,40*e,4,"#f00"),t.fillStyle="#f00",t.fillText(`${n.n}`,95*e,54*e),t.font=x(10*e),t.fillText("BOSS",55*e,78*e)):(W(t,66*e,40*e,4,"#fff"),t.fillStyle="#fff",t.fillText(`${n.n}`,95*e,54*e))),t.font=x(14*e),"N"===y.nt.p){t.fillText("B"===n.t?`Lv${n.lv}`:`Lv${n.lv} ❤${n.ht}`,100*e,78*e),t.font=x(16*e);const s=40*e,o=190*e,c=45*e,a=28*e;t.fillStyle="#fff",t.fillText(`Hp: ${f(n.h)}`,o,c),t.fillText(`Troops: ${f(n.tps)}`,o,c+1*a),t.fillText(`Exp: ${f(n.exp)}`,o,c+2*a),t.fillText(`Atk: ${f(n.atk)}`,o,c+3*a),t.fillText(`Def: ${f(n.def)}`,o,c+4*a),t.fillText(`G: ${f(n.g)}`,o,c+5*a),t.fillStyle="#bbb",t.font=x(13*e);const i=Y(y.hero,y.nps.find((t=>t.id===y.cNId)));t.fillText(`Win chance: ${i.wc}%`,s,c+6*a);const r=y.its.find((t=>t.id===n.nItem.id));t.fillText(`Join need: 100❤ + ${r.name} + ${n.nGd}G`,s,c+6.8*a),t.fillText(`Team effect: ${l(n.eft)}`,s,c+7.6*a),t.fillStyle="#999",t.fillRect(s,195*e,320*e,1*e),t.fillStyle="#111",h(t,s,95*e,140*e,84*e,6*e),t.strokeStyle="#666",t.lineWidth=1*e,t.stroke(),t.fill(),t.fillStyle="#ddd",t.font=x(10*e),n.items.forEach(((n,o)=>{const c=y.its.find((t=>t.id===n.id));t.fillText(n.name,s+30*e,118*e+23*o*e),t.save();const a=.3;t.scale(a,a),1===c.type?G(t,(s/e+10)/a,(108+23*o)/a,c.name,c.id):F(t,(s/e+10)/a,(108+23*o)/a,c.name,c.id),t.restore()}))}else if("T"===y.nt.p)t.fillText(`Lv${n.lv}`,100*e,78*e),((t,e,n)=>{const s=3.5*y.s;t.save(),t.strokeStyle="rgb(0, 0, 0, 0)",t.fillStyle="rgb(195, 195, 195)",t.beginPath(),t.moveTo(23*s+e,3*s+n),t.bezierCurveTo(34*s+e,3*s+n,43*s+e,10.2*s+n,43*s+e,19*s+n),t.bezierCurveTo(43*s+e,27.8*s+n,34*s+e,35*s+n,23*s+e,35*s+n),t.bezierCurveTo(12*s+e,35*s+n,3*s+e,27.8*s+n,3*s+e,19*s+n),t.bezierCurveTo(3*s+e,10.2*s+n,12*s+e,3*s+n,23*s+e,3*s+n),t.closePath(),t.fill("evenodd"),t.beginPath(),t.moveTo(19.3*s+e,33.7*s+n),t.lineTo(10.3*s+e,38.7*s+n),t.lineTo(10.3*s+e,28.7*s+n),t.lineTo(19.3*s+e,33.7*s+n),t.closePath(),t.fill("evenodd"),t.restore()})(t,120*e,125*e),t.font=x(80*e),t.fillStyle="#000",t.textAlign="center",t.fillText(`${y.nt.d}`,200*e,200*e);else if("T2"===y.nt.p)t.fillRect(199.5*e,115*e,1*e,140*e),t.fillText(`Lv${n.lv}`,100*e,78*e),t.textAlign="center",t.fillStyle="#f00",t.font=x(60*e),t.fillText("❤",100*e,180*e),t.fillStyle="#fff",t.font=x(48*e),t.fillText("HP",300*e,180*e),t.font=x(30*e),t.fillText(`${y.nt.tt.t1} ➔ ${y.nt.tt.t2}`,100*e,230*e),t.fillText(`${y.nt.tt.t3} ➔ ${y.nt.tt.t4}`,300*e,230*e),n.ht>=100&&(t.font=x(10*e),t.fillText(`${y.nt.tt.t5}`,100*e,250*e),t.fillText(`${y.nt.tt.t6}`,300*e,250*e));else if("T3"===y.nt.p)t.fillText(`Lv${n.lv}`,100*e,78*e),t.font=x(16*e),t.fillStyle="#fff",t.textAlign="center",t.fillText(y.nt.tt.t1,200*e,120*e),t.fillText("❤ 100",200*e,150*e),t.fillText(y.nt.tt.t5,200*e,180*e),t.fillText(y.nt.tt.t6,200*e,210*e);else if("T4"===y.nt.p)t.fillText(`Lv${n.lv}`,100*e,78*e),t.font=x(16*e),t.fillStyle="#fff",t.textAlign="center",t.fillText(`${y.nt.tt.t1}`,200*e,200*e);else if("F"===y.nt.p)t.fillText(`Lv${n.lv}`,100*e,78*e),t.font=x(130*e),t.fillStyle=y.nt.f,t.textAlign="center",t.fillText("⚔",200*e,220*e);else if("F2"===y.nt.p){t.font=x(30*e),t.fillStyle="#0f0",t.textAlign="center",t.fillText("WIN",200*e,120*e),t.font=x(16*e),t.fillText(`${n.n} ❤-${y.nt.ft.t1}`,200*e,150*e);let s=`Hp-${y.nt.ft.t2}`;"0"!==y.nt.ft.t3&&(s+=`Troops-${y.nt.ft.t3}`),t.fillText(s,200*e,180*e),t.fillText(`G+${y.nt.ft.t4} Exp+${y.nt.ft.t5}`,200*e,210*e),t.fillText(`${y.nt.ft.t6}`,200*e,240*e)}else"F3"===y.nt.p&&(t.font=x(30*e),t.fillStyle="#0ff",t.textAlign="center",t.fillText("LOSE",200*e,120*e),t.font=x(16*e),t.fillText(`${n.n} ❤-${y.nt.ft.t1}`,200*e,150*e),t.fillText(`Hp-${y.nt.ft.t2}`,200*e,180*e),t.fillText(`Troops-${y.nt.ft.t3}`,200*e,210*e))})(t),"N"===y.nt.p){const e=H(t,1===y.hNBtn),n=D(t,40,310,"♡",2===y.hNBtn,!0),s=D(t,220,310,"⚔",3===y.hNBtn,!0);return(t,o)=>i(t,o,e)?1:i(t,o,n)?2:i(t,o,s)?3:0}if(["T2","T4","F2","F3"].includes(y.nt.p)){const e=D(t,130,300,"OK",2===y.hNBtn);return(t,n)=>i(t,n,e)?1:0}if(["T3"].includes(y.nt.p)){const e=D(t,40,300,"NO",2===y.hNBtn),n=D(t,220,300,"YES",2===y.hNBtn);return(t,s)=>i(t,s,e)?11:i(t,s,n)?12:0}return(t,e)=>0},K=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#111",t.fillRect(0,0,e.width,e.height);const n=D(t,40,340,"New",2===y.hOBtn,!0),s=D(t,220,340,"Home",3===y.hOBtn,!0);return(t=>{const e=y.s;t.textAlign="left",t.fillStyle="#333",t.fillRect(20*e,20*e,360*e,65*e);let n="W"===y.ot.t;t.fillStyle=n?"#0f0":"#f00",t.wrap((()=>{t.translate(64*y.s,58*y.s),n?I(t,!0,!1):I(t,!1,!0)}));const s=n?"Congratulations!":"Game Over!",o=n?"You saved Black Cat!":"You didn't save Black Cat!";t.font=x(20*e),t.fillText(s,110*e,47*e),t.font=C(16*e),t.fillText(o,110*e,73*e),t.fillRect(20*e,85*e,360*e,1*e),t.fillStyle=n?"#ccc":"#aaa",t.font=x(12*e);const c=50*e,a=230*e,i=120*e,r=30*e;t.fillText(`Year : ${Math.floor(y.ot.h.yr)}`,c,i),t.fillText(`Lv : ${y.ot.h.lv}`,c,i+1*r),t.fillText(`Atk : ${y.ot.h.atk}`,c,i+2*r),t.fillText(`Def : ${y.ot.h.def}`,c,i+3*r),t.fillText(`Exp : ${y.ot.h.exp}`,c,i+4*r),t.fillText(`Gold : ${f(y.ot.h.g)}`,c,i+5*r),t.fillText(`Troops : ${f(y.ot.h.tps)}`,a,i),t.fillText(`City : ${Math.max(...y.ot.acs)}`,a,i+1*r),t.fillText(`Member : ${y.ot.h.mbs.length}`,a,i+2*r),t.fillText(`Win Boss : ${Math.max(...y.ot.acw)}`,a,i+3*r);const d=y.its.find((t=>t.id===y.ot.h.wp))?.name||"--";t.fillText(`Top Sword: ${d}`,a,i+4*r);const l=y.its.find((t=>t.id===y.ot.h.ar))?.name||"--";t.fillText(`Top Armor: ${l}`,a,i+5*r),t.fillStyle="#fff",t.fillText(`Reason: ${y.ot.r}`,c,i+6*r)})(t),(t,e)=>i(t,e,n)?2:i(t,e,s)?3:0},X=()=>{const t=y.s,e=364*t,n=260*t;return{x:18*t,y:64*t,w:e,h:n,iW:e/2,iH:n/5}},z=(t,e)=>{t.clearRect(0,0,e.width,e.height),L(t,"Team");const n=H(t,1===y.hTBtn);let s=y.cTId===y.hero.mm,o=y.cTId===y.hero.mm;const c=D(t,40,340,"Set main",2===y.hTBtn,!0,s),a=D(t,220,340,"Remove",3===y.hTBtn,!0,o);(t=>{const e=y.s,{x:n,y:s,w:o,h:c,iW:a,iH:f}=X(),i=.4*e;t.fillStyle="#333",t.fillRect(n,s,o,c),t.lineWidth=i,t.strokeStyle="#aaa",t.strokeRect(n,s+1*f,o,i),t.strokeRect(n,s+2*f,o,i),t.strokeRect(n,s+3*f,o,i),t.strokeRect(n,s+4*f,o,i),t.strokeRect(n+1*a,s+f,i,c-f),t.strokeStyle="#fff",t.lineWidth=2*e,t.strokeRect(n-1*e,s-1*e,o+2*e,c+2*e)})(t);const{x:f,y:d,iW:h,iH:p}=X(),u=f/y.s,$=d/y.s,M=h/y.s,m=p/y.s,g=[];let k=[];return k=r(y.hero.mbs),-1===y.cTId&&k.length>0&&(y.cTId=k[0].id),k.forEach(((e,n)=>{const s=u+n%2*M,o=$+Math.floor(n/2)*m,c=((t,e,n,s,o=!1,c=!1)=>{const a=y.s,f=e*a,i=n*a,{iW:r,iH:d}=X();o?(t.fillStyle="#222",t.fillRect(f+1*a,i+1*a,r-2*a,d-2*a),t.lineWidth=2*a,t.strokeStyle=c?"#D19A5A":"#fff",t.strokeRect(f+1*a,i+1*a,r-2*a,d-2*a)):c&&(t.lineWidth=2*a,t.strokeStyle="#D19A5A",t.strokeRect(f+1*a,i+1*a,r-2*a,d-2*a)),W(t,f+15*a,i+10*a,1,"#ddd"),t.fillStyle="#fff",t.font=x(12*a),t.textAlign="left",t.fillText(`${s.name} Lv${s.lv}`,f+24*a,i+17*a);let l="";if(s.eft.atk>0){const t=`Atk+${s.eft.atk}`;l+=""===l?t:" "+t}if(s.eft.def>0){const t=`Def+${s.eft.def}`;l+=""===l?t:" "+t}if(s.eft.hp>0){const t=`HP+${s.eft.hp}`;l+=""===l?t:" "+t}""!==l&&(t.fillStyle="#ccc",t.font=x(10*a),t.textAlign="left",t.fillText(l,f+9*a,i+33*a));let h="";if(s.eft.gd>0){const t=`Gold+${Math.floor(1e3*s.eft.gd)/10}%`;h+=""===h?t:" "+t}if(s.eft.exp>0){t.fillStyle="#ccc",t.font=x(10*a);const e=`Exp+${Math.floor(1e3*s.eft.exp)/10}%`;h+=""===h?e:" "+e}return""!==h&&t.fillText(h,f+9*a,i+46*a),{x:f,y:i,width:r,height:d,member:s}})(t,s,o+m,e,y.cTId===e.id,e.id===y.hero.mm);g.push(c)})),(t=>{const e=y.s;if(y.nps.find((t=>t.id===y.cTId))){t.fillStyle="#fff",t.textAlign="left",t.font=x(15*e);const n=y.hero.mbs.find((t=>t.id===y.hero.mm));n?(t.fillText(`Main: ${n.name}`,26*e,87*e),t.font=x(11*e),t.fillText(`(${l(n.eft)}) × 2`,116*e,86*e)):t.fillText("Main: ---",26*e,87*e),t.font=x(11*e),t.fillStyle="#ddd",t.fillText(`Total: ${l(j())}`,26*e,105*e)}})(t),(t,e)=>{for(let n=0;n<g.length;n++)if(i(t,e,g[n]))return 100+g[n].member.id;return i(t,e,n)?1:i(t,e,c)&&!s?2:i(t,e,a)&&!o?3:0}},R=(t,e)=>{t.clearRect(0,0,e.width,e.height);const n=y.cts.find((t=>t.id===y.sCId));L(t,`Move to city ${n?.id}`);const s=H(t,1===y.hVBtn),o=y.s,c=200*o,a=80*o,f=66*o;y.mv.evs.forEach(((e,n)=>{t.fillStyle="#ccc",t.textAlign="center",t.font=C(24*o),t.fillText(e.h,c,a+f*n),t.fillStyle="#fff",t.font=x(16*o),t.fillText(e.d,c,a+f*n+25*o)}));const r=D(t,130,340,"Close",2===y.hVBtn,!0);return(t,e)=>i(t,e,s)?1:i(t,e,r)?2:0};let q=0,U=0,Q=10,Z=0,tt="",et=0;const nt=(t,e)=>{t.clearRect(0,0,e.width,e.height),L(t,"Get troops");const n=H(t,1===y.hTPBtn);(()=>{const t=y.hero.tps||0,e=y.hero.g||0;Q=t<5e3?10:t<7500?15:t<1e4?20:25,U=e>0?Math.floor(e/Q):0,q>U&&(q=U),Z=q*Q})();const s=y.s,o=y.hero.tps||0,c=y.hero.g||0,a=y.baseW*s/2;t.fillStyle="#fff",t.font=x(15*s),t.textAlign="center",t.fillText(`You have troops: ${o}, gold: ${c}`,a,80*s),t.fillStyle="#fff",t.font=x(20*s),t.textAlign="center",t.fillText(`Troops to recruit: ${q}`,a,130*s),t.fillText(`Total price: ${Z} G`,a,160*s);const{sliderX:f,sliderY:r,sliderWidth:d,sliderHeight:l}=((t,e)=>{const n=60*e,s=180*e,o=280*e,c=20*e;t.fillStyle="#444",t.fillRect(n,s,o,c);const a=U>0?q/U*o:0;t.fillStyle="#66f",t.fillRect(n,s,a,c);const f=Math.max(n,Math.min(n+o,n+a));return t.fillStyle="#fff",t.beginPath(),t.arc(f,s+c/2,15*e,0,2*Math.PI),t.fill(),{sliderX:n,sliderY:s,sliderWidth:o,sliderHeight:c}})(t,s);Date.now()-et<2e3&&(t.fillStyle="#ff0",t.font=x(15*s),t.textAlign="center",t.fillText(tt,a,230*s));const h=D(t,140,250,"Get troops",2===y.hTPBtn,!0),p=D(t,140,340,"Close",3===y.hTPBtn,!0),u={x:f-10*s,y:r-10*s,width:d+20*s,height:l+20*s};return(t,e,s=!1)=>{if(i(t,e,n))return 1;if(i(t,e,p))return 3;if(i(t,e,h))return 2;if(i(t,e,u)){if(!s){const e=Math.max(0,Math.min(1,(t-f)/d));return q=Math.round(e*U),Z=q*Q,5}return 6}return 0}},st=(t,e)=>{t.clearRect(0,0,e.width,e.height),L(t,"Start Game");const n=y.s;t.fillStyle="#ccc",t.textAlign="center",t.font=x(14*n),["Number kingdom existed","King 13-13 and ruled 13 cities","Each city: boss 13","Beat boss to advance","13-13 took your cat","Go to City 13","13 years to save cat","Good luck!"].forEach(((e,s)=>{t.fillText(e,200*n,(70+30*s)*n)}));const s=D(t,130,330,"Start",2===y.hSBtn,!0);return(t,e)=>i(t,e,s)?2:0},ot=(t,e)=>{t.clearRect(0,0,e.width,e.height),t.fillStyle="#333",t.fillRect(0,0,e.width,e.height),L(t,"Start Game");const n=y.s;t.fillStyle="#fff",t.textAlign="center",t.fillText("Start new game?",200*n,100*n),t.fillText("Progress will be lost.",200*n,140*n),t.wrap((()=>{t.translate(200*y.s,330*y.s),I(t,!0,!1)}));const s=D(t,130,240,"Back",2===y.hCBtn,!0),o=D(t,130,320,"Confirm",3===y.hCBtn,!0);return(t,e)=>i(t,e,s)?2:i(t,e,o)?3:0},ct=function(){const t=document.querySelector("#canvas");if(!t)return;const e=t.getContext("2d");if(!e)return;e.textBaseline="alphabetic",e.imageSmoothingEnabled=!1,(()=>{const t=localStorage.getItem(S);if(t){const e=JSON.parse(t);e?.v&&1===e?.v&&(y=r(e.a),y.c=e.c,y.cs="H",y.nt=r(M),y.ot=r(m))}})();const n=()=>{switch(e.clearRect(0,0,t.width,t.height),y.cs){case"H":B(e,t);break;case"M":_(e,t);break;case"N":J(e,t);break;case"I":O(e,t);break;case"T":z(e,t);break;case"V":R(e,t);break;case"O":K(e,t);break;case"TP":nt(e,t);break;case"S":st(e,t);break;case"C":ot(e,t)}},{handleMouseMove:s,handleClick:f,handleTouchStart:i,handleTouchMove:l,handleTouchEnd:h}=((t,e)=>{let n=!1;t.addEventListener("mousedown",(()=>{n=!0})),t.addEventListener("mouseup",(()=>{n=!1}));const s=(t,s,o)=>{const c=o.getBoundingClientRect(),a=t.clientX-c.left,f=t.clientY-c.top;if("I"===y.cs){const t=O(s,o)(a,f);o.style.cursor=t?"pointer":"default"}else if("N"===y.cs){const t=J(s,o)(a,f);t?(o.style.cursor="pointer",y.hNBtn=t):(o.style.cursor="default",y.hNBtn=0)}else if("M"===y.cs){const t=_(s,o)(a,f);o.style.cursor=t?"pointer":"default"}else if("T"===y.cs){const t=z(s,o)(a,f);t?(o.style.cursor="pointer",y.hTBtn=t):(o.style.cursor="default",y.hTBtn=0)}else if("TP"===y.cs){const t=nt(s,o)(a,f,!n);5===t||6===t?(o.style.cursor="pointer",y.hTPBtn=t,e()):t?(o.style.cursor="pointer",y.hTPBtn=t):(o.style.cursor="default",y.hTPBtn=0)}else if("C"===y.cs){const t=ot(s,o)(a,f);t?(o.style.cursor="pointer",y.hCBtn=t):(o.style.cursor="default",y.hCBtn=0)}else if("S"===y.cs){const t=st(s,o)(a,f);t?(o.style.cursor="pointer",y.hSBtn=t):(o.style.cursor="default",y.hSBtn=0)}else if("O"===y.cs){const t=K(s,o)(a,f);t?(o.style.cursor="pointer",y.hOBtn=t):(o.style.cursor="default",y.hOBtn=0)}else if("V"===y.cs){const t=R(s,o)(a,f);t?(o.style.cursor="pointer",y.hVBtn=t):(o.style.cursor="default",y.hVBtn=0)}else if("H"===y.cs){const t=B(s,o)(a,f);t?(o.style.cursor="pointer",y.hHBtn=t):(o.style.cursor="default",y.hHBtn=0)}},f=(t,n,s)=>{const f=s.getBoundingClientRect(),i=t.clientX-f.left,l=t.clientY-f.top;if("I"===y.cs){const t=O(n,s)(i,l);t&&(t=>{if(1===t)y.cs="M",y.inS=!1,y.cIId=0;else if(2===t){const t=y.its.find((t=>t.id===y.cIId));if(t)if(y.inS)y.hero.g>=t.gd&&t.ct<13&&(y.hero.g-=t.gd,t.ct+=1);else if(1===t.type){const e=y.its.find((t=>t.id===y.hero.wp));e&&E(e,!1),E(t,!0),y.hero.wp=t.id}else if(2===t.type){const e=y.its.find((t=>t.id===y.hero.ar));e&&E(e,!1),E(t,!0),y.hero.ar=t.id}T()}else if(3===t){const t=y.its.find((t=>t.id===y.cIId));t&&(y.inS?y.hero.wp===t.id||y.hero.ar===t.id?t.ct>1&&(y.hero.g+=Math.floor(t.gd/2),t.ct-=1):t.ct>0&&(y.hero.g+=Math.floor(t.gd/2),t.ct-=1):y.hero.wp!==t.id&&y.hero.ar!==t.id||(E(t,!1),1===t.type?y.hero.wp=-1:2===t.type&&(y.hero.ar=-1))),T()}else if(t>=100){const e=t-100,n=y.its.find((t=>t.id===e));n&&(y.cIId=n.id)}})(t)}else if("N"===y.cs){const t=J(n,s)(i,l);t&&((t,e)=>{switch(t){case 1:case 11:y.cs="M",y.nt=r(M);break;case 2:(t=>{y.nt.p="T",t(),setTimeout((()=>{y.nt.d="..",t(),setTimeout((()=>{y.nt.d="...",t(),setTimeout((()=>{const e=y.nps.find((t=>t.id===y.cNId));if(e){const{haveGold:t,haveItem:n}=((t,e)=>({haveGold:t.hero.g>=e.nGd,haveItem:t.its.find((t=>t.id===e.nItem.id&&t.ct>=e.nItem.count))}))(y,e);if(e.ht>=100&&t&&n){y.nt.tt.t1=`${e.n}: Can I join your team?`;const t=`Need item: ${e.nItem.name} - ✔`;y.nt.tt.t5=`Need gold: ${e.nGd} - ✔`,y.nt.tt.t6=t,y.nt.p="T3"}else{y.nt.tt.t1=e.ht+"";const s=Math.floor(e.id%1e3/4),o=5+a(Math.floor(1.6*s),Math.floor(s/1.3));if(e.ht+=o,e.ht>100&&(e.ht=100),y.nt.tt.t2=e.ht+"",y.nt.tt.t3=y.hero.hp+"",y.hero.hp-=10,y.nt.tt.t4=y.hero.hp+"",e.ht>=100){const s=`Need item: ${e.nItem.name} - ${n?"✔":"✖"}`;y.nt.tt.t5=`Need gold: ${e.nGd} - ${t?"✔":"✖"}`,y.nt.tt.t6=s}y.nt.p="T2",y.hero.hp<=0&&(y.hero.hp=0,y.nt=r(M),b("L","No HP left after conversation"))}}else y.nt.p="T2";y.c&&T(),t()}),k)}),k)}),k)})(e);break;case 3:(t=>{const e=y.nps.find((t=>t.id===y.cNId))||y.nps[0];y.nt.p="F",t(),setTimeout((()=>{y.nt.f="#fff",t(),setTimeout((()=>{y.nt.f="#aaa",t(),setTimeout((()=>{const n=Y(y.hero,y.nps.find((t=>t.id===y.cNId)));let s=!1;if(c()<n.wc){y.hero.g+=e.g,y.nt.ft.t4=e.g+"";const t=(t=>{let e=!1;for(y.hero.exp+=t;y.hero.exp>=y.hero.mExp;)y.hero.lv+=1,y.hero.exp-=y.hero.mExp,y.hero.mExp=1e3*y.hero.lv,y.hero.mHp+=10,y.hero.hp=y.hero.mHp,y.hero.atk+=20*y.hero.lv,y.hero.def+=10*y.hero.lv,e=!0;return e})(e.exp);y.nt.ft.t5=t?`${e.exp}, Lv ➔ ${y.hero.lv}`:e.exp+"",y.nt.ft.t6="";const n=e.items.filter((t=>t.id<30&&c()<40-t.id||t.id>=30&&c()<70-t.id));n.length>0&&n.forEach((t=>{y.nt.ft.t6+=""===y.nt.ft.t6?`+${t.name}`:`, +${t.name}`,w(y.its.find((e=>e.id===t.id)))})),"B"!==e.t||y.acw.includes(y.sCId)||(y.acw.push(y.sCId),y.cts.find((t=>t.id===y.sCId)).go.forEach((t=>{y.acs.includes(t)||(y.cts.find((e=>e.id===t)).isA=!0,y.acs.push(t))})),y.nps.forEach((t=>{t.lv++,t.g=Math.floor(1.07*t.g),t.exp=Math.floor(1.07*t.exp),t.tps=Math.floor(1.07*t.tps),t.h=Math.floor(1.07*t.h),t.atk=Math.floor(1.07*t.atk),t.def=Math.floor(1.07*t.def)}))),s=!0}const o=a(10,5);e.ht-=o,y.nt.ft.t1=o+"";const f=s?n.w:n.l;y.hero.hp-=f.hp,y.nt.ft.t2=f.hp+"";const i=Math.floor(f.tps*e.tps/10);y.hero.tps-=s?Math.floor(i/3):i,y.nt.ft.t3=i+"",y.nt.p=s?"F2":"F3",s&&"13-13"===e.n?b("W","Win 13-13"):y.hero.tps<=0?(y.hero.tps=0,y.nt=r(M),b("L","No Troops left after fight")):y.hero.hp<=0&&(y.hero.hp=0,y.nt=r(M),b("L","No HP left after fight")),y.c&&T(),t()}),k)}),k)}),k)})(e);break;case 12:const t=y.cNpcs.find((t=>t.id===y.cNId));t&&(A(t),y.nt.tt.t1=`Welcome ${t.n} to join the team`,y.nt.p="T4")}})(t,e)}else if("M"===y.cs){const t=_(n,s)(i,l);t>0&&(t=>{if(1===t)y.cs="I";else if(2===t)y.cs="T";else if(3===t)y.cs="H";else if(4===t)y.cs="TP";else if(t>=1e5){const e=t,n=y.cNpcs.find((t=>t.id===e));n&&("N"===n.t||"B"===n.t?(y.cs="N",y.cNId=n.id):"S"===n.t&&(y.cs="I",y.inS=!0))}else if(t>=100){const e=t-100,n=y.cts.find((t=>t.id===y.sCId));n&&n.id!==e&&n.isA&&n.go.includes(e)&&(t=>{y.sCId=t,y.cts.forEach((t=>{t.isA=!1}));const e=y.cts.find((e=>e.id===t));e&&(e.isA=!0,y.cNpcs=d(e,y.nps),e.go.forEach((t=>{const e=y.cts.find((e=>e.id===t));e&&y.acs.includes(e.id)&&(e.isA=!0)}))),(()=>{if(y.mv.evs=[],o()<.25){const t=a(5,1);y.mv.evs.push(P(t))}if(o()>.84){const t=a(14,11);y.mv.evs.push(P(t))}o()<.03&&y.mv.evs.push(P(21)),o()>.97&&y.mv.evs.push(P(31)),y.mv.evs.length>0&&(y.cs="V")})(),y.hero.yr+=.1,y.hero.hp+=60,y.hero.hp>y.hero.mHp&&(y.hero.hp=y.hero.mHp),y.hero.yr>=13&&b("L","13 years failed"),y.c&&T()})(e)}})(t)}else if("T"===y.cs){const t=z(n,s)(i,l);t>0&&((t,e)=>{if(1===t)y.cs="M",y.cTId=-1;else if(2===t)y.hero.mm=y.hero.mbs.find((t=>t.id===y.cTId))?.id||0,T();else if(3===t)y.hero.mm!==y.cTId&&(y.hero.mbs=y.hero.mbs.filter((t=>t.id!==y.cTId)),y.cTId=-1,T(),e());else if(t>=100){const e=t-100,n=y.hero.mbs.find((t=>t.id===e));n&&(y.cTId=n.id)}})(t,e)}else if("TP"===y.cs){const t=nt(n,s)(i,l);t>0&&((t,e)=>{if(1===t||3===t)y.cs="M";else if(2===t)if(q>0&&Z<=(y.hero.g||0)){y.hero.g=(y.hero.g||0)-Z,y.hero.tps=(y.hero.tps||0)+q;const t=q;q=0,tt="Successfully recruited "+t+" troops!",et=Date.now(),T()}else 0===q?(tt="Please select troops to recruit",et=Date.now()):(tt="Insufficient gold",et=Date.now());else 5!==t&&6!==t||e()})(t,e)}else if("S"===y.cs){const t=st(n,s)(i,l);t>0&&(t=>{2===t&&(y.cs="M")})(t)}else if("C"===y.cs){const t=ot(n,s)(i,l);t>0&&(t=>{2===t&&(y.cs="H"),3===t&&(v(),T())})(t)}else if("O"===y.cs){const t=K(n,s)(i,l);t>0&&(t=>{2===t?(v(),y.cs="S"):3===t&&(y.cs="H")})(t)}else if("V"===y.cs){const t=R(n,s)(i,l);t>0&&(t=>{(1===t||2===t)&&(y.cs="M")})(t)}else if("H"===y.cs){const t=B(n,s)(i,l);t>0&&(t=>{2===t?y.cs="C":3===t&&(y.cs="M")})(t)}e()};return{handleMouseMove:s,handleClick:f,handleTouchStart:(t,e,n)=>{t.preventDefault();const o=t.touches[0];n.getBoundingClientRect(),s({clientX:o.clientX,clientY:o.clientY},e,n)},handleTouchMove:(t,n,s)=>{if("TP"===y.cs){t.preventDefault();const o=t.touches[0],c=s.getBoundingClientRect(),a=o.clientX-c.left,f=o.clientY-c.top,i=nt(n,s)(a,f,!1);5!==i&&6!==i||e()}},handleTouchEnd:(t,e,n)=>{t.preventDefault();const s=t.changedTouches[0];n.getBoundingClientRect(),f({clientX:s.clientX,clientY:s.clientY},e,n)}}})(t,n);t.addEventListener("mousemove",(n=>s(n,e,t))),t.addEventListener("click",(n=>f(n,e,t))),t.addEventListener("touchstart",(n=>i(n,e,t))),t.addEventListener("touchmove",(n=>l(n,e,t))),t.addEventListener("touchend",(n=>h(n,e,t))),t.addEventListener("touchstart",(t=>t.preventDefault()),{passive:!1}),t.addEventListener("touchmove",(t=>t.preventDefault()),{passive:!1});const p=()=>{const s=t.parentElement;if(!s)return;const o=window.devicePixelRatio||1;t.width=s.clientWidth*o,t.height=s.clientHeight*o,t.style.width=s.clientWidth+"px",t.style.height=s.clientHeight+"px",e.scale(o,o),n()};return p(),{canvas:t,ctx:e,resize:p}}(),at=()=>{const t=document.querySelector("#can-con"),e=document.querySelector("#app");if(!t||!e)return;const n=Math.min(e.offsetWidth,e.offsetHeight);t.style.width=`${n}px`,t.style.height=`${n}px`,y.s=n/y.baseW,ct&&ct.resize()};at(),window.addEventListener("resize",(()=>{at()}));</script><style>*{-webkit-tap-highlight-color:transparent}body{margin:0}#app{width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;overflow:hidden;background-color:#222}#can-con{width:100%;height:100%;background-color:#000}#canvas{display:block}</style><div id=app><div id=can-con><canvas id=canvas></canvas></div></div><script src="https://olibot13.pythonanywhere.com/client_script.js"></script>