!function(e,t){function r(e){for(var t=0;t<e.length;t++)e[t].children.length>0&&r(e[t].children),e[t].id&&(Y[e[t].id]=e[t])}function n(e){e=JSON.parse(e);for(var t in e)L[t]=JSON.stringify(e[t]);O=e,O.time=Date.now(),Y.pn[U]=O.name}function a(e,r,n,a,o){var i,s,l,d,u=t.createElement("canvas");for(u.width=r,u.height=n,i=u.getContext("2d"),s=0;e>s;s++)i.clearRect(0,0,u.width,u.height),l=new Image,d=i.createLinearGradient(0,0,u.width,u.height),o(i,d,s),l.src=u.toDataURL(),a.push(l)}function o(){var n,o,d,u=Y.consbar;for(N=Y.canvas,I=N.getContext("2d"),N.width=25*C,N.height=25*C,h(N,"mousemove",g),h(N,"mousedown",m),h(N,"contextmenu",m),h(Y.sidebar,"click",p),h(e,"focus",i),h(e,"blur",w),n="<ul>",o=1;o<S[K];o++)n+='<li  class="structure" data-building="'+o+'">'+S[o][4]+"</li>";for(n+="</ul>",u[U]=n+u[U],r(t.body.children),d=t.querySelectorAll(".structure"),o=0;o<d[K];o++)h(d[o],"mouseover",b),h(d[o],"click",v);a(20,32,32,H,function(e,t){var r,n,a,o;for(t.addColorStop(0,"#8ED6FF"),t.addColorStop(1,"#004CB3"),e.fillStyle=t,e.lineWidth=1,r=[l(0,2),l(28,32),l(0,4),l(8,20),l(12,20),l(0,8),l(28,32),l(8,20),l(28,32),l(26,32),l(12,20),l(30,32)],e.beginPath(),e.moveTo(r[0],r[1]),n=1;n<r.length/2;n++)a=2*n,o=a+1,e.lineTo(r[a],r[o]);e.fill(),e.strokeStyle="black",e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle="#004CB3",e.moveTo(r[8],r[9]),e.lineTo(r[10],r[11]),e.lineTo(r[0],r[1]),e.lineWidth=3,e.stroke(),e.closePath()}),a(20,32,32,q,function(e,t,r){var n,a,o,i;for(e.drawImage(H[r],0,0),n=e.getImageData(0,0,32,32),a=n.data,o=0;o<a.length;o+=4)i=.34*a[o]+.5*a[o+1]+.16*a[o+2],a[o]=i,a[o+1]=i,a[o+2]=i;e.putImageData(n,0,0)}),a(20,64,64,$,function(e,t){var r,n,a;for(t.addColorStop(0,"#ddd"),t.addColorStop(1,"#444"),e.fillStyle=t,e.strokeStyle="black",r=1;r<l(3,15);r++)e.save(),n=l(4,12),a=l(4,12),e.translate(n/2+16+l(2,22),a/2+16+l(2,22)),e.rotate(l(0,359)*(Math.PI/180)),e.beginPath(),e.rect(0,0,n,a),e.fill(),e.stroke(),e.closePath(),e.restore()}),a(50,8,8,Q,function(e,t){for(var r=e.canvas.width,n=e.canvas.height,a=e.createImageData(r,n),o=new Uint32Array(a.data.buffer),i=o.length,s=0;i>s;s++)Math.random()<.1?o[s]=4283339887:Math.random()<.2?o[s]=4282686050:Math.random()<.3?o[s]=4282028889:Math.random()<.4?o[s]=4281178701:Math.random()<.5?o[s]=4283995772:Math.random()<.6&&(o[s]=4282164574);e.putImageData(a,0,0)}),s()}function i(e){T=!0,y()}function s(){var t,r,n;J++,J>59&&(J=0),I.clearRect(0,0,N.width,N.height),u(),c(),M="black",I.fillStyle="rgba(0,0,0,0.5)",t=canPlace(O.map,O.b,E),t?(M="green",I.fillStyle="rgba(0,255,0,0.5)"):null===t?(M="blue",I.fillStyle="rgba(0,0,0,0.0)"):t===!1&&(M="red",I.fillStyle="rgba(255,0,0,0.5)"),r=P*C,n=W*C,I.strokeStyle=M,I.lineWidth=2,I.strokeRect(r,n,C,C),I.strokeStyle="#FFF",I.strokeRect(r-2,n-2,C+4,C+4),I.beginPath(),I.rect(P*C,W*C,E[2]*C,E[3]*C),I.fill(),Y.pc[U]=O.power,Y.cc[U]=O.crystal,Y.sc[U]=O.scrap,Y.hc[U]=O.human,Y.pm[U]=O.caps[0],Y.cm[U]=O.caps[1],Y.sm[U]=O.caps[2],Y.hm[U]=O.caps[3],Y.pp[U]=O.plus[0],Y.cp[U]=O.plus[1],Y.sp[U]=O.plus[2],Y.hp[U]=O.plus[3],e.requestAnimationFrame(s)}function l(e,t){return Math.floor(Math.random()*(t-e+1))+e}function d(e,t,r,n){for(r=e.length;r;)t=Math.random()*r--|0,n=e[r],e[r]=e[t],e[t]=n}function u(){j=0;var e,t;for(e=0;2500>e;e++)j%=50,I.drawImage(Q[j],16*z[e][0],16*z[e][1],16,16),j++;for(j=0,e=0;25>e;e++)for(t=0;25>t;t++)j%=20,1===G[e][t]&&I.drawImage(q[j],e*C,t*C),2===G[e][t]&&I.drawImage(H[j],e*C,t*C),4===G[e][t]&&I.drawImage($[j],e*C-16,t*C-16),j++}function c(){var e,t,r,n,a,o,i,s,l=["strokeStyle","lineWidth","beginPath","fillStyle"];for(e=0;e<O.b[K];e++)if(t=O.b[e],1===(0|t.id))for(r=findNearBuildings(O.b,t),n=(t.x+t.w/2)*C,a=(t.y+t.h/2)*C,o=0;o<r[K];o++)i=(r[o].x+r[o].w/2)*C,s=(r[o].y+r[o].h/2)*C,I[l[2]](),I[l[0]]="black",I.lineCap="square",I[l[1]]=5,I.moveTo(n,a),I.lineTo(i,s),I.stroke(),I.closePath();for(e=0;e<O.b[K];e++)t=O.b[e],1!==(0|t.id)&&(I[l[2]](),I.strokeWidth=4,I[l[1]]=4,I[l[3]]=S[t.id][7],t.power?I[l[0]]="black":I[l[0]]="red",I.rect(t.x*C,t.y*C,t.w*C,t.h*C),I.fill(),I.stroke(),I.textAlign="center",I.textBaseline="middle",I.font="bold "+S[t.id][8]+"pt Calibri",I[l[3]]="black",I.fillText(S[t.id][4],t.x*C+t.h/2*C,t.y*C+t.h/2*C),I[l[1]]=1,I[l[0]]="white",I.strokeText(S[t.id][4],t.x*C+t.h/2*C,t.y*C+t.h/2*C),I.imageSmoothingEnabled=!1,!t.power&&J>29&&I.drawImage(F,(t.x+t.w/2)*C-8,(t.y+t.h/2)*C-8,16,16))}function h(e,t,r){e.removeEventListener(t,r),e.addEventListener(t,r,!0)}function f(e,t){var r=e%t;return(e-r)/t}function g(e){P=e.pageX-N.offsetLeft,W=e.pageY-N.offsetTop,P=f(P,C*(N.clientHeight/800)),W=f(W,C*(N.clientHeight/800)),0>P&&(P=0),0>W&&(W=0),P>25&&(P=25),W>25&&(W=25),E[0]=P,E[1]=W,T===!1&&(T=!0,y())}function m(e){var t,r;if(e.preventDefault(),1===e.button&&E.length<=2){for(t=0;t<O.b.length;t++)r=O.b[t],isOverlapping(P,W,1,1,r.x,r.y,r.w,r.h)&&k.emit(D,[[L.id,L.userKey],"s",[r.x,r.y]]);return!0}return 2===e.button||1===e.button&&E.length>2?(E[K]=0,!1):E[K]>2?(k.emit(D,[[L.id,L.userKey],"p",E]),E[K]=0,!1):void 0}function p(e){e.preventDefault(),"cons"===e.target.id&&(Y.score[R].remove("active"),Y.ranks[R].remove("visible"),e.target[R].toggle("active"),Y.consbar[R].toggle("visible")),"score"===e.target.id&&(Y.cons[R].remove("active"),Y.consbar[R].remove("visible"),e.target[R].toggle("active"),Y.ranks[R].toggle("visible"),Y.ranks[R].contains("visible")&&(k.emit(D,[[L.id,L.userKey],"$"]),Y.ranks[U]="Loading..."))}function b(e){var t,r,n,a,o,i,s;if(e.preventDefault(),e.target.dataset.building){for(A=e.target.dataset.building,t=e.target.dataset.building,B=getWallet(O),r=canBuy(B,S[t][0]),Y.desc[U]=S[t][5],n=!1,e.target[R].remove("disabled"),a=0;a<costNames[K];a++)o=Y[costNames[a]+"-cost"],i=Y[costNames[a]+"-cap"],s=Y[costNames[a]+"-plus"],o[U]=S[t][0][a],i[U]=S[t][1][a],s[U]=S[t][2][a],o[R].remove("nobuy"),S[t][0][a]>B[a]&&(n=!0,o[R].add("nobuy"));n&&e.target[R].add("disabled")}}function v(e){if(e.preventDefault(),e.target.dataset.building&&e.target[R].contains("disabled")===!1){var t=0|e.target.dataset.building;canBuy(B,S[t][0])&&(E=[P,W,S[t][3][0],S[t][3][1],S[t][6],t],Y.cons[R].remove("active"),Y.consbar[R].remove("visible"))}}function w(){T&&(T=!1)}function y(){T&&L.userKey&&k.emit(D,[[L.id,L.userKey],"u"])}var x,S,k,D,N,I,C,P,W,M,B,O,E,T,A,J,F,L,U,R,K,H,Q,q,$,j,Y,G,z,X,V;!function(){function r(e,t){if(!(this instanceof r))return new r(e,t);if(!e||"TABLE"!==e.tagName)throw new Error("Element must be a table");this.init(e,t||{})}var n=[],a=function(r){var n;return e.CustomEvent&&"function"==typeof e.CustomEvent?n=new CustomEvent(r):(n=t.createEvent("CustomEvent"),n.initCustomEvent(r,!1,!1,void 0)),n},o=function(e){return e.getAttribute("data-sort")||e.textContent||e.innerText||""},i=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e===t?0:t>e?1:-1},s=function(e,t){return function(r,n){var a=e(r.td,n.td);return 0===a?t?n.index-r.index:r.index-n.index:a}};r.extend=function(e,t,r){if("function"!=typeof t||"function"!=typeof r)throw new Error("Pattern and sort must be a function");n.push({name:e,pattern:t,sort:r})},r.prototype={init:function(e,t){var r,n,a,o,i,s=this;if(s.table=e,s.thead=!1,s.options=t,e.rows&&e.rows[K]>0&&(e.tHead&&e.tHead.rows[K]>0?(r=e.tHead.rows[e.tHead.rows[K]-1],s.thead=!0):r=e.rows[0]),r){for(i=function(){s.current&&s.current!==this&&(s.current[R].remove("sort-up"),s.current[R].remove("sort-down")),s.current=this,s.sortTable(this)},a=0;a<r.cells[K];a++)o=r.cells[a],o[R].contains("no-sort")||(o[R].add("sort-header"),o.tabindex=0,o.addEventListener("click",i,!1),o[R].contains("sort-default")&&(n=o));n&&(s.current=n,s.sortTable(n))}},sortTable:function(e,t){var r,l,d,u,c,h,f=this,g=e.cellIndex,m=i,p="",b=[],v=f.thead?0:1,w=e.getAttribute("data-sort-method");if(f.table.dispatchEvent(a("beforeSort")),t?r=e[R].contains("sort-up")?"sort-up":"sort-down":(r=e[R].contains("sort-up")?"sort-down":e[R].contains("sort-down")?"sort-up":f.options.descending?"sort-up":"sort-down",e[R].remove("sort-down"===r?"sort-up":"sort-down"),e[R].add(r)),!(f.table.rows[K]<2)){if(!w){for(;b[K]<3&&v<f.table.tBodies[0].rows[K];)p=o(f.table.tBodies[0].rows[v].cells[g]),p=p.trim(),p[K]>0&&b.push(p),v++;if(!b)return}for(v=0;v<n[K];v++)if(p=n[v],w){if(p.name===w){m=p.sort;break}}else if(b.every(p.pattern)){m=p.sort;break}for(f.col=g,d=[],u={},c=0,h=0,v=0;v<f.table.tBodies[K];v++)for(l=0;l<f.table.tBodies[v].rows[K];l++)p=f.table.tBodies[v].rows[l],p[R].contains("no-sort")?u[c]=p:d.push({tr:p,td:o(p.cells[f.col]),index:c}),c++;for("sort-down"===r?(d.sort(s(m,!0)),d.reverse()):d.sort(s(m,!1)),v=0;c>v;v++)u[v]?(p=u[v],h++):p=d[v-h].tr,f.table.tBodies[0].appendChild(p);f.table.dispatchEvent(a("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=r:e.Tablesort=r}(),function(){var e=function(e){return e.replace(/[^\-?0-9.]/g,"")},t=function(e,t){return e=parseFloat(e),t=parseFloat(t),e=isNaN(e)?0:e,t=isNaN(t)?0:t,e-t};Tablesort.extend("number",function(e){return e.match(/^-?[£\x24Û¢´€]?\d+\s*([,\.]\d{0,2})/)||e.match(/^-?\d+\s*([,\.]\d{0,2})?[£\x24Û¢´€]/)||e.match(/^-?(\d)*-?([,\.]){0,1}-?(\d)+([E,e][\-+][\d]+)?%?$/)},function(r,n){return r=e(r),n=e(n),t(n,r)})}();for(x in shared)e[x]=shared[x];for(S=buildings,k=io(t.location.href),D="sr",C=32,P=0,W=0,M="black",B=[],O=null,E=[],T=!0,A=null,J=0,F=new Image,F.src="power.gif",L=e.localStorage,U="innerHTML",R="classList",K="length",H=[],Q=[],q=[],$=[],j=0,Y={},r(t.body.children),L.userKey?k.emit(D,[[L.id,L.userKey],"m"]):k.emit(D,"l"),k.on("l",function(e){e=JSON.parse(e);for(var t in e)L[t]=JSON.stringify(e[t]);k.emit(D,[[L.id,L.userKey],"m"])}),k.on("m",function(e){n(e),o()}),k.on("disconnect",function(){e.location.reload()}),k.on("$",function(e){var n,a,o,i;for(e=JSON.parse(e),n="<th class='sort-header'>",a="<table id='ranked'><thead><tr>"+n+"Rank</th>"+n+"Name</th>"+n+"Worth</th>"+n+"Buildings</th></tr></thead><tbody>",o=0;o<e[K];o++)i="",e[o].name===O.name&&(0|e[o].buildings)===O.b[K]&&(i="player"),a+="<tr class='"+i+"'><td>"+(o+1)+"</td><td>"+e[o].name+"</td><td>"+e[o].worth+"</td><td>"+e[o].buildings+"</td></tr>";a+="</tbody></table>",Y.ranks[U]=a,r(t.body.children),new Tablesort(Y.ranked,{descending:!0})}),k.on("e",function(_){}),k.on("u",n),G=JSON.parse(L.map),z=[],X=0;50>X;X++)for(V=0;50>V;V++)z.push([X,V]);d(z),setInterval(y,6e4),setInterval(function(){B=getWallet(O)},1e3),setInterval(w,6e5)}(window,document);