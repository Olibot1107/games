!function(){"use strict";function t(t){const e=[];return[i=>{const n=t;t=i;let s=e;for(;s[2]&&(s=s[2],s[0](i,n),i===t););},t=>{let i=e;for(;i[2];)i=i[2];return i=i[2]=[t,i],()=>{i&&(i[1][2]=i[2],i=0)}},()=>t]}let e=()=>{};let i,n,s={};function h(t,...e){(s[t]||[]).map((t=>t(...e)))}let o={get:(t,i)=>"_proxy"==i||e};function r(){return i}function a(){return n}function c(t,e,i){return Math.min(Math.max(t,i),e)}class l{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new l(this.x+t.x,this.y+t.y,this)}subtract(t){return new l(this.x-t.x,this.y-t.y,this)}scale(t){return new l(this.x*t,this.y*t)}normalize(t=this.length()){return new l(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,n){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=n}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?c(this._a,this._d,t):t}set y(t){this._y=this._c?c(this._b,this._e,t):t}}function u(){return new l(...arguments)}class d extends class{constructor(t){return this.init(t)}init(t={}){this.position=u(),this.velocity=u(),this.acceleration=u(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=a(),render:n=this.draw,update:s=this.advance,children:h=[],anchor:o={x:0,y:0},opacity:r=1,rotation:c=0,scaleX:l=1,scaleY:u=1,...d}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:o,opacity:r,rotation:c,scaleX:l,scaleY:u,...d}),this._di=!0,this._uw(),this.addChild(h),this._rf=n,this._uf=s}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:n=0,_wsx:s=1,_wsy:h=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=s*this.scaleX,this._wsy=h*this.scaleY,this._wx=this._wx*s,this._wy=this._wy*h,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=n+this.rotation;let{x:o,y:r}=function(t,e){let i=Math.sin(e),n=Math.cos(e);return{x:t.x*n-t.y*i,y:t.x*i+t.y*n}}({x:this._wx,y:this._wy},n);this._wx=o,this._wy=r,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||e,t._pc()}))}removeChild(...t){t.flat().map((t=>{(function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0})(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class f extends d{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...n}={}){super.init({image:t,width:e,height:i,...n})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function p(){return new f(...arguments)}let g=/(\d+)(\w+)/;class _ extends d{init({text:t="",textAlign:e="",lineHeight:i=1,font:n=a().font,...s}={}){t=""+t,super.init({text:t,textAlign:e,lineHeight:i,font:n,...s}),this._p()}get width(){return this._w}set width(t){this._d=!0,this._w=t,this._fw=t}get text(){return this._t}set text(t){this._d=!0,this._t=""+t}get font(){return this._f}set font(t){this._d=!0,this._f=t,this._fs=function(t){let e=t.match(g),i=+e[1];return{size:i,unit:e[2],computed:i}}(t).computed}get lineHeight(){return this._lh}set lineHeight(t){this._d=!0,this._lh=t}render(){this._d&&this._p(),super.render()}_p(){this._s=[],this._d=!1;let t=this.context;if(t.font=this.font,!this._s.length&&this._fw){let e=this.text.split(" "),i=0,n=2;for(;n<=e.length;n++){let s=e.slice(i,n).join(" ");t.measureText(s).width>this._fw&&(this._s.push(e.slice(i,n-1).join(" ")),i=n-1)}this._s.push(e.slice(i,n).join(" "))}if(!this._s.length&&this.text.includes("\n")){let e=0;this.text.split("\n").map((i=>{this._s.push(i),e=Math.max(e,t.measureText(i).width)})),this._w=this._fw||e}this._s.length||(this._s.push(this.text),this._w=this._fw||t.measureText(this.text).width),this.height=this._fs+(this._s.length-1)*this._fs*this.lineHeight,this._uw()}draw(){let t=0,e=this.textAlign,i=this.context;e=this.textAlign||("rtl"==i.canvas.dir?"right":"left"),t="right"==e?this.width:"center"==e?this.width/2|0:0,this._s.map(((n,s)=>{i.textBaseline="top",i.textAlign=e,i.fillStyle=this.color,i.font=this.font,i.fillText(n,t,this._fs*this.lineHeight*s)}))}}function x(){return new _(...arguments)}let w=new WeakMap,m={},y={},b={0:"left",1:"middle",2:"right"};function v(t=r()){return w.get(t)}function E(t,e){let{x:i,y:n,width:s,height:h}=function(t){let{x:e=0,y:i=0,width:n,height:s}=t.world||t;return t.mapwidth&&(n=t.mapwidth,s=t.mapheight),t.anchor&&(e-=n*t.anchor.x,i-=s*t.anchor.y),n<0&&(e+=n,n*=-1),s<0&&(i+=s,s*=-1),{x:e,y:i,width:n,height:s}}(t);do{i-=t.sx||0,n-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(i,Math.min(e.x,i+s)),r=e.y-Math.max(n,Math.min(e.y,n+h));return o*o+r*r<e.radius*e.radius}function S(t,e){return parseFloat(t.getPropertyValue(e))||0}function M(t){let e=null!=t.button?b[t.button]:"left";y[e]=!0,j(t,"onDown")}function A(t){let e=null!=t.button?b[t.button]:"left";y[e]=!1,j(t,"onUp")}function C(t){j(t,"onOver")}function k(t){w.get(t.target)._oo=null,y={}}function Y(t,e,i){let n=function(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let n=e[i];if(n.collidesWithPointer?n.collidesWithPointer(t):E(n,t))return n}}(t);n&&n[e]&&n[e](i),m[e]&&m[e](i,n),"onOver"==e&&(n!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=n)}function j(t,e){t.preventDefault();let i=t.target,n=w.get(i),{scaleX:s,scaleY:o,offsetX:r,offsetY:a}=function(t){let{canvas:e,_s:i}=t,n=e.getBoundingClientRect(),s="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],h=parseFloat(s[0]),o=parseFloat(s[3]),r=(S(i,"border-left-width")+S(i,"border-right-width"))*h,a=(S(i,"border-top-width")+S(i,"border-bottom-width"))*o,c=(S(i,"padding-left")+S(i,"padding-right"))*h,l=(S(i,"padding-top")+S(i,"padding-bottom"))*o;return{scaleX:(n.width-r-c)/e.width,scaleY:(n.height-a-l)/e.height,offsetX:n.left+(S(i,"border-left-width")+S(i,"padding-left"))*h,offsetY:n.top+(S(i,"border-top-width")+S(i,"padding-top"))*o}}(n);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let h=n.touches[i];h||(h=n.touches[i]={start:{x:(t-r)/s,y:(e-a)/o}},n.touches.length++),h.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:c,identifier:l})=>{let u=n.touches[l];u.changed=!0,u.x=n.x=(i-r)/s,u.y=n.y=(c-a)/o,Y(n,e,t),h("touchChanged",t,n.touches),"onUp"==e&&(delete n.touches[l],n.touches.length--,n.touches.length||h("touchEnd"))}))):(n.x=(t.clientX-r)/s,n.y=(t.clientY-a)/o,Y(n,e,t))}function L({radius:t=5,canvas:e=r()}={}){let i=w.get(e);if(!i){let n=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:n},w.set(e,i)}var n,h;return e.addEventListener("mousedown",M),e.addEventListener("touchstart",M),e.addEventListener("mouseup",A),e.addEventListener("touchend",A),e.addEventListener("touchcancel",A),e.addEventListener("blur",k),e.addEventListener("mousemove",C),e.addEventListener("touchmove",C),i._t||(i._t=!0,h=()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0},s[n="tick"]=s[n]||[],s[n].push(h)),i}function z(t,e){let i=t[0].toUpperCase()+t.substr(1);m["on"+i]=e}function P(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}class X{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let n=this.size;n--;)e=this.objects[n],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}var D,B;!function(t){t.Message="A",t.Objects="B",t.Creation="C",t.Deletion="D",t.Scored="E",t.Positions="F",t.Scoreboard="G"}(D||(D={})),function(t){t.Message="A",t.Click="B"}(B||(B={}));const O={volume:.3,sampleRate:44100,x:new(window.AudioContext||webkitAudioContext),play:function(...t){return this.playSamples(this.buildSamples(...t))},playSamples:function(...t){const e=this.x.createBuffer(t.length,t[0].length,this.sampleRate),i=this.x.createBufferSource();return t.map(((t,i)=>e.getChannelData(i).set(t))),i.buffer=e,i.connect(this.x.destination),i.start(),i},buildSamples:function(t=1,e=.05,i=220,n=0,s=0,h=.1,o=0,r=1,a=0,c=0,l=0,u=0,d=0,f=0,p=0,g=0,_=0,x=1,w=0,m=0){const y=2*Math.PI;let b,v,E=this.sampleRate,S=a*=500*y/E/E,M=i*=(1+2*e*Math.random()-e)*y/E,A=[],C=0,k=0,Y=0,j=1,L=0,z=0,P=0;for(c*=500*y/E**3,p*=y/E,l*=y/E,u*=E,d=d*E|0,v=(n=n*E+9)+(w*=E)+(s*=E)+(h*=E)+(_*=E)|0;Y<v;A[Y++]=P)++z%(100*g|0)||(P=o?o>1?o>2?o>3?Math.sin((C%y)**3):Math.max(Math.min(Math.tan(C),1),-1):1-(2*C/y%2+2)%2:1-4*Math.abs(Math.round(C/y)-C/y):Math.sin(C),P=(d?1-m+m*Math.sin(y*Y/d):1)*(P>0?1:-1)*Math.abs(P)**r*t*this.volume*(Y<n?Y/n:Y<n+w?1-(Y-n)/w*(1-x):Y<n+w+s?x:Y<v-_?(v-Y-_)/h*x:0),P=_?P/2+(_>Y?0:(Y<v-_?1:(v-Y)/_)*A[Y-_|0]/2):P),b=(i+=a+=c)*Math.cos(p*k++),C+=b-b*f*(1-1e9*(Math.sin(Y)+1)%2),j&&++j>u&&(i+=l,M+=l,j=0),!d||++L%d||(i=M,a=S,j=j||1);return A},getNote:function(t=0,e=440){return e*2**(t/12)}},T="YoYo Haku Pool",$=new Map,{canvas:H,context:R}=function(t,{contextless:e=!1}={}){if(i=document.getElementById(t)||t||document.querySelector("canvas"),e&&(i=i||new Proxy({},o)),!i)throw Error("You must provide a canvas element for the game");return n=i.getContext("2d")||new Proxy({},o),n.imageSmoothingEnabled=!1,h("init"),{canvas:i,context:n}}(document.querySelector("#canvas")),q=document.querySelector("#b1 textarea"),F=document.querySelector("#b2 textarea"),I=document.querySelector("#b3 input"),W=document.querySelector("#b4 button"),U=document.querySelector("img[src='table.webp']"),N=io({path:location.pathname+'socket.io',upgrade:!1,transports:["websocket"]}),[V,G]=t(),[J,K]=t(),[Q,Z]=t(),[tt,et]=t(),[it,nt,st]=t(!1),[ht,,ot]=t(null),[rt,,at]=t(Date.now()),[ct,,lt]=t(!1),ut=[2.01,,773,.02,.01,.01,1,1.14,44,-27,,,,,.9,,.18,.81,.01],dt=[1.35,,151,.1,.17,.26,1,.34,-4.1,-5,-225,.02,.14,.1,,.1,.13,.9,.22,.17],ft=[,,999,.2,.04,.15,4,2.66,-.5,22,,,,.1,,,,,.02],pt=[,,727,.02,.03,0,3,.09,4.4,-62,,,,,,,.19,.65,.2,.51],gt=p({image:U}),_t=function(){return new X(...arguments)}({create:x});function xt(){const t=ot();var e,i;t&&(st()&&(e=t.position,i=v(),R.beginPath(),R.strokeStyle="#fff",R.moveTo(e.x,e.y),R.lineTo(i.x,i.y),R.stroke()),t.render())}function wt(t){const e=p({x:340,y:340,anchor:{x:.5,y:.5},render:()=>{e.context.fillStyle=t.color,e.context.beginPath(),e.context.arc(0,0,14,0,2*Math.PI),e.context.fill()}}),i=p({anchor:{x:.5,y:.5},render:()=>{e.context.fillStyle="#fff",e.context.beginPath(),e.context.arc(0,0,14/1.5,0,2*Math.PI),e.context.fill()}});e.addChild(i);const n=x({text:t.label,font:"14px monospace",color:"black",anchor:{x:.5,y:.5},textAlign:"center"});return e.addChild(n),$.set(t.id,e),t.ownerSocketId===N.id&&ht(e),e}function mt(t){vt(ut),F.value+=`${(new Date).getHours().toString().padStart(2,"0")}:${(new Date).getMinutes().toString().padStart(2,"0")} ${t}\n`,F!==document.activeElement&&(F.scrollTop=F.scrollHeight)}function yt(){const t=I.value.trim();if(I.value="",t.length){if(!t.startsWith("/help"))return t.startsWith("/soundon")?(mt("📢 Sounds enabled."),ct(!0)):t.startsWith("/soundoff")?(mt("📢 Sounds disabled."),ct(!1)):void N.emit(B.Message,t);mt(`ℹ️ ${T} puts you in control of a yoyo on a multiplayer pool table!\n\nThe goal is to keep the highest score as long as possible.\n\nClick or touch the table to pull your yoyo.\n\nEach ball has a value, and you should use yoyo maneuvers to bring them into the corner pockets.\n\nIf you push another yoyo into a corner pocket, you get part of their score, implying that you also lose part of your score if you end up in a corner pocket.\n\nWhen the table is clean, balls are brought back to the table. Tip: Focus on pocketing the balls with high value first.\n\nThere are several tables in the room, and you can communicate with players from other tables through this chat.\n\nYou can also run the following commands here:\n\nCommand: /nick <nickname>\nEffect: Changes your nickname.\n\nCommand: /newtable\nEffect: Starts a new game on an empty table.\n\nCommand: /jointable <number>\nEffect: Joins the game from a specific table.\n\nCommand: /soundon\nEffect: Enables sounds.\n\nCommand: /soundoff\nEffect: Disables sounds.\n`)}}function bt(){document.documentElement.style.setProperty("--inner-height",`${window.innerHeight}px`),function(t){if(!t.parentElement)return;const{width:e,height:i,style:n,parentElement:s}=t,{clientWidth:h,clientHeight:o}=s,r=h/e,a=o/i,c=r<a?r:a;n.marginTop=(o-i*c)/2+"px",n.marginLeft=(h-e*c)/2+"px",n.width=e*c+"px",n.height=i*c+"px"}(H)}function vt(t){lt()&&function(...t){O.play(...t)}(...t)}G((function(){!function(){if(!st()||Date.now()-at()<125)return;const{x:t,y:e}=v();N.emit(B.Click,Math.trunc(t),Math.trunc(e)),rt(Date.now())}(),$.forEach((t=>{const e=180*t.rotation/Math.PI+7*(Math.abs(t.dx)+Math.abs(t.dy));t.rotation=(e>360?e-360:e)*Math.PI/180,t.update()})),_t.update()})),K((function(){gt.render(),$.forEach((t=>{t!==ot()&&t.render()})),xt(),_t.render()})),et((function(){return function({fps:t=60,clearCanvas:i=!0,update:n=e,render:s,context:o=a(),blur:r=!1}={}){if(!s)throw Error("You must provide a render() function");let c,l,u,d,f,p=0,g=1e3/t,_=1/t,x=i?P:e,w=!0;function m(){if(l=requestAnimationFrame(m),w&&(u=performance.now(),d=u-c,c=u,!(d>1e3))){for(h("tick"),p+=d;p>=g;)f.update(_),p-=g;x(o),f.render()}}return r||(window.addEventListener("focus",(()=>{w=!0})),window.addEventListener("blur",(()=>{w=!1}))),f={update:n,render:s,isStopped:!0,start(){c=performance.now(),this.isStopped=!1,requestAnimationFrame(m)},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:m,set _last(t){c=t}},f}({update:V,render:J}).start()})),Z((function(){document.title=T,mt(`👋 Welcome to ${T}!\n\nℹ️ New to this game? Enter /help in the message field below to learn about it.\n`),H.width=H.height=680,bt(),L({radius:0}),tt()})),nt((function(t){H.style.cursor=t?"grabbing":"grab"})),z("down",(function(){ot()&&(vt(ft),it(!0))})),z("up",(function(){it(!1)})),window.addEventListener("load",Q),window.addEventListener("resize",bt),window.addEventListener("click",(function(){ct(!0),vt(ut)}),{once:!0}),W.addEventListener("click",yt),I.addEventListener("keyup",(function(t){"Enter"===t.key&&yt()})),N.on(D.Message,mt),N.on(D.Objects,(function(t){$.clear(),t.forEach((t=>wt(t)))})),N.on(D.Positions,(function(t){t.forEach((([t,e,i])=>{const n=$.get(t);if(n){const t=u(e,i);0!=t.distance(n.position)?function(t,e){const i=t.subtract(e.position);e.dx=i.x/7.5,e.dy=i.y/7.5}(t,n):function(t){t.ddx=t.ddy=t.dx=t.dy=0}(n)}}))})),N.on(D.Creation,wt),N.on(D.Deletion,(function(t){const e=$.get(t);e&&(e===ot()&&ht(null),$.delete(t))})),N.on(D.Scored,(function(t,e,i){vt(t<0?pt:dt);const n=_t.get({text:`${t>0?"+":""}${t}${t>0?"✨":"💀"}`,font:"36px monospace",color:t>0?"#F9D82B":"#3B3B3B",x:e,y:i,anchor:{x:.5,y:.5},textAlign:"center",dy:-1,dx:1,update:()=>{n.advance(),n.opacity-=.01,n.opacity<0&&(n.ttl=0),(n.x>e+2||n.x<e-2)&&(n.dx*=-1)}})})),N.on(D.Scoreboard,(function(t,e){let i=0;if(t[0]){const[,e]=t[0];i=e.toString().length}const n=t.reduce(((t,[e])=>Math.max(t,e.length)),0);function s([t,e,s]){const h=String(e).padStart(i,"0"),o=t.padEnd(n," ");q.value+=`${h} | ${o} | Table ${s}\n`}q.value="TABLE SCOREBOARD\n\n",e.forEach(s),q.value+="\n\nOVERALL SCOREBOARD\n\n",t.forEach(s)}))}();
