const canvas=document.getElementById("c"),ctx=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;const scoreDiv=document.getElementById("score");let score=0,cat={x:canvas.width/2,y:canvas.height/2,size:20,speed:3,angle:0,targetX:null,targetY:null,maxTurnRate:Math.PI/18},fish=[],trail=[],trailLength=10,keys={},useMouseControl=!1,autoMode=!1;const controlSwitch=document.getElementById("controlSwitch"),autoSwitch=document.getElementById("autoSwitch");function toggleControlMode(){autoMode||(useMouseControl=!useMouseControl,controlSwitch.textContent=useMouseControl?"Switch to Keyboard":"Switch to Mouse")}function toggleAutoMode(){autoMode=!autoMode,autoSwitch.textContent=autoMode?"Disable Auto Hunt":"Enable Auto Hunt",controlSwitch.disabled=autoMode,controlSwitch.style.opacity=autoMode?"0.5":"1"}function spawnFish(){return{x:Math.random()*(canvas.width-40)+20,y:Math.random()*(canvas.height-40)+20,size:10}}function playFishSound(){try{zzfx(...[,,537,.02,.02,.22,1,1.59,-6.98,4.97])}catch(t){console.log("Sound error:",t)}}function drawCatHead(){ctx.lineWidth=1.5,ctx.strokeStyle="#333",trail.forEach((t,e)=>{const c=.4-.3*e/trail.length;ctx.fillStyle=`rgba(0,0,0,${c})`,ctx.save(),ctx.translate(t.x,t.y),ctx.rotate(t.angle),ctx.beginPath(),ctx.ellipse(0,0,.6*cat.size,.4*cat.size,0,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore()}),ctx.save(),ctx.translate(cat.x,cat.y),ctx.rotate(cat.angle),ctx.fillStyle="black",ctx.beginPath(),ctx.ellipse(0,0,cat.size,.7*cat.size,0,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.restore(),drawCatHead(cat.x,cat.y),(autoMode||useMouseControl)&&null!==cat.targetX&&null!==cat.targetY&&(ctx.strokeStyle="#ff0",ctx.setLineDash([5,3]),ctx.beginPath(),ctx.moveTo(cat.x,cat.y),ctx.lineTo(cat.targetX,cat.targetY),ctx.stroke(),ctx.setLineDash([]),ctx.fillStyle="#ff0",ctx.beginPath(),ctx.arc(cat.targetX,cat.targetY,5,0,2*Math.PI),ctx.fill())}function drawCat(){ctx.fillStyle="rgba(0,0,0,0.4)",trail.forEach(t=>{ctx.beginPath(),ctx.arc(t.x,t.y,.7*cat.size,0,2*Math.PI),ctx.fill()}),ctx.fillStyle="black",ctx.beginPath(),ctx.arc(cat.x,cat.y,cat.size,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.moveTo(cat.x-12,cat.y-5),ctx.lineTo(cat.x-22,cat.y-20),ctx.lineTo(cat.x-2,cat.y-15),ctx.fill(),ctx.beginPath(),ctx.moveTo(cat.x+12,cat.y-5),ctx.lineTo(cat.x+22,cat.y-20),ctx.lineTo(cat.x+2,cat.y-15),ctx.fill(),ctx.fillStyle="white",ctx.beginPath(),ctx.arc(cat.x-6,cat.y-5,3,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.arc(cat.x+6,cat.y-5,3,0,2*Math.PI),ctx.fill()}function drawFish(){fish.forEach(t=>{ctx.fillStyle="orange",ctx.beginPath(),ctx.arc(t.x,t.y,t.size,0,2*Math.PI),ctx.fill(),ctx.beginPath(),ctx.moveTo(t.x-10,t.y),ctx.lineTo(t.x-20,t.y-8),ctx.lineTo(t.x-20,t.y+8),ctx.closePath(),ctx.fill()})}function findNearestFish(){if(0===fish.length)return null;let t=fish[0],e=1/0;for(const c of fish){const a=Math.hypot(cat.x-c.x,cat.y-c.y);a<e&&(e=a,t=c)}return t}function update(){let t=0,e=0,c=cat.angle;if(autoMode){const c=findNearestFish();c&&(cat.targetX=c.x,cat.targetY=c.y,t=cat.targetX-cat.x,e=cat.targetY-cat.y)}else useMouseControl?null!==cat.targetX&&null!==cat.targetY&&(t=cat.targetX-cat.x,e=cat.targetY-cat.y):((keys.ArrowUp||keys.w)&&(e-=1),(keys.ArrowDown||keys.s)&&(e+=1),(keys.ArrowLeft||keys.a)&&(t-=1),(keys.ArrowRight||keys.d)&&(t+=1));if(0!==t||0!==e){c=Math.atan2(e,t);let a=c-cat.angle;for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;a>cat.maxTurnRate?cat.angle+=cat.maxTurnRate:a<-cat.maxTurnRate?cat.angle-=cat.maxTurnRate:cat.angle=c,cat.x+=Math.cos(cat.angle)*cat.speed,cat.y+=Math.sin(cat.angle)*cat.speed}for(cat.x=Math.max(cat.size,Math.min(canvas.width-cat.size,cat.x)),cat.y=Math.max(cat.size,Math.min(canvas.height-cat.size,cat.y)),trail.push({x:cat.x,y:cat.y,angle:cat.angle});trail.length>trailLength;)trail.shift();fish=fish.filter(t=>!(Math.hypot(cat.x-t.x,cat.y-t.y)<cat.size+t.size)||(score++,scoreDiv.textContent="Score: "+score,trailLength+=2,playFishSound(),fish.push(spawnFish()),!1)),0===fish.length&&fish.push(spawnFish())}function gameLoop(){ctx.clearRect(0,0,canvas.width,canvas.height),update(),drawCat(),drawFish(),requestAnimationFrame(gameLoop)}controlSwitch.addEventListener("click",toggleControlMode),autoSwitch.addEventListener("click",toggleAutoMode),document.addEventListener("keydown",t=>keys[t.key]=!0),document.addEventListener("keyup",t=>keys[t.key]=!1),canvas.addEventListener("mousemove",t=>{if(useMouseControl&&!autoMode){const e=canvas.getBoundingClientRect();cat.targetX=t.clientX-e.left,cat.targetY=t.clientY-e.top}}),fish.push(spawnFish()),window.addEventListener("resize",()=>{canvas.width=window.innerWidth,canvas.height=window.innerHeight,cat.x=Math.max(cat.size,Math.min(canvas.width-cat.size,cat.x)),cat.y=Math.max(cat.size,Math.min(canvas.height-cat.size,cat.y))});const fullscreenToggle=document.getElementById("fullscreenToggle");function toggleFullscreen(){document.fullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),fullscreenToggle.textContent="⛶"):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen?document.documentElement.webkitRequestFullscreen():document.documentElement.msRequestFullscreen&&document.documentElement.msRequestFullscreen(),fullscreenToggle.textContent="╳"),setTimeout(()=>{canvas.width=window.innerWidth,canvas.height=window.innerHeight},100)}function updateFullscreenButtonText(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?fullscreenToggle.textContent="╳":fullscreenToggle.textContent="⛶"}fullscreenToggle.addEventListener("click",toggleFullscreen),document.addEventListener("fullscreenchange",updateFullscreenButtonText),document.addEventListener("webkitfullscreenchange",updateFullscreenButtonText),document.addEventListener("mozfullscreenchange",updateFullscreenButtonText),document.addEventListener("MSFullscreenChange",updateFullscreenButtonText),gameLoop();