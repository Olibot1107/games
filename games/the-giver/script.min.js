let gameState="playing",actions="",levelCurrent=1,levelMax=9,lastFoundItem=null;const levelCountRequired=[0,2,5,8,12,15,18,21,24,28];let items={fish:{pattern:"C",src:"images/fish.gif"},ball:{pattern:"HC",src:"images/ball.gif"},mouse:{pattern:"HB",src:"images/mouse.gif"}};const itemsCSV="\nname,pattern,image,x,y\nBag,BCBC,,0,0\nPencil,BCBCBC,,0,40\nChickenHead,BCBCH,,0,80\nFish,BCH,,0,120\nGlitter,BCHC,,0,160\nGlueStick,BCHB,,40,0\nRubber band,BCHCB,,40,40\nFrog,BCHBCH,,40,80\nLitter,BCHCH,,40,120\nFruit,BCHCHC,,40,160\nBall,CB,,80,0\nArmyMan,CBCB,,80,40\nFlag,CBCBCB,,80,80\nWorm,CBCBCBCB,,80,120\nWater,CBCH,,80,160\nApple,HBHB,,0,200\nMouse,CH,,40,200\nShoe,CHCH,,80,200\nBouncyBall,HBCB,,0,240\nDice,HBHBHB,,40,240\nHairBall1,HCB,,80,240\nGrass,HCBC,,120,0\nGrapes,HCBCB,,120,40\nHairBall2,HCBHCB,,120,240\nLeaf,HCH,,120,80\nKeys,HCHC,,120,120\nToy,HCHCH,,120,160\nLego,HCHCB,,120,200\nKeyboardKey,HCHCHC,,160,0\n\n";items=csvToJson(itemsCSV);const deathMessages=["You died! Never pet a cat's belly.","You died! The cat didn't like that.","You died! Soft belly = death.","You died! Cat tricked you into petting its belly."],itemsFound=[];let lastArea=null;function addAction(e){if("lost"===gameState)return;if(!e)return;console.log(e);actions.slice(-1)!=e&&(actions+=e),actions.includes("X")?gameOver():updateUI()}function processActions(){"lost"!==gameState&&(itemAction(actions),checkForLevelUp(),updateUI())}function itemAction(e){if(0===e.length)return;const t=findPatternItem(e);if(t){console.log(`Pattern matched: ${t}`),animateItem(t),lastFoundItem=t.name;const e=itemsFound.find((e=>e.name===t.name));e?e.count++:itemsFound.push({name:t.name,count:1}),coughAudio()}else lastFoundItem=null,meowAudio()}function checkForLevelUp(){levelCurrent<levelMax&&itemsFound.length>=levelCountRequired[levelCurrent]&&(levelCurrent++,levelUpAudio(),levelCurrent===levelMax&&(finalLevelUpAudio(),gameState="won"))}function animateItem(e){if(!e)return;let t=!e.image;const n=document.querySelector("#items");if(!n)return;let o;if(t){const t={x:e.x||0,y:e.y||0,w:e.w||40,h:e.h||40};o=document.createElement("div"),o.className="item animated-item sprite-item";const n=e.spriteSheet||"images/item-spritesheet.gif",a=t;o.style.backgroundImage=`url('${n}')`,o.style.backgroundPosition=`-${a.x}px -${a.y}px`,o.style.width=a.w+"px",o.style.height=a.h+"px",o.style.position="absolute",o.style.top="100px",o.style.left="20px",o.style.opacity="1",o.style.transform="scale(1) rotate(-20deg)"}else{const t="images/"+(e.src||e.name.toLowerCase()+".gif");o=document.createElement("img"),o.src=t,o.alt=e.name,o.className="item animated-item",o.style.position="absolute",o.style.top="100px",o.style.left="20px",o.style.opacity="1",o.style.transform="scale(1) rotate(-20deg)"}n.appendChild(o);const a=Math.floor(301*Math.random())+-180,i=Math.floor(81*Math.random())+190;o.animate([{top:"120px",left:"30px",opacity:1,transform:"scale(1) rotate(-20deg)"},{top:i+"px",left:a+"px",opacity:1,transform:"scale(1.2) rotate(0deg)"}],{duration:1200,easing:"cubic-bezier(.5,1.5,.5,1)",fill:"forwards"})}function findPatternItem(e){for(const t of Object.values(items)){if(e===t.pattern)return t}return null}function gameOver(){gameState="lost",buzzAudio(),updateUI()}function clearActions(){"lost"===gameState&&resetGame(),actions=""}function resetGame(){gameState="playing",itemsFound.length=0,levelCurrent=1;document.querySelectorAll("#items div").forEach((e=>e.remove())),actions="",updateUI()}function updateUI(){if(document.getElementById("level").innerHTML=`Level: ${levelCurrent}`,document.getElementById("progress").innerHTML=`- ${itemsFound.length}/${levelCountRequired[levelCurrent]}`,document.getElementById("inventory").innerHTML=`\n    <ul>\n    ${itemsFound.map((e=>`<li>(x${e.count}) - ${e.name} - ${items[e.name].pattern}</li>`)).join(" ")}\n    </ul>`,"lost"===gameState){const e=deathMessages[Math.floor(Math.random()*deathMessages.length)];document.getElementById("message").innerHTML=`<span style="color: red;">${e}</span>`}else document.getElementById("message").innerHTML="won"===gameState?'<span style="color: green;">You won!</span>':lastFoundItem?`<span>Found: ${lastFoundItem}</span>`:"<span>Pet the cat!</span>";document.getElementById("actions").innerHTML=actions;const e=document.getElementById("cat-img");e.style.backgroundImage="url('images/cat-spritesheet.gif')",e.style.backgroundRepeat="no-repeat",e.style.width="400px",e.style.height="250px";const t={C:{x:0,y:0},X:{x:0,y:200},B:{x:0,y:400},H:{x:0,y:600},L:{x:0,y:800},default:{x:0,y:0}};let n=t.default;const o=actions[actions.length-1];"lost"===gameState?n=t.X:t[o]&&(n=t[o]);e.style.backgroundPosition=`-${n.x*(400/300)}px -${1.25*n.y}px`,e.style.backgroundSize="400px 1000px",e.hasAttribute("src")&&e.removeAttribute("src")}function setUpEventListeners(){let e=!1,t=null,n=null;function o(e){const t=document.elementFromPoint(e.clientX,e.clientY);return t&&t.classList&&t.classList.contains("cat-area")?t.getAttribute("data-area"):null}window.addEventListener("pointerdown",(function(a){e=!0,t=a.pointerId;const i=o(a);clearActions(),i&&addAction(i),n=i})),window.addEventListener("pointerup",(function(o){e&&t===o.pointerId&&(e=!1,t=null,n=null,processActions())})),window.addEventListener("pointercancel",(function(o){e&&t===o.pointerId&&(e=!1,t=null,n=null)})),window.addEventListener("pointermove",(function(a){if(!e||t!==a.pointerId)return;const i=o(a);i!==n&&(i&&addAction(i),n=i)}))}function init(){setUpEventListeners(),updateUI()}function buzzAudio(){const e=new(window.AudioContext||window.webkitAudioContext),t=e.createOscillator(),n=e.createGain();t.type="square",t.frequency.setValueAtTime(120,e.currentTime),n.gain.setValueAtTime(.2,e.currentTime),t.connect(n),n.connect(e.destination),t.start(),t.stop(e.currentTime+.7),t.onended=()=>{e.close()}}function meowAudio(){const e=new(window.AudioContext||window.webkitAudioContext),t=.11+.09*Math.random(),n=e.createOscillator(),o=e.createGain(),a=["square","triangle"],i=a[Math.floor(Math.random()*a.length)];n.type=i;const r=350+120*Math.random(),l=700+180*Math.random(),s=140+80*Math.random(),c=.04+.06*Math.random(),u=.09+.09*Math.random(),m=.22+.12*Math.random(),d=.08+.12*Math.random();console.log("[meowAudio - meow] options:",{duration:t,oscType:i,startFreq:r,peakFreq:l,endFreq:s,upTime:c,downTime:u,peakGain:m,midGain:d}),n.frequency.setValueAtTime(r,e.currentTime),n.frequency.linearRampToValueAtTime(l,e.currentTime+c),n.frequency.linearRampToValueAtTime(s,e.currentTime+t),o.gain.setValueAtTime(.001,e.currentTime),o.gain.linearRampToValueAtTime(m,e.currentTime+.7*c),o.gain.linearRampToValueAtTime(d,e.currentTime+c+u),o.gain.linearRampToValueAtTime(.001,e.currentTime+t),n.connect(o),o.connect(e.destination),n.start(),n.stop(e.currentTime+t),n.onended=()=>e.close()}function coughAudio(){const e=new(window.AudioContext||window.webkitAudioContext),t=.6+.3*Math.random(),n=e.createOscillator(),o=e.createGain(),a=["triangle","sawtooth","square"],i=a[Math.floor(Math.random()*a.length)];n.type=i;const r=500+300*Math.random(),l=60+40*Math.random(),s=20+40*Math.random(),c=.4+.3*Math.random(),u=.6+.3*Math.random(),m=.15+.15*Math.random(),d=t*(.5+.3*Math.random()),p=.1+.1*Math.random();console.log("[coughAudio] options:",{duration:t,oscType:i,startFreq:r,midFreq:l,endFreq:s,startGain:c,peakGain:u,endGain:m,midTime:d,peakTime:p}),n.frequency.setValueAtTime(r,e.currentTime),n.frequency.linearRampToValueAtTime(l,e.currentTime+d),n.frequency.linearRampToValueAtTime(s,e.currentTime+t),o.gain.setValueAtTime(c,e.currentTime),o.gain.linearRampToValueAtTime(u,e.currentTime+p),o.gain.linearRampToValueAtTime(m,e.currentTime+t),n.connect(o),o.connect(e.destination),n.start(),n.stop(e.currentTime+t),n.onended=()=>e.close()}function levelUpAudio(){console.log("[levelUpAudio] Playing level up audio");const e=new(window.AudioContext||window.webkitAudioContext),t=[523.25,659.25,783.99,659.25,783.99],n=.14,o=e.createGain();o.gain.setValueAtTime(.5,e.currentTime),o.connect(e.destination),t.forEach(((a,i)=>{const r=e.createOscillator();r.type="square",r.frequency.setValueAtTime(a,e.currentTime+i*n),r.connect(o),r.start(e.currentTime+i*n),r.stop(e.currentTime+(i+1)*n),r.onended=()=>{i===t.length-1&&e.close()}}))}function finalLevelUpAudio(){const e=new(window.AudioContext||window.webkitAudioContext),t=[523.25,659.25,783.99,1046.5,1318.5,1567.98,1975.53,2093,1567.98,1318.5,1046.5],n=[.13,.13,.13,.13,.13,.13,.13,.18,.09,.09,.22],o=e.createGain();o.gain.setValueAtTime(.5,e.currentTime),o.connect(e.destination);let a=e.currentTime;t.forEach(((i,r)=>{const l=e.createOscillator();l.type=r<7?"triangle":"square",l.frequency.setValueAtTime(i,a),l.connect(o),l.start(a),l.stop(a+n[r]),l.onended=()=>{r===t.length-1&&e.close()},a+=n[r]}))}function csvToJson(e){const t=e.trim().split("\n"),n=(t[0].split(","),{});for(let e=1;e<t.length;e++){const o={},a=t[e].split(","),i=a[0];o.name=a[0],o.pattern=a[1],o.src=a[2],o.x=parseInt(a[3])||0,o.y=parseInt(a[4])||0,n[i]=o}return n}init();