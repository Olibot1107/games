<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Games Directory</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #ddd;
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #7f8c8d;
      font-size: 1.1em;
      margin-bottom: 20px;
    }

    .search-container {
      max-width: 500px;
      margin: 0 auto 30px;
    }

    #search {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 25px;
      font-size: 16px;
      box-sizing: border-box;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    #search:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    .section {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .section-title {
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
    }

    .section-title::before {
      content: "‚≠ê";
      margin-right: 10px;
    }

    .emulators-title::before {
      content: "üïπÔ∏è";
    }

    .good-games-title::before {
      content: "üî•";
    }

    .games-title::before {
      content: "üéÆ";
    }

    ul {
      list-style-type: none;
      padding-left: 0;
    }

    li {
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 10px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }

    li:hover {
      background-color: #f8f9fa;
    }

    a.folder {
      font-weight: 500;
      color: #3498db;
      text-decoration: none;
      flex: 1;
      padding: 5px 0;
    }

    a.folder:hover {
      text-decoration: underline;
    }

    button.favorite {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
      border-radius: 3px;
      transition: background-color 0.2s;
    }

    button.favorite:hover {
      background-color: #f1c40f;
    }

    button.favorite.fav {
      color: #f1c40f;
    }

    .about-section {
      text-align: center;
      padding: 15px;
      background-color: #e8f4fc;
      border-radius: 8px;
      margin-bottom: 25px;
    }

    .about-section a {
      color: #3498db;
      text-decoration: none;
      font-weight: 500;
    }

    .about-section a:hover {
      text-decoration: underline;
    }

    .version-info {
      font-size: 0.9em;
      color: #7f8c8d;
      margin-top: 5px;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #777;
    }

    .error {
      background-color: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .section {
        padding: 15px;
      }

      li {
        flex-direction: column;
        align-items: flex-start;
      }

      a.folder {
        margin-bottom: 5px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Games Directory</h1>
    <p class="subtitle">A collection of web-based games</p>
  </header>

  <div class="search-container">
    <input type="text" id="search" placeholder="Search games...">
  </div>

  <div class="about-section">
    <p>Made with ü§ì | <a href="/updates.html">View Recent Updates</a></p>
    <div class="version-info" id="version-info">Version: Loading...</div>
  </div>

  <div class="section">
    <h2 class="section-title emulators-title">Emulators</h2>
    <ul>
      <li><a href="/tools/rarch/index.html" class="folder">Webretro (All in 1 Emulator)</a></li>
    </ul>
  </div>

  <div class="section">
    <h2 class="section-title">Favorites</h2>
    <ul id="favorites">
      <li class="loading">Loading favorites...</li>
    </ul>
  </div>

  <div class="section">
    <h2 class="section-title good-games-title">Good Games</h2>
    <ul id="good-games">
      <li class="loading">Loading good games...</li>
    </ul>
  </div>

  <div class="section">
    <h2 class="section-title games-title">All Games</h2>
    <ul id="file-list">
      <li class="loading">Loading games...</li>
    </ul>
  </div>

  <script>
    const gamesApiUrl = 'https://api.github.com/repos/Olibot1107/games/contents/games';
    const goodApiUrl = 'https://api.github.com/repos/Olibot1107/games/contents/good';
    const commitsApiUrl = 'https://api.github.com/repos/Olibot1107/games/commits';

    const fileList = document.getElementById('file-list');
    const goodGamesList = document.getElementById('good-games');
    const favoritesList = document.getElementById('favorites');
    const searchInput = document.getElementById('search');
    const versionInfo = document.getElementById('version-info');

    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
    let lastGamesData = [];
    let lastGoodData = [];

    // Function to fetch commit count
    async function fetchCommitCount() {
  try {
    let page = 1;
    let totalCommits = 0;
    let commits;

    do {
      const response = await fetch(`${commitsApiUrl}?per_page=100&page=${page}`);
      if (!response.ok) throw new Error(`GitHub API error: ${response.status}`);
      commits = await response.json();
      totalCommits += commits.length;
      page++;
    } while (commits.length > 0);

    versionInfo.textContent = `Version: ${totalCommits}`;
  } catch (error) {
    console.error('Error fetching commit count:', error);
    versionInfo.textContent = 'Version: Unknown';
  }
}


    function saveFavorites() {
      localStorage.setItem('favorites', JSON.stringify(favorites));
      renderFavorites();
    }

    function toggleFavorite(folderName) {
      if (favorites.includes(folderName)) {
        favorites = favorites.filter(f => f !== folderName);
      } else {
        favorites.push(folderName);
      }
      saveFavorites();
      renderLists();
    }

    function renderFavorites() {
      if (favorites.length === 0) {
        favoritesList.innerHTML = '<li style="color: #7f8c8d; font-style: italic;">No favorites yet. Click the star next to a game to add it here.</li>';
        return;
      }

      favoritesList.innerHTML = '';
      favorites.forEach(folderName => {
        const li = document.createElement('li');
        const link = document.createElement('a');
        // default link: try in /games first, fallback to /good
        if (lastGamesData.find(item => item.name === folderName)) {
          link.href = `/games/${folderName}/index.html`;
        } else {
          link.href = `/good/${folderName}/index.html`;
        }
        link.textContent = folderName;
        link.className = 'folder';
        li.appendChild(link);
        favoritesList.appendChild(li);
      });
    }

    function createListItem(item, basePath) {
      const li = document.createElement('li');
      const link = document.createElement('a');
      link.textContent = item.name;
      link.href = `/${basePath}/${item.name}/index.html`;
      link.className = 'folder';

      const favBtn = document.createElement('button');
      favBtn.innerHTML = favorites.includes(item.name) ? '‚òÖ' : '‚òÜ';
      favBtn.className = 'favorite' + (favorites.includes(item.name) ? ' fav' : '');
      favBtn.title = favorites.includes(item.name) ? 'Remove from favorites' : 'Add to favorites';
      favBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        e.preventDefault();
        toggleFavorite(item.name);
      });

      li.appendChild(link);
      li.appendChild(favBtn);
      return li;
    }

    function renderLists() {
      const search = searchInput.value.toLowerCase();

      // Render all games
      const filteredGames = lastGamesData
        .filter(item => item.type === 'dir')
        .filter(item => item.name.toLowerCase().includes(search));

      if (filteredGames.length === 0) {
        fileList.innerHTML = search ?
          '<li style="color: #7f8c8d; font-style: italic;">No games match your search.</li>' :
          '<li style="color: #7f8c8d; font-style: italic;">No games found.</li>';
      } else {
        fileList.innerHTML = '';
        filteredGames.forEach(item => {
          fileList.appendChild(createListItem(item, 'games'));
        });
      }

      // Render good games
      const filteredGoodGames = lastGoodData
        .filter(item => item.type === 'dir')
        .filter(item => item.name.toLowerCase().includes(search));

      if (filteredGoodGames.length === 0) {
        goodGamesList.innerHTML = search ?
          '<li style="color: #7f8c8d; font-style: italic;">No good games match your search.</li>' :
          '<li style="color: #7f8c8d; font-style: italic;">No good games found.</li>';
      } else {
        goodGamesList.innerHTML = '';
        filteredGoodGames.forEach(item => {
          goodGamesList.appendChild(createListItem(item, 'good'));
        });
      }
    }

    // Fetch both games + good games
    Promise.all([
      fetch(gamesApiUrl).then(r => r.json()),
      fetch(goodApiUrl).then(r => r.json())
    ])
    .then(([gamesData, goodData]) => {
      lastGamesData = gamesData;
      lastGoodData = goodData;
      renderLists();
      renderFavorites();
    })
    .catch(err => {
      fileList.innerHTML = '<li class="error">Error loading games data. Please check your connection and try again.</li>';
      goodGamesList.innerHTML = '<li class="error">Error loading good games data. Please check your connection and try again.</li>';
      console.error(err);
    });

    searchInput.addEventListener('input', renderLists);

    // Initial render of favorites
    renderFavorites();

    // Fetch commit count for version info
    fetchCommitCount();
  </script>
</body>
</html>